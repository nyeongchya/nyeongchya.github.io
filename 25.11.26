<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NeoRivere 2098 - Broker Nexus</title>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <style>
.gowun-dodum-regular {
  font-family: "Gowun Dodum", sans-serif;
  font-weight: 400;
  font-style: normal;
}

:root{
  --bg-0: #050509;
  --bg-1: #0b0b0f;
  --panel: rgba(18,18,20,0.7);
  --neon-cyan: #00f0ff;
  --neon-pink: #ff34b3;
  --neon-emerald: #3cffb5;
  --text: #e6eef6;
  --muted: #9aa3ad;
  --neon-blue: #00f0ff;
  /* Glitch controls */
  --glitch-x: 2px;        
  --glitch-y: -1px;       
  --glitch-speed: 1600ms; 
  --scanline-opacity: 0.06;
  --transition-fast: 160ms;
}

*{box-sizing:border-box}
html,body{min-height:100vh;}
body{
  margin:0;
  font-family: "Gowun Dodum", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
  background:
    radial-gradient(circle at top, #171724 0%, #050509 55%) fixed,
    linear-gradient(180deg, var(--bg-0) 0%, var(--bg-1) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  overflow-y:scroll;
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" stroke="%23ffffff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v8M2 12h8M22 12h-8M12 22v-8"/></g></svg>') 12 12, crosshair;
}

/* basic layout */
.wrap{max-width:1100px;margin:28px auto;padding:24px;position:relative;z-index:2}
header{display:flex;align-items:center;justify-content:space-between;gap:18px}
.brand{display:flex;align-items:center;gap:14px}
.logo{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:26px;background:linear-gradient(135deg,var(--neon-pink),#7b5cff);box-shadow:0 6px 25px rgba(0,0,0,0.6)}
.title{line-height:1}
.title h1{margin:0;font-family: 'Gowun Dodum', sans-serif;font-size:20px;letter-spacing:1px}
.title p{margin:0;font-size:12px;color:var(--muted)}

nav{display:flex;gap:8px;align-items:center}
.nav-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;font-size:13px;color:var(--text);transition:all var(--transition-fast);display:inline-flex;gap:8px;align-items:center}
.nav-btn:hover{transform:translateY(-3px);box-shadow:0 6px 18px rgba(0,0,0,0.7)}

/* panels */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:18px}
.panel{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:14px;border-radius:12px;backdrop-filter:blur(4px)}

.big{grid-column:span 3}
.two{grid-column:span 2}

h2{margin:0 0 8px 0;font-family:'Gowun Dodum';letter-spacing:0.6px}
p.small{margin:0;color:var(--muted);font-size:13px}

/* summary boxes */
.stats{display:flex;gap:12px;margin-top:12px}
.stat{background:rgba(0,0,0,0.25);padding:12px;border-radius:10px;flex:1;text-align:center}
.stat .num{font-size:22px;font-weight:700;color:var(--neon-emerald)}

/* list */
.list{display:flex;flex-direction:column;gap:10px}
.job{padding:10px;border-radius:10px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.02);transition:transform 180ms}
.job:hover{transform:translateY(-6px)}
.job .meta{font-size:12px;color:var(--muted)}

/* map */
.map-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
.zone{padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.2));border:1px solid rgba(255,255,255,0.03);cursor:help;position:relative;transition:transform 160ms}
.zone:hover{transform:translateY(-6px)}
.zone .key{font-size:12px;color:var(--muted);margin-top:8px}
.zone .tag{
  display:inline-block;
  margin-top:8px;
  font-size:11px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(0,0,0,0.55);
  border:1px solid rgba(0,255,255,0.4);
  color:var(--neon-emerald);
}

/* market (ê¸°ë³¸ ê·¸ë¦¬ë“œ, ì§€ê¸ˆì€ content-box ê¸°ë°˜ì´ë¼ í¬ê²Œ ì‚¬ìš© X) */
.market{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
.item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(0,0,0,0.2)}
.item .meta{font-size:12px;color:var(--muted)}

/* controls */
.controls{display:flex;gap:8px;align-items:center}
.btn{background:linear-gradient(90deg,var(--neon-pink),var(--neon-cyan));border:none;padding:8px 12px;border-radius:10px;color:#000;font-weight:700;cursor:pointer}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);font-weight:600}
.micro{font-size:12px;padding:6px 8px;border-radius:8px}

/* footer */
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px;padding:18px}

/* Glitch CSS (layers) */
.glitch {
  position: relative;
  display: inline-block;
  color: var(--text);
  --g1: var(--glitch-x);
  --g2: calc(var(--glitch-x) * -1);
  --gy: var(--glitch-y);
}
.glitch::before,
.glitch::after{
  content: attr(data-text);
  position: absolute;
  left:0;top:0;
  width:100%;
  height:100%;
  overflow:visible;
  clip-path: inset(0 0 0 0);
  pointer-events:none;
}
.glitch::before{
  color: var(--neon-pink);
  transform:translate(var(--g1), var(--gy));
  mix-blend-mode:screen;
  opacity:0.9;
  animation:glitch-anim var(--glitch-speed) linear infinite;
}
.glitch::after{
  color: var(--neon-cyan);
  transform:translate(var(--g2), calc(var(--gy) * -1));
  mix-blend-mode:screen;
  opacity:0.85;
  animation:glitch-anim-2 calc(var(--glitch-speed) * 0.7) linear infinite;
}

@keyframes glitch-anim {
  0%{transform:translate(var(--g1), var(--gy))}
  10%{transform:translate(calc(var(--g1) * 1.3), var(--gy))}
  20%{transform:translate(calc(var(--g1) * -0.6), calc(var(--gy) * 1.2))}
  30%{transform:translate(var(--g1), calc(var(--gy) * -1))}
  40%{transform:translate(0,0)}
  100%{transform:translate(var(--g1), var(--gy))}
}
@keyframes glitch-anim-2 {
  0%{transform:translate(var(--g2), calc(var(--gy) * -1))}
  15%{transform:translate(calc(var(--g2) * -1.5), calc(var(--gy) * -1.2))}
  35%{transform:translate(var(--g2), 0)}
  60%{transform:translate(calc(var(--g2) * 0.8), var(--gy))}
  100%{transform:translate(var(--g2), calc(var(--gy) * -1))}
}

/* scanlines */
.scanlines:before{
  content:"";
  position:fixed;left:0;right:0;top:0;bottom:0;pointer-events:none;
  background-image:linear-gradient(rgba(255,255,255,var(--scanline-opacity)) 1px, transparent 1px);
  background-size:100% 4px;
  mix-blend-mode:overlay;
  z-index:1;
}

/* noise overlay (using SVG data inline for portability) */
.noise{
  position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;opacity:0.08;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><filter id="n"><feTurbulence baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="512" height="512" filter="url(%23n)" opacity="0.85"/></svg>');
  mix-blend-mode:overlay;z-index:0;
}

/* tooltip */
.tooltip{position:absolute;background:linear-gradient(180deg,rgba(0,0,0,0.9),rgba(10,10,10,0.9));padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);font-size:13px;transform:translateY(-8px);white-space:nowrap;z-index:20;pointer-events:none}

/* easter eggs */
.egg{position:fixed;bottom:16px;right:16px;opacity:0.28;transition:opacity 200ms}
.egg:hover{opacity:1}

/* subtle animations */
.fade-in{animation:fadeIn 600ms ease both}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* responsive */
@media (max-width:900px){
  .grid{grid-template-columns:repeat(1,1fr)}
  .map-grid{grid-template-columns:repeat(2,1fr)}
}

/* Force cyberpunk cursor globally */
*, *:hover, button, button:hover, .btn, .btn:hover, .nav-btn, .nav-btn:hover {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" stroke="%23ffffff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v8M2 12h8M22 12h-8M12 22v-8"/></g></svg>') 12 12, crosshair !important;
}

/* PANEL glow boost */
.panel {
  box-shadow: 0 0 22px rgba(0, 255, 255, 0.06), inset 0 0 12px rgba(255, 0, 180, 0.05);
  transition: transform 200ms, box-shadow 200ms;
}
.panel:hover {
  transform: translateY(-4px);
  box-shadow: 0 0 28px rgba(0, 255, 255, 0.1), inset 0 0 16px rgba(255, 0, 180, 0.08);
}

/* buttons neon pulse */
.btn, .nav-btn {
  position: relative;
  overflow: hidden;
}
.btn::before, .nav-btn::before {
  content:'';
  position:absolute;
  inset:0;
  background:linear-gradient(90deg, rgba(255,0,180,0.3), rgba(0,255,255,0.3));
  mix-blend-mode:overlay;
  opacity:0;
  transition:opacity 180ms;
}
.btn:hover::before, .nav-btn:hover::before {
  opacity:0.35;
}

/* job & map zone hover neon */
.job:hover {
  box-shadow: 0 0 20px rgba(255,0,180,0.15);
}
.zone:hover {
  box-shadow: 0 0 26px rgba(0,255,255,0.18);
}

/* CRT distortion effect */
body {
  filter: contrast(1.02) brightness(1.05) saturate(1.1);
}

/* Random light flicker */
@keyframes flicker {
  0% { opacity: 1; }
  50% { opacity: 0.94; }
  100% { opacity: 1; }
}
.scanlines:before {
  animation: flicker 3s infinite;
}

.sideColumn {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 150px;
  padding: 20px;
  font-size: 11px;
  color: var(--muted);
  line-height: 1.4;
  pointer-events: none;
  opacity: 0.45;
  mix-blend-mode: screen;
  text-shadow: 0 0 6px var(--neon-pink);
  margin-left: 50px;
  margin-right: 50px;
}

#sideNoiseLeft { left: 0; }
#sideNoiseRight { right: 0; }

.sideColumn::before {
  content:
  "ã€ë„¤ì˜¤ë¦¬ë² ë¥´ ê´‘ì—­ ê°ì‹œë§ ì•ˆë‚´ã€‘\A\A"
  "â–¶ NSC: ë„ì‹œ ìƒì¸µ í†µí•© ê°ì‹œ ìœ„ì›íšŒ â€” ê³µì‹ ê¸°ë¡ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ëª…ì‹œë¨\A"
  "â–¶ NMC: ë„¤ì˜¤ë¦¬ë² ë¥´ ìœ ì§€Â·ê´€ë¦¬ë‹¨ â€” ì•¼ê°„ ì •ë¹„ ì¤‘ ë¹„ì¸ê°€ êµ¬ì¡°ë¬¼ ì€í ë³´ê³  ë‹¤ìˆ˜\A\A"
  "â–¶ í˜„ìƒìˆ˜ë°° ëŒ€ìƒ: ì…€ë ˆë¥´ë‹ˆì•„ (ìœ„í—˜ë“±ê¸‰: BLACK)\A"
  "   - ë„¤íŠ¸ì›Œí¬ ì¹¨íˆ¬ 14íšŒ ê¸°ë¡\A"
  "   - ë¶ˆë²• AI ë¡œë”© 3ê±´\A"
  "   - ì „ì ê°ì‹œ ìš°íšŒ 27íšŒ ì ë°œ\A\A"
  "â–¶ ê´‘ê³ : 'ë„¤ì˜¨ ë¸”ëŸ¬ë“œ ì•½êµ­'ì—ì„œ ì‚¬ì´ë²„ ë³´ì¡°ì œ 40% í• ì¸\A"
  "â–¶ ê´‘ê³ : ë¶ˆë²• ì‚¬ì´ë²„ì›¨ì–´ ì¥ì°© ì‹œ ê¸°ìˆ ì ë°°ì • ê°€ëŠ¥\A\A"
  "â–¶ ì‹œìŠ¤í…œ ê²½ê³ : íŒ¨í‚· ì†ì‹¤ë¥  72%\A"
  "â–¶ ì˜¤ë¥˜: NODE-33C ì—°ê²° ì‹¤íŒ¨ â–ˆâ–ˆâ–ˆ\A"
  "â–¶ ë¡œê·¸ ëˆ„ë½ ê°ì§€: TIME_STAMP_CORRUPTED%%%\A"
  "â–¶ NSC ë‚´ë¶€ ì±„ë„ ë…¸ì´ì¦ˆ: \"â€¦NMC ì•¼ê°„ ë£¨íŠ¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ë´â€¦\"\A"
  "â–¶ ë©”ì‹œì§€ ì¬êµ¬ì„± ì¤‘ â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’\A"
  "â–¶ ì•”í‘ì „íŒŒ ìˆ˜ì‹ : 'â€¦ê±°ê¸° ëˆ„êµ¬ëƒâ€¦?'\A\A"
  "â–¶ TIP: ê°ì‹œ ë“œë¡ ì€ 4ì´ˆ ê°„ê²©ìœ¼ë¡œ ê¶¤ë„ë¥¼ ë³€ê²½í•¨\A"
  "â–¶ TIP: íêµ¬ì—­ D-4ëŠ” ìµœê·¼ ë¯¼ê°„ì¸ ì ‘ê·¼ ì°¨ë‹¨ë¨\A\A"
  "â–¶ ì˜¤ë¥˜ ë¤í”„ ì‹œì‘\A"
  "   > META-DATA BREAK\A"
  "   > SIGNAL ECHO Ã—Ã—Ã—\A"
  "   > TEXT_FRAGMENT: 'ë„ë§ì³â€¦'\A"
  "   > DATA CONTAMINATED ########\A";
  white-space: pre-wrap;
}

@keyframes driftGlitch {
  0% { transform: translate(0,0); filter: hue-rotate(0deg); }
  30% { transform: translate(-1px, 0); filter: hue-rotate(15deg); }
  60% { transform: translate(1px, -1px); filter: hue-rotate(-10deg); }
 100% { transform: translate(0,0); filter: hue-rotate(0deg); }
}

.glitch-text {
  animation: driftGlitch 2.5s infinite ease-in-out;
}

body::after {
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(to bottom,
      rgba(0,255,255,0.02) 0px,
      rgba(255,0,180,0.03) 2px,
      transparent 3px,
      transparent 4px
    );
  mix-blend-mode: overlay;
  opacity:0.25;
}

@keyframes sparkFade {
  from { transform: scale(1); opacity:1; }
  to   { transform: scale(2.3); opacity:0; }
}

body.scanlines {
  animation: screenShake 0.55s infinite linear;
}

/* Text Selection Glitch */
::selection {
  background: rgba(255, 0, 180, 0.35);
  color: #00f0ff;
  text-shadow:
    1px 0 var(--neon-pink),
    -1px -1px var(--neon-cyan),
    0 1px #000;
  mix-blend-mode: screen;
}

#Market .item-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
  gap: 14px;
}


/* ê³µí†µ content-box UI (ë‹¤ë¥¸ ì„¹ì…˜ ì¹´ë“œì™€ ê±°ì˜ ë™ì¼) */
.content-box {
  border: 1px solid #00ffff55; 
  padding: 12px;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(3px);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.content-box:hover {
  transform: translateY(-2px);
  box-shadow: 0 0 12px #00ffff44;
}

.box-header {
  display: flex;
  justify-content: space-between;
  font-weight: 600;
  color: #00ffffcc;
}

.low-stock {
  color: #ff0055;
  font-weight: bold;
}

/* ğŸ¯ Market ì„¹ì…˜ ì¹´ë“œ â€” íŒ¨ë„ ìŠ¤íƒ€ì¼ í†µì¼ */
#Market .content-box {
  border: 1px solid rgba(255, 255, 255, 0.05);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  backdrop-filter: blur(4px);
  padding: 14px;
  border-radius: 12px;
  box-shadow: 0 0 22px rgba(0, 255, 255, 0.06), inset 0 0 12px rgba(255, 0, 180, 0.05);
  transition: transform 200ms, box-shadow 200ms;
  font-family: "Gowun Dodum", sans-serif !important;
}

#Market .content-box:hover {
  transform: translateY(-4px);
  box-shadow: 0 0 28px rgba(0, 255, 255, 0.1), inset 0 0 16px rgba(255, 0, 180, 0.08);
}

#Market .item-name {
  font-weight: 600;
  font-size: 16px;
  margin: 0;
  color: var(--text);
}

#Market .item-id {
  font-size: 12px;
  color: var(--muted);
}

#Market .item-desc {
  font-size: 13px;
  line-height: 1.45;
  color: var(--muted);
}

#Market .box-footer {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  color: var(--muted);
}

#Market .low-stock {
  color: var(--neon-pink);
  font-weight: 700;
}

#Market .buy-btn {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.06);
  color: var(--text);
  padding: 8px;
  border-radius: 10px;
  cursor: pointer;
  transition: all 160ms;
}

#Market .buy-btn:hover {
  background: linear-gradient(90deg,var(--neon-pink),var(--neon-cyan));
  color: #000;
}
/* =========================
   ì–¸ë”ë„· ë¡œë”© í™”ë©´
   ========================= */
   #loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;  /* í™”ë©´ ë†’ì´ ë”± ë§ê²Œ */
  background:
    radial-gradient(circle at top, #19001f 0%, #03030a 55%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  color: var(--text);
  font-family: "Gowun Dodum", sans-serif;
  transition: opacity 0.4s ease;
}


#loading-screen .loading-inner {
  max-width: 420px;
  padding: 24px 32px;
  border-radius: 16px;
  background: rgba(0,0,0,0.9);
  border: 1px solid rgba(255,0,180,0.6);
  box-shadow:
    0 0 36px rgba(255,0,180,0.4),
    0 0 22px rgba(0,255,255,0.35);
  text-align: center;
}

#loading-screen .loading-title {
  font-size: 18px;
  margin-bottom: 8px;
}

#loading-screen .loading-sub {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 16px;
}

#loading-screen .loading-bar {
  position: relative;
  height: 4px;
  border-radius: 999px;
  overflow: hidden;
  background: rgba(255,255,255,0.08);
  margin-bottom: 10px;
}

#loading-screen .loading-bar-fill {
  position: absolute;
  left: -40%;
  top: 0;
  bottom: 0;
  width: 40%;
  background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan));
  animation: loadingSlide 1.2s infinite;
}

#loading-screen .loading-hint {
  font-size: 11px;
  color: var(--muted);
}

@keyframes loadingSlide {
  0%   { transform: translateX(0); }
  100% { transform: translateX(260%); }
}

/* ê³µí†µ UI íŒì—… (ì•Œë¦¼ìš©) */
#uiPopup{
  position: fixed;
  inset: 0;
  display: none;              /* JSì—ì„œ flexë¡œ ë°”ê¿ˆ */
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.68);
  z-index: 999;
}

#uiPopup .popup-content{
  background: rgba(5,5,12,0.96);
  border-radius: 14px;
  border: 1px solid var(--neon-pink);
  padding: 18px 20px;
  max-width: 420px;
  width: 90%;
  box-shadow:
    0 0 26px rgba(255,0,160,0.6),
    0 0 14px rgba(0,255,255,0.4);
  font-size: 14px;
  line-height: 1.5;
}

/* Jobs ìƒíƒœ í•„í„° ë²„íŠ¼ í™œì„±í™” */
.job-filter.active {
  border-color: var(--neon-cyan);
  box-shadow: 0 0 12px rgba(0,255,255,0.35);
}

.world-ticker {
  margin-top: 8px;
  font-size: 11px;
  color: var(--muted);
  display: flex;
  gap: 8px;
  align-items: center;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  border-top: 1px solid rgba(255,255,255,0.06);
  padding-top: 6px;
}

.world-ticker .label {
  color: var(--neon-emerald);
  font-weight: 600;
}

/* =========================
   NeoRivere: Jobs / Intel / Map Worldbook UI
   ========================= */
   .nd-section-header{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:12px;
  margin-bottom:10px;
}
.nd-section-caption{
  font-size:12px;
  color:var(--muted);
  margin-top:4px;
}
.nd-section-actions{
  display:flex;
  gap:8px;
  align-items:center;
}

/* Featured Contracts (ë­í¬ ì˜ë¢° ì¹´ë“œ) */
.nd-contract-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:10px;
  margin-top:10px;
  margin-bottom:14px;
}
.nd-contract-card{
  position:relative;
  padding:12px;
  border-radius:12px;
  background:rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.08);
  font-size:13px;
}
.nd-contract-rank{
  font-size:11px;
  letter-spacing:0.08em;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:4px;
}
.nd-contract-title{
  font-weight:600;
  margin-bottom:6px;
}
.nd-contract-body{
  color:var(--muted);
  line-height:1.45;
}
.nd-contract-meta{
  font-size:11px;
  color:var(--muted);
  margin-top:6px;
  display:flex;
  justify-content:space-between;
}
.nd-contract-pill{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:2px 8px;
  border-radius:999px;
  font-size:11px;
  border:1px solid rgba(255,255,255,0.16);
  margin-top:4px;
}

.nd-rank-s{
  border-color:rgba(255,0,180,0.7);
  box-shadow:0 0 16px rgba(255,0,180,0.25);
}
.nd-rank-a{
  border-color:rgba(0,255,255,0.6);
}
.nd-rank-c{
  border-style:dashed;
  border-color:rgba(255,255,255,0.18);
}

/* Intel Feed */
.nd-intel-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:10px;
  margin-top:10px;
}
.nd-intel-card{
  padding:12px;
  border-radius:12px;
  background:rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.05);
  font-size:13px;
  position:relative;
}
.nd-intel-top{
  display:flex;
  justify-content:space-between;
  gap:8px;
  align-items:flex-start;
}
.nd-intel-title{
  font-weight:600;
}
.nd-intel-meta{
  font-size:11px;
  color:var(--muted);
  margin-top:3px;
}
.nd-intel-tag{
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:0.08em;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(0,255,255,0.4);
}
.nd-intel-body{
  margin-top:6px;
  color:var(--muted);
  line-height:1.45;
}

/* Intel êµ¬ì—­ í•˜ì´ë¼ì´íŠ¸ / ë””ë° */
.nd-intel-card.intel-highlight {
  border-color: rgba(0, 255, 255, 0.8);
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.55);
  transform: translateY(-3px);
}

.nd-intel-card.intel-dim {
  opacity: 0.35;
  filter: grayscale(0.2);
}

/* Map Layout + Detail */
.nd-map-layout{
  display:grid;
  grid-template-columns:minmax(0,1.8fr) minmax(0,2.2fr);
  gap:14px;
  margin-top:10px;
}
.nd-map-detail{
  padding:12px;
  border-radius:12px;
  background:rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.06);
  font-size:13px;
}
.nd-map-detail-title{
  font-weight:600;
  font-size:16px;
  margin-bottom:4px;
}
.nd-map-detail-level{
  font-size:12px;
  color:var(--muted);
  margin-bottom:8px;
}
.nd-map-detail-desc{
  color:var(--muted);
  line-height:1.45;
  margin-bottom:6px;
}
.nd-map-detail-key{
  font-size:12px;
  color:var(--neon-emerald);
}

@media (max-width:900px){
  .nd-map-layout{
    grid-template-columns:1fr;
  }
}

/* Hologram zone preview in left bottom */
.nd-map-holo{
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  border:1px dashed rgba(0,255,255,0.45);
  background:radial-gradient(circle at top,
              rgba(0,255,255,0.12),
              rgba(0,0,0,0.9));
  box-shadow:0 0 18px rgba(0,255,255,0.18);
  font-size:11px;
  color:var(--muted);
  position:relative;
  overflow:hidden;
}

.nd-map-holo::before{
  content:"";
  position:absolute;
  left:-30%;
  right:-30%;
  top:-50%;
  height:200%;
  background:linear-gradient(
    to bottom,
    transparent,
    rgba(0,255,255,0.18),
    transparent
  );
  transform:rotate(8deg);
  animation:ndHoloSweep 3.5s infinite linear;
  pointer-events:none;
}

@keyframes ndHoloSweep{
  0%{ transform:translateY(40%) rotate(8deg); }
  100%{ transform:translateY(-40%) rotate(8deg); }
}

.nd-map-holo-label{
  font-size:10px;
  letter-spacing:0.12em;
  text-transform:uppercase;
  color:var(--neon-emerald);
  opacity:0.7;
}

.nd-map-holo-name{
  margin-top:4px;
  font-size:14px;
  font-weight:600;
  color:var(--neon-emerald);
}

.nd-map-holo-meta{
  margin-top:2px;
  font-size:11px;
  color:var(--muted);
}

.nd-map-holo-grid{
  margin-top:8px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:3px;
}

.nd-map-holo-cell{
  height:8px;
  border-radius:2px;
  background:rgba(0,255,255,0.08);
}

.nd-map-holo-cell.active{
  background:linear-gradient(90deg,var(--neon-pink),var(--neon-cyan));
  box-shadow:0 0 8px rgba(0,255,255,0.6);
}

.nd-map-ops {
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 10px;
  background: rgba(0, 0, 0, 0.45);
  border: 1px dashed rgba(0, 255, 255, 0.25);
  font-size: 12px;
  color: var(--muted);
}

.nd-map-ops-title {
  font-size: 11px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--neon-emerald);
  margin-bottom: 6px;
}

.nd-map-ops-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
}

.ops-item .label {
  font-size: 11px;
  color: var(--muted);
}

.ops-item .value {
  margin-top: 3px;
  font-size: 12px;
  color: var(--text);
}
@media (max-width: 900px) {
  .nd-map-ops-grid {
    grid-template-columns: 1fr;
  }
}

/* ==== ì„¹ì…˜ ì´ë™ ROUTING ì˜¤ë²„ë ˆì´ ==== */
#routeOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;  /* í™”ë©´ ë†’ì´ ê¸°ì¤€ìœ¼ë¡œ ê½‰ ì±„ìš°ê¸° */
  display: flex;
  align-items: center;   /* ì„¸ë¡œ ì¤‘ì•™ */
  justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ */
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.35s ease;
  z-index: 998;
  background: radial-gradient(circle at center,
    rgba(0, 0, 0, 0.75) 0%,
    rgba(0, 0, 0, 0.96) 55%);
}


#routeOverlayInner {
  padding: 18px 26px;
  border-radius: 14px;
  border: 1px solid rgba(0,255,255,0.7);
  box-shadow:
    0 0 22px rgba(0,255,255,0.5),
    0 0 12px rgba(255,0,160,0.4);
  background: rgba(0,0,0,0.9);
  font-size: 13px;
  text-align: center;
}

#routeOverlayTitle {
  font-size: 12px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--neon-emerald);
  margin-bottom: 6px;
}

#routeOverlayText {
  font-size: 16px;
  font-weight: 600;
}

#routeOverlay.visible {
  opacity: 1;
  pointer-events: auto;
}

/* ==== Jobs ì¹´ë“œ ìŠ¤ìº” ë¼ì¸ íš¨ê³¼ ==== */
.job {
  position: relative;
  overflow: hidden;
}

.job::before {
  content:"";
  position: absolute;
  left:-40%;
  right:-40%;
  top:-60%;
  height:120%;
  background: linear-gradient(
    to bottom,
    transparent,
    rgba(0,255,255,0.25),
    transparent
  );
  opacity:0;
  transform: translateY(80%);
  pointer-events:none;
}

.job:hover::before {
  opacity: 1;
  animation: jobScan 0.9s linear;
}

@keyframes jobScan {
  0%   { transform: translateY(80%); }
  100% { transform: translateY(-80%); }
}

/* ==== Map Holo íŒ¨ë„ ì„ íƒ í„ìŠ¤ ==== */
.nd-map-holo.pulse {
  animation: holoPulse 1.4s ease-out;
}

@keyframes holoPulse {
  0% {
    box-shadow:
      0 0 4px rgba(0,255,255,0.3),
      0 0 0 0 rgba(0,255,255,0.25);
  }
  70% {
    box-shadow:
      0 0 18px rgba(0,255,255,0.7),
      0 0 28px 12px rgba(0,255,255,0.0);
  }
  100% {
    box-shadow:
      0 0 8px rgba(0,255,255,0.4),
      0 0 0 0 rgba(0,255,255,0.0);
  }
}

/* =========================
   Side floating alert cards
   ========================= */
   .side-alert {
  position: fixed;
  width: 190px;
  max-width: 44vw;
  padding: 8px 10px;
  font-size: 11px;
  line-height: 1.4;
  color: var(--text);
  background: rgba(3, 3, 10, 0.96);
  border-radius: 10px;
  border: 1px solid rgba(255, 0, 180, 0.7);
  box-shadow:
    0 0 14px rgba(255, 0, 180, 0.5),
    0 0 8px rgba(0, 255, 255, 0.35);
  z-index: 3;
  pointer-events: none;
  opacity: 0;
  transform: translateY(6px) scale(0.98);
  animation: sideAlertInOut 4.2s ease-out forwards;
  backdrop-filter: blur(4px);
}

.side-alert-left {
  left: 24px;
  text-align: left;
}

.side-alert-right {
  right: 24px;
  text-align: right;
}

.side-alert-title {
  font-size: 10px;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--neon-emerald);
  margin-bottom: 3px;
}

.side-alert-body {
  font-size: 11px;
}

.side-alert-tag {
  margin-top: 5px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--muted);
  opacity: 0.8;
}

/* ë“±ì¥í–ˆë‹¤ê°€ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes sideAlertInOut {
  0% {
    opacity: 0;
    transform: translateY(12px) scale(0.95);
  }
  12% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  70% {
    opacity: 1;
    transform: translateY(-2px) scale(1.01);
  }
  100% {
    opacity: 0;
    transform: translateY(-6px) scale(0.97);
  }
}

.side-alert-left {
  left: 24px;
  text-align: left;
}

.side-alert-right {
  right: 24px;
  text-align: right;
}

.side-alert-title {
  font-size: 10px;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--neon-emerald);
  margin-bottom: 3px;
}

.side-alert-body {
  font-size: 11px;
}

.side-alert-tag {
  margin-top: 5px;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--muted);
  opacity: 0.8;
}

/* ë“±ì¥í–ˆë‹¤ê°€ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes sideAlertInOut {
  0% {
    opacity: 0;
    transform: translateY(12px) scale(0.95);
  }
  12% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  70% {
    opacity: 1;
    transform: translateY(-2px) scale(1.01);
  }
  100% {
    opacity: 0;
    transform: translateY(-6px) scale(0.97);
  }
}

/* ===== Contact: ì…€ë ˆë¥´ë‹ˆì•„ í†µì‹  í—ˆë¸Œ ===== */
.contact-layout{
  margin-top:12px;
  display:flex;
  gap:14px;
  align-items:flex-start;
  flex-wrap:wrap;
}
.contact-composer{
  flex:1;
  min-width:240px;
}
.contact-log-panel{
  flex:1.3;
  min-width:260px;
  max-height:260px;
  padding:10px;
  border-radius:12px;
  background:rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.06);
  overflow-y:auto;
}
.contact-log-title{
  font-size:14px;
  font-weight:600;
}
.contact-log-caption{
  font-size:11px;
  color:var(--muted);
}
.contact-log-list{
  margin-top:8px;
  display:flex;
  flex-direction:column;
  gap:8px;
  font-size:12px;
}
.contact-log-entry{
  padding:8px 10px;
  border-radius:8px;
  background:rgba(0,0,0,0.55);
  border:1px solid rgba(0,255,255,0.18);
}
.contact-log-meta{
  display:flex;
  justify-content:space-between;
  gap:8px;
  margin-bottom:4px;
  font-size:11px;
  color:var(--muted);
}
.contact-log-from{
  font-weight:600;
  color:var(--neon-emerald);
}
.contact-log-to{
  opacity:0.9;
}
.contact-log-kind{
  margin-left:4px;
  font-size:10px;
  letter-spacing:0.1em;
  text-transform:uppercase;
  color:var(--muted);
}
.contact-log-body{
  white-space:pre-line;
  color:var(--text);
}
.contact-log-empty{
  font-size:12px;
  color:var(--muted);
  opacity:0.9;
}

@media (max-width:900px){
  .contact-log-panel{
    max-height:220px;
  }
}
/* ===== ì‚¬ë¬´ì†Œ ì¸ë¬¼ ë¸Œë¦¬í•‘ ì¹´ë“œ ===== */
.staff-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 10px;
  margin-top: 10px;
}

.staff-card {
  padding: 12px;
  border-radius: 12px;
  background: rgba(0,0,0,0.5);
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 0 16px rgba(0,255,255,0.08);
  font-size: 13px;
}

.staff-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 6px;
}

.staff-name {
  font-weight: 600;
  font-size: 15px;
}

.staff-role {
  font-size: 11px;
  color: var(--muted);
}

.staff-tagline {
  margin-top: 4px;
  font-size: 12px;
  color: var(--neon-emerald);
}

.staff-body {
  margin-top: 6px;
  color: var(--muted);
  line-height: 1.45;
}

.staff-meta {
  margin-top: 8px;
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  color: var(--muted);
}

.staff-pill {
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(0,255,255,0.45);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

.wrap{
  max-width:1100px;
  /* ê¸°ì¡´: margin:28px auto; */
  margin:0 auto;              /* ìœ„ ì—¬ë°± ì—†ì• ê¸° */
  padding:16px 24px 24px;     /* ì‚´ì§ë§Œ ìˆ¨ ì‰´ ì •ë„ë¡œ íŒ¨ë”©ë§Œ ë‚¨ê¸°ê¸° */
  position:relative;
  z-index:2;
}

/* ê³µí†µ ëª¨ë‹¬ ì¤‘ì•™ ì •ë ¬ */
.modal-center {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
}

/* í™”ë©´ ê¸°ì¤€ í•œê°€ìš´ë° ëœ¨ëŠ” ê³µìš© íŒì—… */
#uiPopup {
  position: fixed !important;
  inset: 0 !important;           /* top/right/bottom/left ëª¨ë‘ 0 */
  display: none;                 /* JSì—ì„œ flexë¡œ ë³€ê²½ */
  align-items: center;
  justify-content: center;
  z-index: 9999;
  background: radial-gradient(circle at center,
    rgba(0,0,0,0.75) 0%,
    rgba(0,0,0,0.93) 55%);       /* ë¡œë”©/ë¼ìš°íŒ…ì²˜ëŸ¼ ë°°ê²½ ì–´ë‘¡ê²Œ */
}

#uiPopupContent {
  max-width: 380px;
  width: 90%;
  background: rgba(0,0,0,0.9);
  border-radius: 12px;
  border: 1px solid var(--neon-cyan);
}

/* í™”ë©´ ê¸°ì¤€ ì „ì²´ ì˜¤ë²„ë ˆì´ + ì¤‘ì•™ ì •ë ¬ */
.modal-overlay {
  position: fixed;
  inset: 0; /* top:0; right:0; bottom:0; left:0; */
  display: none;            /* JSì—ì„œ blockìœ¼ë¡œ ì¼œì¤Œ */
  align-items: center;      /* ì„¸ë¡œ ì¤‘ì•™ */
  justify-content: center;  /* ê°€ë¡œ ì¤‘ì•™ */
  z-index: 9999;
  background: radial-gradient(circle at center,
    rgba(0,0,0,0.78) 0%,
    rgba(0,0,0,0.96) 55%);
  backdrop-filter: blur(4px);
}

/* ê³µí†µ ëª¨ë‹¬ ì¹´ë“œ ë°•ìŠ¤ */
.modal-card {
  width: 440px;
  max-width: 92vw;
  padding: 20px 22px;
  border-radius: 12px;
  background: rgba(0,0,0,0.9);
  border: 1px solid var(--neon-cyan);
  box-shadow:
    0 0 22px rgba(0,255,255,0.55),
    0 0 10px rgba(255,0,160,0.4);
  font-size: 13px;
  color: var(--muted);
}

/* ===== í™”ë©´ ê¸°ì¤€ ì¤‘ì•™ì— ëœ¨ëŠ” ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ===== */
#jobModal,
#jobFlowModal {
  position: fixed;
  inset: 0;                      /* top/right/bottom/left: 0 */
  display: none;                 /* JSì—ì„œ flexë¡œ ë°”ê¿”ì¤Œ */
  align-items: center;           /* ì„¸ë¡œ ì¤‘ì•™ */
  justify-content: center;       /* ê°€ë¡œ ì¤‘ì•™ */
  z-index: 9999;
  background: radial-gradient(
    circle at center,
    rgba(0, 0, 0, 0.78) 0%,
    rgba(0, 0, 0, 0.96) 55%
  );                             /* í™”ë©´ ì „ì²´ ì‚´ì§ ì–´ë‘¡ê²Œ */
}

/* íŒì—… ì¹´ë“œ ê³µí†µ ìŠ¤íƒ€ì¼ */
.modal-card {
  max-width: 440px;
  width: 90%;
  background: rgba(0, 0, 0, 0.9);
  border-radius: 12px;
  border: 1px solid var(--neon-cyan);
  box-shadow:
    0 0 22px rgba(0,255,255,0.55),
    0 0 10px rgba(255,0,160,0.4);
  padding: 20px 22px;
  backdrop-filter: blur(6px);
}

/* ==== Job Flow ì ìˆ˜/ì•¡ì…˜ UI ==== */
.flow-score {
  font-size: 12px;
  margin: 6px 0 4px;
  color: var(--neon-emerald);
}

.flow-actions {
  margin-top: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.flow-act {
  width: 100%;
  text-align: left;
  justify-content: space-between;
}

.flow-act.completed {
  opacity: 0.5;
  border-style: dashed;
}

/* ===========================
   ì…€ë ˆë¥´ë‹ˆì•„ ë¯¸ë‹ˆ AI ìœ„ì ¯
   =========================== */
   #cel-ai-widget {
  position: fixed;
  top: 500px;      /* í—¤ë”/ì‚¬ìš´ë“œ ë²„íŠ¼ ë¼ì¸ ê·¼ì²˜ */
  right: 450px;    /* í™”ë©´ ì˜¤ë¥¸ìª½ ì—¬ë°±ì€ ê·¸ëŒ€ë¡œ */
  z-index: 900;
  font-size: 12px;
  font-family: "Gowun Dodum", sans-serif;
}

/* ë™ê·¸ë€ í† ê¸€ ë²„íŠ¼ */
#cel-ai-toggle {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  padding: 0;
  margin: 0;
  border: 1px solid var(--neon-cyan);
  box-shadow: 0 0 18px rgba(0,240,255,0.7), 0 0 10px rgba(255,0,160,0.4);
  background: radial-gradient(circle at 30% 0%, rgba(0,255,255,0.25), rgba(0,0,0,0.9));
  cursor: pointer;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}

#cel-ai-toggle:hover {
  transform: translateY(-2px) scale(1.03);
  border-color: var(--neon-emerald);
  box-shadow: 0 0 22px rgba(0,255,255,0.9), 0 0 14px rgba(255,0,160,0.6);
}

#cel-ai-toggle img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* íŒ¨ë„ ì „ì²´ */
#cel-ai-panel {
  position: absolute;
  right: 0;
  bottom: 64px;
  width: 270px;
  max-height: 360px;
  background: rgba(5,5,12,0.95);
  border-radius: 16px;
  border: 1px solid rgba(0,240,255,0.7);
  box-shadow: 0 0 30px rgba(0,240,255,0.6), 0 0 18px rgba(255,0,160,0.4);
  display: none;
  flex-direction: column;
  overflow: hidden;
  backdrop-filter: blur(12px);
}

#cel-ai-panel.open {
  display: flex;
}

/* í—¤ë” */
#cel-ai-header {
  display: flex;
  align-items: center;
  padding: 8px 10px;
  border-bottom: 1px solid rgba(0,240,255,0.35);
  background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(0,32,40,0.95));
}

.cel-ai-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  overflow: hidden;
  border: 1px solid rgba(255,0,160,0.7);
  box-shadow: 0 0 10px rgba(255,0,160,0.6);
  margin-right: 8px;
  flex-shrink: 0;
}

.cel-ai-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.cel-ai-meta {
  flex: 1;
  min-width: 0;
}

.cel-ai-name {
  font-size: 11px;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--neon-cyan);
}

.cel-ai-status {
  font-size: 11px;
  color: var(--muted);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.cel-ai-close {
  background: none;
  border: none;
  color: var(--muted);
  font-size: 14px;
  cursor: pointer;
  padding: 2px 4px;
  margin-left: 4px;
}

.cel-ai-close:hover {
  color: #fff;
}

/* ë©”ì‹œì§€ ì˜ì—­ */
#cel-ai-messages {
  padding: 8px 10px;
  flex: 1;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--neon-cyan) transparent;
}

#cel-ai-messages::-webkit-scrollbar {
  width: 6px;
}
#cel-ai-messages::-webkit-scrollbar-thumb {
  background: rgba(0,240,255,0.7);
  border-radius: 3px;
}
#cel-ai-messages::-webkit-scrollbar-track {
  background: transparent;
}

.cel-msg {
  margin-bottom: 6px;
  display: flex;
}

.cel-msg.me {
  justify-content: flex-end;
}

.cel-msg.bot {
  justify-content: flex-start;
}

.cel-msg .bubble {
  max-width: 80%;
  padding: 6px 8px;
  border-radius: 10px;
  font-size: 11px;
  line-height: 1.4;
  white-space: pre-line;
}

.cel-msg.bot .bubble {
  background: rgba(8,16,32,0.95);
  border: 1px solid rgba(0,240,255,0.6);
  color: #eaf9ff;
}

.cel-msg.me .bubble {
  background: rgba(255,0,160,0.18);
  border: 1px solid rgba(255,0,160,0.7);
  color: #ffdff7;
}

/* ì…ë ¥ì°½ */
#cel-ai-form {
  border-top: 1px solid rgba(0,240,255,0.3);
  padding: 6px 8px;
  background: rgba(1,4,10,0.96);
}

#cel-ai-input {
  width: 100%;
  border-radius: 999px;
  border: 1px solid rgba(0,240,255,0.6);
  background: rgba(0,0,0,0.8);
  color: #f6fbff;
  padding: 6px 10px;
  font-size: 11px;
  outline: none;
}

#cel-ai-input::placeholder {
  color: var(--muted);
  font-size: 10px;
}

  </style>
</head>

<body class="scanlines">

    <!-- ğŸ”» ì–¸ë”ë„· ì ‘ì† ë¡œë”© í™”ë©´ -->
    <div id="loading-screen">
      <div class="loading-inner">
        <div class="loading-title glitch" data-text="ACCESSING UNDERNET NODE...">
          ACCESSING UNDERNET NODE...
        </div>
        <div class="loading-sub">
          ê¶Œí•œ ì—†ëŠ” ì ‘ì† ì‹œë„ ê°ì§€â€¦<br>
          ì•”ì‹œì¥ ë¼ìš°íŒ… í…Œì´ë¸” ì¬êµ¬ì„± ì¤‘â€¦
        </div>
        <div class="loading-bar">
          <div class="loading-bar-fill"></div>
        </div>
        <div class="loading-hint">
          ë„¤ì˜¤ë¦¬ë² ë¥´ì— ì˜¤ì‹ ê±¸ í™˜ì˜í•©ë‹ˆë‹¤.<br>
          STATUS: <span style="color:#ff3b7b;">GLITCHED</span>
        </div>
      </div>
    </div>
  

  <div class="noise"></div>

  <div class="wrap fade-in" id="app">
    <header>
      <div class="brand">
        <div class="logo">ğŸ•¶ï¸</div>
        <div class="title">
          <h1><span class="glitch" data-text="NeoRivere 2098">NeoRivere 2098</span></h1>
          <p class="small">ì€ë°€í•œ ì˜ë¢° Â· ìµëª… ì—°ê²° Â· ì‹¤ì‹œê°„ ì¸í…”</p>
        </div>
      </div>

      <nav>
        <button class="nav-btn" data-target="home">Home</button>
        <button class="nav-btn" data-target="jobs">Jobs <span style="font-size:10px;margin-left:1px;color:var(--muted)">(<span id="jobs-count">0</span>)</span></button>
        <button class="nav-btn" data-target="intel">Intel</button>
        <button class="nav-btn" data-target="map">Map</button>
        <button class="nav-btn" data-target="contact">Contact</button>
        <button class="nav-btn" data-target="Market">Market</button>
        <div style="width:4px"></div>
        <button id="loginBtn" class="nav-btn">ë¡œê·¸ì¸</button>
        <button id="soundToggle" class="nav-btn">ì‚¬ìš´ë“œ</button>
      </nav>
    </header>
    
    <div id="breadcrumb"
       style="margin:4px 0 0 2px;font-size:11px;color:var(--muted);opacity:0.9;">
    PATH / HOME
  </div>

    <!-- MAIN CONTENT -->
    <main style="margin-top:18px">
      <!-- HOME -->
      <section id="home" class="panel big">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <h2 style="font-size:22px;margin-bottom:6px">
              <span class="glitch" data-text="NeoRivere â€” ë’·ê³¨ëª©ì—ì„  ìš°ë¦¬ëŠ” ë²•ë³´ë‹¤ ë¹ ë¥´ë‹¤">
                NeoRivere â€” ë’·ê³¨ëª©ì—ì„  ìš°ë¦¬ëŠ” ë²•ë³´ë‹¤ ë¹ ë¥´ë‹¤
              </span>
            </h2>
            <p class="small">ë¸Œë¡œì»¤ë¡œì„œ í•„ìš”í•œ ëª¨ë“  ë„êµ¬ë¥¼ í•œ ê³³ì—.</p>
            <div style="margin-top:8px;color:var(--muted);font-size:13px">
              ê²½ê³ : ì •ë¶€ì˜ ê°ì‹œê°€ ê°•â–ˆâ–ˆìŠµë‹ˆë‹¤. ì€â–ˆí•˜ê²Œ í–‰â–ˆâ–ˆì„¸ìš”.
            </div>
          </div>

          <div class="world-ticker">
            <span class="label">[NEORIVERE STATUS]</span>
            <span id="worldTickerText"></span>
          </div>          

          <div class="controls">
            <div style="text-align:right">
              <div style="background:rgba(0,0,0,0.4);padding:8px;border-radius:12px;margin-top:0px" id="wallet">5000 creds</div>
            </div>
            <button id="postJob" class="btn">ì˜ë¢° ì˜¬ë¦¬ê¸°</button>
          </div>
        </div>

        <div class="grid" style="margin-top:16px">
          <div class="panel" id="profPanel">
            <h3>ë¸Œë¡œì»¤ í”„ë¡œí•„</h3>
            <p class="small">í”„ë¡œí•„ì„ ì„¤ì •í•˜ê³  ì‹ ë¢° ì ìˆ˜ë¥¼ ìŒ“ìœ¼ì„¸ìš”. (ë¡œì»¬ ì €ì¥)</p>
            <div style="margin-top:10px;color:var(--muted);font-size:13px">í˜„ì¬ ë¡œê·¸ì¸: <span id="who">ì—†ìŒ</span></div>
          </div>

          <div class="panel" id="blackPanel">
            <h3>ì•”ì‹œì¥</h3>
            <p class="small">ì•„ì´í…œ ë¼ì¸ì—…ê³¼ êµ¬ë§¤. ìµëª… íŠ¸ëœì­ì…˜ì€ ì‹¤í—˜ì ì…ë‹ˆë‹¤.</p>
          </div>

          <div class="panel" id="connPanel">
            <h3>ì—°ê²° í¬í„¸</h3>
            <p class="small">ì˜ë¢° ë“±ë¡ê³¼ ì§ì ‘ ì—°ê²° â€” ìµëª… ì˜µì…˜ í¬í•¨.</p>
          </div>

          <div class="panel" id="secretPanel">
            <h3>ë¹„ë°€ íŒì—…</h3>
            <p class="small">ì˜¤ì§ <strong id="secret-owner">raven</strong> ì „ìš©ì…ë‹ˆë‹¤.</p>
            <div style="margin-top:8px;color:var(--muted)">í˜„ì¬ ë¹„ë°€ íŒì—… ìƒíƒœ: <span id="secretState">ì ê¹€</span></div>
          </div>
        </div>

        <button id="pulseScan" class="btn" style="margin-top:10px">í„ìŠ¤ ìŠ¤ìº”</button>
        <button id="darkTrace" class="btn secondary" style="margin-top:10px">ë‹¤í¬ íŠ¸ë ˆì´ìŠ¤</button>

        <div style="margin-top:16px" class="panel">
          <h3><span class="glitch" data-text="ìµœê·¼ í™œë™">ìµœê·¼ í™œë™</span></h3>
          <p class="small">ì‚¬ëŒë“¤ì´ ìš°ë¦¬ì—ê²Œ ë‚¨ê¸´ ì˜ë¢°(ìƒ˜í”Œ) ë° í˜„ì¬ ì˜¤í”ˆëœ ì˜ë¢°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

          <div class="stats" style="margin-top:12px">
            <div class="stat">
              <div class="num" id="completed-count">0</div>
              <div class="small" style="color:var(--muted)">ì´ ì™„ë£Œ ì˜ë¢°</div>
            </div>
            <div class="stat">
              <div class="num" id="open-count">0</div>
              <div class="small" style="color:var(--muted)">ì˜¤í”ˆ ì˜ë¢°</div>
            </div>
            <div class="stat">
              <div class="num" id="wallet-count">5000</div>
              <div class="small" style="color:var(--muted)">ì§€ê°‘ (creds)</div>
            </div>
          </div>

          <div style="margin-top:14px">
            <h4 style="margin:0 0 8px 0">ìµœê·¼ ì˜ë¢° (ì‚¬ìš©ì ì œì¶œ ì˜ˆì‹œ)</h4>
            <div id="recent-list" class="list"></div>
          </div>
        </div>

        <div style="margin-top:16px" class="panel">
          <h3><span class="glitch" data-text="ì‚¬ë¬´ì†Œ ì¸ë¬¼ ë¸Œë¦¬í•‘">ì‚¬ë¬´ì†Œ ì¸ë¬¼ ë¸Œë¦¬í•‘</span></h3>
          <p class="small">
            ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œì˜ í•µì‹¬ ì¸ë¬¼ë“¤.  
            ì™¸ë¶€ ê¸°ë¡ì—ëŠ” ë‚¨ì§€ ì•ŠëŠ”, ë„¤ì˜¤ë¦¬ë² ë¥´ ë’·ê³¨ëª©ì˜ ì§„ì§œ ì£¼ì¸ë“¤ì´ë‹¤.
          </p>

          <div class="staff-grid">
            <!-- ì…€ë ˆë¥´ë‹ˆì•„ -->
            <article class="staff-card">
              <div class="staff-header">
                <div>
                  <div class="staff-name">ì…€ë ˆë¥´ë‹ˆì•„</div>
                  <div class="staff-role">Obsidian Directive ëŒ€í‘œ Â· ë©”ì¸ ë¸Œë¡œì»¤</div>
                </div>
                <div class="staff-pill">LV.BLACK Â· ROOT ACCESS</div>
              </div>
              <div class="staff-tagline">
                â€œë„ì‹œì˜ ëª¨ë“  ë¹„ë°€ì€, ê²°êµ­ ë‚´ ì±…ìƒ ìœ„ë¡œ ëª¨ì¸ë‹¤.â€
              </div>
              <div class="staff-body">
                ë„¤ì˜¤ë¦¬ë² ë¥´ ë’·ì„¸ê³„ì˜ ìµœìƒìœ„ ê¶Œë ¥.  
                ê°ì‹œë§ì˜ ë¹ˆ í‹ˆ, ì‚¬ëŒë“¤ì˜ ì•½ì , ë°ì´í„° íë¦„ì˜ ë°©í–¥ê¹Œì§€
                ë¨¸ë¦¿ì†ì— ì§€ë„ì²˜ëŸ¼ ê·¸ë ¤ë‘ê³  ì›€ì§ì¸ë‹¤.
              </div>
              <div class="staff-meta">
                <span>ì „ë¬¸ ë¶„ì•¼: ì •ë³´ ë¸Œë¡œì»¤ë§ / ë„¤íŠ¸ì›Œí¬ ì¡°ì‘</span>
                <span>ìœ„í—˜ë„: â˜…â˜…â˜…â˜…â˜…</span>
              </div>
            </article>

            <!-- NSB ì¶œì‹  ì†Œë…„ ì„œí¬í„° -->
            <article class="staff-card">
              <div class="staff-header">
                <div>
                  <div class="staff-name">ì½”ë“œë„¤ì„: ìŠ¤ìºë„ˆ</div>
                  <div class="staff-role">ì „ NSB ê°ì‹œêµ­ Â· ì„œí¬í„°</div>
                </div>
                <div class="staff-pill">AGE: LATE TEEN</div>
              </div>
              <div class="staff-tagline">
                â€œì›ë˜ëŠ” ë„ˆí¬ë¥¼ ê°ì‹œí•˜ë¼ê³  ë°°ì› ëŠ”ë°, ì´ì œëŠ” ê°™ì´ ë„ë§ì¹˜ëŠ” ìª½ì´ ë” ì¬ë°Œì–´.â€
              </div>
              <div class="staff-body">
                10ëŒ€ í›„ë°˜ì˜ ì†Œë…„. ì›ë˜ NSB ì†Œì† ê°ì‹œêµ­ ë¶„ì„ ìš”ì›ì´ì—ˆì§€ë§Œ  
                ë„ˆë¬´ ë§ì€ ê²ƒì„ ì•Œì•„ë²„ë¦° íƒ“ì— â€œì˜¬ë“œ ì±„ë„â€ë¡œ ë²„ë ¤ì¡Œë‹¤.  
                ê·¸ë•Œ ì…€ë ˆë¥´ë‹ˆì•„ê°€ ì†ì„ ë‚´ë°€ì–´ ì‚¬ë¬´ì†Œë¡œ ë°ë ¤ì™”ë‹¤.
              </div>
              <div class="staff-meta">
                <span>ì—­í• : ê°ì‹œë§ íŒ¨í„´ ë¶„ì„ / ë¡œê·¸ ì¡°ì‘</span>
                <span>ì‹ ë¢°ë„: â˜…â˜…â˜…â˜…â˜†</span>
              </div>
            </article>

            <!-- ì…€ë ˆë¥´ë‹ˆì•„ í˜¸ìœ„ë¬´ì‚¬ -->
            <article class="staff-card">
              <div class="staff-header">
                <div>
                  <div class="staff-name">ì½”ë“œë„¤ì„: ë¸”ë ˆì´ë“œ</div>
                  <div class="staff-role">ì‚¬ë¬´ì†Œ ì „ì† í˜¸ìœ„ë¬´ì‚¬</div>
                </div>
                <div class="staff-pill">CLOSEÂ·COMBAT</div>
              </div>
              <div class="staff-tagline">
                â€œì§€ì›Œì•¼ í•  ê±´ ë°ì´í„°ë§Œì´ ì•„ë‹ˆë‹¤.â€
              </div>
              <div class="staff-body">
                ë§ìˆ˜ê°€ ì ê³ , ê¸°ë¡ë„ ê±°ì˜ ë‚¨ì•„ìˆì§€ ì•Šì€ ì¸ë¬¼.  
                ë„¤ì˜¨ ê³¨ëª© ëì—ì„œ ì†Œë¬¸ì²˜ëŸ¼ë§Œ ë“¤ë¦¬ë˜ â€œê²€ì€ í˜¸ìœ„ìâ€ì™€ ë™ì¼ ì¸ë¬¼ì´ë¼ëŠ” ì„¤ì´ ìˆë‹¤.  
                ì˜ë¢°ê°€ ì‹¤íŒ¨ ì§ì „ìœ¼ë¡œ ì¹˜ë‹¬ì„ ë•Œ, ë§ˆì§€ë§‰ì— íŒì„ ìˆ˜ìŠµí•˜ëŠ” ì—­í• .
              </div>
              <div class="staff-meta">
                <span>ì—­í• : ê·¼ì ‘ì „ / VIP ë³´í˜¸ / íšŒìˆ˜</span>
                <span>ëª©ê²© ê¸°ë¡: ê·¹íˆ í¬ë°•</span>
              </div>
            </article>
          </div>
        </div>

      </section>

      <!-- JOBS -->
            <!-- JOBS -->
            <section id="jobs" class="panel" style="display:none">
              <div class="nd-section-header">
                <div>
                  <h2>ì˜ë¢° ëª©ë¡</h2>
                  <p class="nd-section-caption">
                    ë„¤ì˜¤ë¦¬ë² ë¥´ ì „ì—­ì—ì„œ ìˆ˜ì§‘ëœ ì˜ë¢°ë“¤. ìœ„í—˜ë„ì™€ êµ¬ì—­ë³„ë¡œ í•„í„°ë§ë˜ëŠ”
                    <strong>ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œ ë‚´ë¶€ìš© ë¦¬ìŠ¤íŠ¸</strong>ì…ë‹ˆë‹¤.
                  </p>
                </div>
                <div class="nd-section-actions">
                  <input id="job-search"
                         placeholder="ê²€ìƒ‰: í•´í‚¹, ì ì…, ë°°ë‹¬..."
                         style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--text)" />
                  <button id="refreshJobs" class="btn micro">ê°±ì‹ </button>
                </div>
              </div>
      
              <!-- ì„¤ì •ì§‘ìš© ë­í¬ ì˜ë¢° 3ì¢… ìš”ì•½ -->
              <div class="nd-contract-grid">
                <article class="nd-contract-card nd-rank-s">
                  <div class="nd-contract-rank">S-RANK // BLACK OPS</div>
                  <div class="nd-contract-title">ë„ì‹œ êµ¬ì¡°ë¥¼ ë’¤í”ë“œëŠ” ê¸‰ì´ìƒì˜ ì˜ë¢°</div>
                  <div class="nd-contract-body">
                    ì •ê¶Œ êµì²´, ëŒ€ê·œëª¨ ë„¤íŠ¸ì›Œí¬ ë§ˆë¹„, ê³ ìœ„ ì¸ë¬¼ ì œê±° ê°™ì€
                    <strong>ë„ì‹œê¸‰ ì‚¬ê±´</strong>ì´ ì—¬ê¸°ì— ì†í•©ë‹ˆë‹¤.
                    ì‹¤íŒ¨ ì‹œ ë„¤ì˜¤ë¦¬ë² ë¥´ ì „ì²´ê°€ í”ë“¤ë¦¬ë¯€ë¡œ
                    ì…€ë ˆë¥´ë‹ˆì•„ì˜ ì§ì ‘ ìŠ¹ì¸ ì—†ì´ëŠ” ì—´ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.
                  </div>
                  <div class="nd-contract-meta">
                    <span>ê¶Œì¥ ì¸ì›: 3~5ì¸ ì…€ ë‹¨ìœ„</span>
                    <span>ë³´ìƒ: ìƒìƒ ì´ìƒ</span>
                  </div>
                </article>
      
                <article class="nd-contract-card nd-rank-a">
                  <div class="nd-contract-rank">A-RANK // CORE OPS</div>
                  <div class="nd-contract-title">ê¸°ì—… ìŠ¤íŒŒì´, í•µì‹¬ ìì‚° íƒˆì·¨</div>
                  <div class="nd-contract-body">
                    ê¸°ì—… íƒ€ì›Œ ì¹¨íˆ¬, ì¤‘ìš” ì¸ë¬¼ í˜¸ì†¡, ì‹¤í—˜ì²´ íšŒìˆ˜ ë“±
                    <strong>ë„ì‹œ í•µì‹¬ ì¸í”„ë¼</strong>ë¥¼ ê±´ë“œë¦¬ëŠ” ì˜ë¢°.
                    ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œì˜ ë©”ì¸ ìˆ˜ìµì›ìœ¼ë¡œ,
                    ì‹ ë¢°ë„ ë†’ì€ ë¸Œë¡œì»¤ì—ê²Œ ìš°ì„  ë°°ì •ë©ë‹ˆë‹¤.
                  </div>
                  <div class="nd-contract-meta">
                    <span>ê¶Œì¥ ì¸ì›: 2~3ì¸</span>
                    <span>í‰ê·  ë³´ìƒ: 1ë§Œ ~ 5ë§Œ creds</span>
                  </div>
                </article>
      
                <article class="nd-contract-card nd-rank-c">
                  <div class="nd-contract-rank">C-RANK // STREET OPS</div>
                  <div class="nd-contract-title">ë’·ê³¨ëª© ìƒí™œë°€ì°© ì˜ë¢°</div>
                  <div class="nd-contract-body">
                    ì‹¤ì¢…ëœ ë…¹ìŒ íŒŒì¼, ìœ„í—˜ êµ¬ì—­ ë°°ë‹¬, ì†Œê·œëª¨ ë³´ì•ˆ êµë€ ë“±.
                    <strong>í˜„ì¥ ê°ê°ì„ ìµíˆëŠ” ì—°ìŠµìš©</strong> ì˜ë¢°ë¡œ,
                    ì‹ ì… ë¸Œë¡œì»¤ë‚˜ ê²€ì¦ë˜ì§€ ì•Šì€ ì¸ì›ì—ê²Œ ë¨¼ì € ëŒì•„ê°‘ë‹ˆë‹¤.
                  </div>
                  <div class="nd-contract-meta">
                    <span>ê¶Œì¥ ì¸ì›: 1~2ì¸</span>
                    <span>í‰ê·  ë³´ìƒ: ìˆ˜ë°± ~ ìˆ˜ì²œ creds</span>
                  </div>
                </article>
              </div>
      
              <h3 style="margin:4px 0 6px 0;font-size:14px;">ì‹¤ì‹œê°„ ê²Œì‹œ ì˜ë¢°</h3>
      
              <div id="job-filters"
                   style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap">
                <button type="button" class="btn secondary micro job-filter"
                        data-status="all">ì „ì²´</button>
                <button type="button" class="btn secondary micro job-filter"
                        data-status="open">ì˜¤í”ˆ</button>
                <button type="button" class="btn secondary micro job-filter"
                        data-status="accepted">ì§„í–‰ì¤‘</button>
                <button type="button" class="btn secondary micro job-filter"
                        data-status="completed">ì™„ë£Œ</button>
              </div>
      
              <div id="jobs-list" style="margin-top:12px" class="list"></div>
            </section>
      
      <!-- INTEL -->
            <!-- INTEL -->
            <section id="intel" class="panel" style="display:none">
              <div class="nd-section-header">
                <div>
                  <h2>ì‹¤ì‹œê°„ ì¸í…” í”¼ë“œ</h2>
                  <p class="nd-section-caption">
                    ê°ì‹œë§ ë¡œê·¸, ì–¸ë”ë„· ë£¨ë¨¸, ì•”ì‹œì¥ ë¸Œë¦¬í•‘ì„ ì¡°í•©í•œ
                    <strong>NeoRivere ë¼ì´ë¸Œ ì •ë³´ ìŠ¤íŠ¸ë¦¼</strong>ì…ë‹ˆë‹¤.
                  </p>
                </div>
              </div>
      
              <div id="intel-list" class="nd-intel-grid"></div>
            </section>
      

            <!-- MAP -->
            <section id="map" class="panel" style="display:none">
              <div class="nd-section-header">
                <div>
                  <h2>NeoRivere êµ¬ì—­ ë§µ</h2>
                  <p class="nd-section-caption">
                    ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œ ì „ìš© <strong>ìœ„í—˜ë„ ë¸Œë¦¬í•‘ ë§µ</strong>.
                    êµ¬ì—­ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ ì˜¤ë¥¸ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.
                  </p>
                </div>
              </div>
      
              <div class="nd-map-layout">
                <div class="nd-map-detail">
                  <div class="nd-map-detail-title" id="map-detail-name">NeoRivere</div>
                  <div class="nd-map-detail-level" id="map-detail-level">
                    ìœ„í—˜ë„ ë ˆë²¨ / ê°ì‹œ ê°•ë„
                  </div>
                  <div class="nd-map-detail-desc" id="map-detail-desc">
                    ì™¼ìª½ì˜ êµ¬ì—­ ì¹´ë“œ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´, ì´ ìœ„ì¹˜ì˜ ì„¸ë¶€ ì„¤ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤.
                  </div>
                  <div class="nd-map-detail-key" id="map-detail-key">
                    í•µì‹¬ í¬ì¸íŠ¸: -
                  </div>
                </div>

                <div class="nd-map-holo" id="map-holo">
                  <div class="nd-map-holo-label">HOLOÂ·ZONE PROJECTION</div>
                  <div class="nd-map-holo-name" id="map-holo-name">-</div>
                  <div class="nd-map-holo-meta" id="map-holo-meta">LV.- / status: -</div>
              
                  <div class="nd-map-holo-grid">
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                    <div class="nd-map-holo-cell"></div>
                  </div>
                </div>

                <!-- HOLO-ZONE ì•„ë˜ ì‘ì „ ìš”ì•½ ë°•ìŠ¤ -->
<div class="nd-map-ops" id="map-ops">
  <div class="nd-map-ops-title">ì‘ì „ ìš”ì•½</div>
  <div class="nd-map-ops-grid">
    <div class="ops-item">
      <div class="label">ê¶Œì¥ ì¥ë¹„</div>
      <div class="value" id="ops-gear">
        êµ¬ì—­ì„ ì„ íƒí•˜ë©´ ê¶Œì¥ ì¥ë¹„ê°€ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
    <div class="ops-item">
      <div class="label">ì¶œëª° ì„¸ë ¥</div>
      <div class="value" id="ops-faction">-</div>
    </div>
    <div class="ops-item">
      <div class="label">ë¸Œë¡œì»¤ ë©”ëª¨</div>
      <div class="value" id="ops-note">-</div>
    </div>
  </div>
</div>
      
                <div class="map-grid" id="map-grid"></div>
              </div>
            </section>
      

            <!-- CONTACT -->
            <section id="contact" class="panel" style="display:none">
              <h2>ì…€ë ˆë¥´ë‹ˆì•„ í†µì‹  í—ˆë¸Œ</h2>
              <p class="small">
                ì´ ì±„ë„ì€ ë„¤ì˜¤ë¦¬ë² ë¥´ì˜ ì£¼ì¸ì¸ <strong>ì…€ë ˆë¥´ë‹ˆì•„</strong>ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¹„ê³µê°œ í†µì‹  ë¡œê·¸ì…ë‹ˆë‹¤.
                ì‚¬ë¬´ì†Œ ì§ì›, ì˜ë¢°ì¸, ë³´ì•ˆêµ­ì˜ ì ë“¤ì´ ë‚¨ê¸´ ë©”ëª¨ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.
              </p>
      
              <div class="contact-layout">
                <!-- ì…€ë ˆë¥´ë‹ˆì•„ê°€ ë©”ëª¨ ë‚¨ê¸°ëŠ” ìª½ -->
                <div class="contact-composer">
                  <div style="font-size:12px;color:var(--muted);margin-bottom:4px;">
                    ëŒ€ìƒ
                  </div>
                  <select id="contact-recipient"
                          style="width:100%;background:transparent;border:1px solid rgba(255,255,255,0.08);padding:6px 8px;border-radius:8px;color:var(--text);font-size:12px;">
                    <option value="ì‚¬ë¬´ì†Œ ì§ì›">ì‚¬ë¬´ì†Œ ì§ì›</option>
                    <option value="ì˜ë¢°ì¸">ì˜ë¢°ì¸</option>
                    <option value="ë³´ì•ˆêµ­">NSC Â· ê°ì‹œë§</option>
                    <option value="ê¸°íƒ€">NMC</option>
                  </select>
      
                  <textarea id="contact-input"
                            placeholder="ë‚¨ê¸¸ ë©”ëª¨ë¥¼ ì ìœ¼ì„¸ìš”. (ì˜ˆ: Ghost Alley ìˆœì°° ë³´ê³ , ì˜ë¢°ìì—ê²Œ ë‹µì¥ ë“±)"
                            style="margin-top:8px;width:100%;height:120px;background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:8px;color:var(--text);font-size:13px;"></textarea>
      
                  <div style="margin-top:8px;display:flex;gap:8px;">
                    <button id="contact-send" class="btn micro">ë©”ëª¨ ê¸°ë¡</button>
                    <button id="contact-clear" class="btn secondary micro">ì…ë ¥ ì§€ìš°ê¸°</button>
                  </div>
      
                  <div style="margin-top:6px;font-size:11px;color:var(--muted);">
                    â€» ì´ ë¡œê·¸ëŠ” <strong>í˜„ì¬ ë¸Œë¼ìš°ì €ì—ë§Œ ë¡œì»¬ ì €ì¥</strong>ë©ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.
                  </div>
                </div>
      
                <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ ì°½ -->
                <div class="contact-log-panel">
                  <div class="contact-log-header">
                    <div class="contact-log-title">ìµœê·¼ ëŒ€í™” ë¡œê·¸</div>
                    <div class="contact-log-caption">
                      ì‚¬ë¬´ì†Œ ì§ì›, ì˜ë¢°ì¸, ë³´ì•ˆêµ­ ìª½ì—ì„œ ì…€ë ˆë¥´ë‹ˆì•„ì—ê²Œ ë‚¨ê¸´ ë©”ì‹œì§€ê°€ ì •ë¦¬ë©ë‹ˆë‹¤.
                    </div>
                  </div>
      
                  <div id="contact-log" class="contact-log-list">
                    <!-- JSë¡œ ì±„ì›Œì§ -->
                  </div>
                </div>
              </div>
      
              <!-- ğŸ” ê¸°ì¡´ ì•”í˜¸í™” ë„êµ¬ëŠ” 'ê³ ê¸‰ ê¸°ëŠ¥'ìœ¼ë¡œ ì ‘ì–´ë‘ê¸° (ë²„íŠ¼/ID ìœ ì§€) -->
              <details style="margin-top:14px;font-size:12px;color:var(--muted);">
                <summary style="cursor:pointer;">
                  ê³ ê¸‰ ê¸°ëŠ¥: ì‹¤í—˜ìš© ì•”í˜¸í™” ë„êµ¬ ì—´ê¸°
                </summary>
                <div style="margin-top:8px;display:flex;gap:12px;align-items:flex-start;">
                  <textarea id="payload"
                            placeholder="ì‹¤í—˜ìš© ì•”í˜¸í™” ë©”ì‹œì§€..."
                            style="width:100%;height:100px;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:var(--text);"></textarea>
                  <div style="display:flex;flex-direction:column;gap:6px;min-width:120px;">
                    <button id="encryptBtn" class="btn micro">ì•”í˜¸í™” & ë³µì‚¬</button>
                    <button id="decryptBtn" class="btn secondary micro">ë³µí˜¸í™”</button>
                    <button id="clearPayload" class="btn secondary micro">ì§€ìš°ê¸°</button>
                  </div>
                </div>
              </details>
            </section>      

      <!-- MARKET -->
      <section id="Market" class="panel" style="display:none">
        <div class="scroll-panel">
          <h2 class="section-title">ğŸ›’ Black Market Exchange</h2>
          <div class="item-list"></div>
        </div>
      </section>
    </main>

    <footer class="panel" style="margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div style="color:var(--muted)">Â© 2098 NeoRivere</div>
        <div style="display:flex;gap:8px;align-items:center">
          <div style="font-size:12px;color:var(--muted)">ê¸€ë¦¬ì¹˜ ê°•ë„</div>
          <input id="glitchRange" type="range" min="0" max="6" value="2" style="width:140px" />
          <button id="showDev" class="btn micro">ì´ìŠ¤í„°ì—ê·¸</button>
        </div>
      </div>
    </footer>
  </div>

  <!-- Easter Egg button -->
  <div class="egg" title="SYSÂ·LAYER">
    <button id="eggBtn" style="padding:8px 10px;background:rgba(255,255,255,0.04);border-radius:8px;border:1px solid rgba(255,255,255,0.03);color:var(--muted)">SYSÂ·LAYER</button>
  </div>

  <!-- secret popup placeholder -->
  <div id="secretPopup" style="position:fixed;right:18px;bottom:92px;width:260px;background:rgba(0,0,0,0.8);border:1px solid rgba(0,255,150,0.12);padding:12px;border-radius:12px;display:none;z-index:60">
    <div style="color:var(--neon-emerald);font-weight:700;margin-bottom:8px">SECRET â€” ë¸Œë¡œì»¤ ì „ìš©</div>
    <div style="color:var(--muted);font-size:13px">ì´ ê³µê°„ì€ raven ì „ìš©ì…ë‹ˆë‹¤. ì™¸ë¶€ ë…¸ì¶œ ê¸ˆì§€.</div>
    <div style="margin-top:10px">
      <button id="clipSecret" class="btn micro">í´ë¦½ë³´ë“œ ë³µì‚¬(ë°ëª¨)</button>
    </div>
  </div>

  <script>
/* ===============================
   Data (jobs, intel, map, items)
   =============================== */
const SECRET_OWNER = 'raven';

const jobs = [
  { id: 'H-1001', title: "í—¬ë¦­ìŠ¤ ë¡œê·¸ ì •ë¦¬ â€” 'ì œë°œ ë¶€íƒí•´ìš”'", client: 'ê¹€. (ê°œì¸)', reward: 8000, tags: ['clean','forensics'], location: 'Mid-Arcology 3F', difficulty: 'Medium', desc: '"ì œ ì‹¤ìˆ˜ë¡œ ì—°êµ¬ì†Œ ì ‘ì† í”ì ì´ ë‚¨ì•˜ì–´ìš”. ì•„ì´ë“¤ ë•Œë¬¸ì— ì†Œë€ í”¼ìš°ê¸° ì‹«ìŠµë‹ˆë‹¤. ë¡œê·¸ì—ì„œ ì œ í”ì ì„ ì§€ì›Œì£¼ì„¸ìš”." â€” ê°œì¸ ì˜ë¢°ì¸', status: 'completed' },
  { id: 'H-1002', title: "ë¸”ë™ì…°ë„ìš° ì ì… â€” 'ê°€ì¡±ì„ êµ¬í•´ì£¼ì„¸ìš”'", client: 'ìµëª…', reward: 15000, tags: ['infiltrate','stealth'], location: 'Lower Docks', difficulty: 'High', desc: '"ë°°ì†¡ì°¨ë¡œ ìœ„ì¥í•´ì„œ êµ¬ì—­ì— ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤. ë‚´ë¶€ì—ì„œ íŠ¹ì • ë´‰íˆ¬ë¥¼ íšŒìˆ˜í•´ì•¼ í•´ìš”. ì¹˜ëª…ìƒì€ ì ˆëŒ€ ì•ˆ ë©ë‹ˆë‹¤." â€” ìµëª…', status: 'completed' },
  { id: 'J-9001', title: "ë°ì´í„° ìŠ¤í‚¤ë° â€” ì—°êµ¬ì†Œ ë¡œê·¸ (ê¸´ê¸‰)", client: 'ìµëª…(ì—°êµ¬ì›)', reward: 12000, tags: ['hack','stealth'], location: 'Mid-Arcology 7F', difficulty: 'High', desc: '"ì €ëŠ” í•´ë‹¹ ì—°êµ¬ì†Œì˜ ë‚´ë¶€ ì—°êµ¬ì›ì´ì§€ë§Œ ë‚´ë¶€ ê³ ë°œìì…ë‹ˆë‹¤. íŠ¹ì • í”„ë¡œì íŠ¸ì˜ ë¡œê·¸(2098-09 ~ 2098-11)ë¥¼ ì™¸ë¶€ë¡œ ë¹¼ë‚¼ ìˆ˜ ìˆë‚˜ìš”? ì¦ê±°ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ ëª¨ë‹ˆí„°ë§ì´ ì‹¬í•´ìš”."', status: 'open' },
  { id: 'J-9002', title: "ìŠ¤í˜ì…œ íŒ¨í‚¤ì§€ ë°°ë‹¬ â€” 'ê¸‰í•©ë‹ˆë‹¤'", client: 'ì†Œí˜• ê°±', reward: 2300, tags: ['delivery','fast'], location: 'Neon Market, Sector 3', difficulty: 'Low', desc: '"ì •í•´ì§„ ì‹œê°„(23:10-23:30)ì— Aâ†’B ì§€ì ìœ¼ë¡œ íŒ¨í‚¤ì§€ ì „ë‹¬. ê²‰ìœ¼ë¡œ ë³´ê¸°ì—” ìŒì‹ ë°°ë‹¬ì²˜ëŸ¼. ê°ì‹œê°€ ë‚®ì€ ì‹œê°„ëŒ€ì…ë‹ˆë‹¤. ì°¨ëŸ‰ ì œê³µ ê°€ëŠ¥."', status: 'open' },
  { id: 'J-9003', title: "ì•„ì´ì–¸ í¬ê²Ÿ â€” í‘œì  íšŒìˆ˜ (ë¯¼ê°)", client: 'ê¸°ì—…ì²­ë¶€', reward: 48000, tags: ['extraction','high-risk'], location: 'Corporate Spire 12', difficulty: 'Very High', desc: '"íšŒì‚¬ì˜ ë‚´ë¶€ ì»¨íƒì—ì„œ í‘œì ì„ ì•ˆì „í•˜ê²Œ ë°ë ¤ì˜¤ê¸¸ ì›í•¨. ë¹„ì¹˜ëª…ì  ì œì•• ê¶Œì¥. ê²½í˜¸ì› ë‹¤ìˆ˜, ê¶Œí•œ í† í°ì´ í•„ìš”í•  ìˆ˜ë„ ìˆìŒ."', status: 'open' },
  { id: 'J-9101', title: "ìŠ¤ë§ˆíŠ¸ ì„¼ì„œ êµë€ â€” ì´ë²¤íŠ¸", client: 'ì–¸ë”ë„· í¬ëŸ¼', reward: 9000, tags: ['electronic','timing'], location: 'Neon Market', difficulty: 'Medium', desc: '"ì‹œì¥ êµ¬ì—­ Aì˜ ì„¼ì„œê°€ 30ì´ˆ ë™ì•ˆ ë©ˆì¶°ì•¼ í•©ë‹ˆë‹¤. ìƒì¸ë“¤ì´ ì¼ì‹œì ìœ¼ë¡œ ì§„ì—´ì„ ë°”ê¿€ ìˆ˜ ìˆë„ë¡ êµë€ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ í•„ìš”."', status: 'open' },
  { id: 'J-9102', title: "ì€ìƒ‰ íŒ¨ìŠ¤ ìœ„ì¡° â€” ì¶œì… í—ˆê°€", client: 'ì†Œë§¤ìƒ', reward: 4200, tags: ['forge','low-risk'], location: 'Lower Docks', difficulty: 'Low', desc: '"ì„ì‹œ ì¶œì…ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¨ê¸°ê°„(4ì‹œê°„) ìœ íš¨í•œ ì¶œì… íŒ¨ìŠ¤ë¡œ, OCR ê²€ì¦ì„ ìš°íšŒí•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì‚¬ì§„ ë° ìµœì†Œ ì •ë³´ ì œê³µ ê°€ëŠ¥."', status: 'open' },
  { id: 'J-9201', title: "ìƒì–´ë²„ë¦° ë…¹ìŒ íšŒìˆ˜ â€” ì—„ë§ˆì˜ ëª©ì†Œë¦¬", client: 'ìµœ. (ì¼ë°˜)', reward: 3000, tags: ['recovery','sensitive'], location: 'Old Subway', difficulty: 'Low', desc: '"ì§€í•˜ì²  íì‡„ì—­ ê·¼ì²˜ì—ì„œ ë…¹ìŒíŒŒì¼ì„ ìƒì–´ë²„ë ¸ì–´ìš”. ì œê²Œ ì¤‘ìš”í•œ ëŒ€í™”ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. ë°ì´í„° ë³µêµ¬ê°€ ê°€ëŠ¥í• ê¹Œìš”? í”ŒëŸ¬ê·¸ë‚˜ ë¬¼ë¦¬ì  ì ‘ê·¼ ë‘˜ ë‹¤ ê°€ëŠ¥í•©ë‹ˆë‹¤."', status: 'open' },
  { id: 'J-9301', title: "êµ¬ì—­ A-9 ë°©í™”ë²½ í¬ë™", client: 'ì–¸ë”ë„· ìµëª…', reward: 16000, tags: ['hack','network'], location: 'Arcology 9F', difficulty: 'High', desc: '"ê¸°ì—… ë°©í™”ë²½ì— êµ¬ ë²„ì „ ì·¨ì•½ì ì´ ìˆì–´ìš”. ê±°ê¸°ì„œ íŠ¹ì • ë¡œê·¸ë¥¼ êº¼ë‚´ì•¼ í•´ìš”. ì ‘ê·¼ ê²½ë¡œëŠ” ì§ì ‘ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤."', status: 'open' },
  { id: 'J-9302', title: "í¬ê·€ ëª¨ë“ˆ ë°€ìˆ˜", client: 'ë¸”ë£¨ë§ˆì¼“ ìƒì¸', reward: 7200, tags: ['smuggling','delivery'], location: 'NeoRivere North Gate', difficulty: 'Medium', desc: '"ì •ì‹ ìœ í†µì´ ê¸ˆì§€ëœ AI-ì½”ì–´ ëª¨ë“ˆì…ë‹ˆë‹¤. ìŠ¤ìº”ì— ê±¸ë¦¬ì§€ ì•Šë„ë¡ ìš´ë°˜í•´ì£¼ì„¸ìš”."', status: 'open' },
  { id: 'J-9303', title: "ì§€í•˜ì—°ê²°ë§ ì ì…", client: 'í•˜ì¸µ ê°±', reward: 9800, tags: ['infiltrate','stealth'], location: 'Tunnel Sector 4', difficulty: 'High', desc: '"ë³´ê¸‰ì°½ê³  ë¬¸ì„ ì—´ê¸° ìœ„í•œ í‚¤ë¥¼ íšŒìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤. ì ë“¤ì˜ ì¥ë¹„ëŠ” êµ¬í˜•ì´ë¯€ë¡œ íšŒí”¼ ê°€ëŠ¥í•´ìš”."', status: 'open' },
  { id: 'J-9304', title: "êµ¬ì—­ C-11 ì‹¬ë¶€ë¦„", client: 'ì¼ë°˜ ì‹œë¯¼', reward: 900, tags: ['favor'], location: 'Block C-11', difficulty: 'Low', desc: '"ëª¸ì´ ë¶ˆí¸í•´ì„œ ê·¸ëŸ°ë°â€¦ ì´ ì•½ì„ ë³‘ì›ì— ì „ë‹¬í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”? ê·¸ëƒ¥ ë¶€íƒë“œë¦½ë‹ˆë‹¤."', status: 'open' },
  { id: 'J-9305', title: "ë°ì´í„° íŒ¨í‚· ì€ë°€ ë°°ë‹¬", client: 'í”„ë¦¬ëœì„œ í•´ì»¤', reward: 4100, tags: ['delivery','hack'], location: 'Undernet Node 2', difficulty: 'Medium', desc: '"ëˆ„êµ¬ì—ê²Œë„ ë“¤í‚¤ì§€ ì•Šê³  ì´ íŒ¨í‚·ì„ Node 2ì— ì—…ë¡œë“œí•˜ì„¸ìš”. ë¡œê·¸ëŠ” ë‚¨ê¸°ì§€ ë§ˆì„¸ìš”."', status: 'open' },
  { id: 'J-9306', title: "êµ¬í˜• ë¡œë´‡ íšŒìˆ˜", client: 'íê³µì¥ ì—°êµ¬ê°€', reward: 18000, tags: ['extraction'], location: 'Factory Sector', difficulty: 'High', desc: '"ë‚¡ì€ ë³´ì¡° ë¡œë´‡ í•˜ë‚˜ê°€ í™€ë¡œ ê°€ë™ ì¤‘ì…ë‹ˆë‹¤. ë¬´ë ¥í™”í•˜ì§€ ë§ê³  ê°€ì ¸ì˜¤ì„¸ìš”."', status: 'open' },
  {
    id: "S-000X",
    title: "âš ï¸ ëˆ„ë½ëœ ê¸°ë¡ â€” 'ë„ˆí¬ê°€ ë³¼ê²Œ ì•„ë‹Œë°â€¦'",
    client: "UNKNOWN",
    reward: 0,
    tags: ["glitch","error","forbidden"],
    location: "??",
    difficulty: "???",
    desc: "ê¸°ë¡ ì ‘ê·¼ ì˜¤ë¥˜. ë°ì´í„° íŒŒì†. <span class='glitch' data-text='ì ‘ê·¼ ê¸ˆì§€'>ì ‘ê·¼ ê¸ˆì§€</span>â€¦",
    status: "open"
  }
];

const intel = [
  { id: 'I-1', title: 'ì‹œë‚´ CCTV ë£¨íŠ¸ ì¬ì¡°ì •', time: '2098-11-18 02:12', trust: 'B+', tag: 'surveillance', body: 'ì¤‘ì•™ í†µì œì‹¤ì´ ìƒˆ ìŠ¤ì¼€ì¤„ì„ ë°°í¬ â€” ê³¼ê±° ë£¨íŠ¸ì™€ ì°¨ì´ ìˆìŒ. ì•¼ê°„ íŒ¨í„´ ì£¼ì˜.' },
  { id: 'I-2', title: 'ë¸”ë£¨ë²„ë“œ ë“œë¡  ë°°ì¹˜', time: '2098-11-20 21:04', trust: 'A-', tag: 'aerial', body: 'íŠ¹ì • êµ¬ì—­ ìƒê³µì— ê°ì‹œ ë“œë¡ ì´ ëŠ˜ì–´ë‚¨. ì „ìì „ ì¥ë¹„ ë³´ìœ  ê°€ëŠ¥.' },
  { id: 'I-3', title: 'íë¸Œ ë…¸ë“œ ì¬ë°°ì¹˜', time: '2098-11-21 01:30', trust: 'A', tag: 'network', body: 'ê¸°ì—… ë…¸ë“œë“¤ì´ íŠ¸ë˜í”½ ìš°íšŒ ê²½ë¡œë¥¼ ì„¤ì • â€” íŠ¹ì • êµ¬ê°„ì— ë ˆì´í„´ì‹œ ê¸‰ì¦.' },
  { id: 'I-4', title: 'ì •ì²´ë¶ˆëª… í†µì‹  ì‹ í˜¸', time: '2098-11-22 05:20', trust: 'C+', tag: 'signal', body: 'ë„ì‹œ ë™ë¶€ì—ì„œ ë¹„ì¸ê°€ ì£¼íŒŒìˆ˜ íƒì§€ë¨. ì§§ì€ ê°„ì„­ ë° ë°˜ë³µë˜ëŠ” íŒ¨í„´ ì¡´ì¬.' },
  { id: 'I-5', title: 'ê°±ë‹¨ ê°„ ì¶©ëŒ ë°œìƒ', time: '2098-11-22 13:44', trust: 'B', tag: 'gang', body: 'Chrome Jungles ì¸ê·¼ì—ì„œ ë¬´ì¥ ê°±ë‹¨ ì¶©ëŒ. ì ‘ê·¼ ê¸ˆì§€ ê¶Œê³ .' },
  { id: 'I-6', title: 'ê¸°ì—… ìŠ¤íŒŒì´ í¬ì°©', time: '2098-11-23 01:02', trust: 'A', tag: 'corp', body: 'Corporate Spire ë‚´ë¶€ì—ì„œ ë‚´ë¶€ì ì˜ì‹¬ ì¸ë¬¼ ê°ì§€ë¨. CCTV ì¼ë¶€ ì‚­ì œ ê¸°ë¡ ì¡´ì¬.' },
  { id: 'I-7', title: 'ì§€í•˜ì²  ë…¸ë“œ ê¶Œí•œ ìƒìŠ¹ ì‹œë„', time: '2098-11-23 02:50', trust: 'A-', tag: 'network', body: 'Old Subway ë„¤íŠ¸ì›Œí¬ì—ì„œ ë¹„ì¸ê°€ ë£¨íŠ¸ ê¶Œí•œ ìš”ì²­ ë°œìƒ. ì°¨ë‹¨ë¨.' },
  {
    id: "I-X",
    title: "ERROR://FEED_CORRUPTED",
    time: "2098-11-29 ??",
    trust: "?",
    tag: "glitch",
    body: "<span class='glitch' data-text='ë°ì´í„° ì†ìƒ'>ë°ì´í„° ì†ìƒ</span>: ê°ì‹œ ë„¤íŠ¸ì›Œí¬ê°€ ë¹„ì •ìƒ ë£¨í”„ë¥¼ ìƒì„± ì¤‘."
  },
  {
    id: "I-1",
    title: "ì‹œë‚´ CCTV ë£¨íŠ¸ ì¬ì¡°ì •",
    time: "2098-11-18 02:12",
    trust: "B+",
    tag: "surveillance",
    body: "ì¤‘ì•™ í†µì œì‹¤ì´ ìƒˆ ìŠ¤ì¼€ì¤„ì„ ë°°í¬ â€” ê³¼ê±° ë£¨íŠ¸ì™€ ë‹¤ë¥¸ íšŒì „ ì£¼ê¸°. ì•¼ê°„ì— ê°ì‹œ ì‚¬ê°ì´ ì‚¬ë¼ì§„ êµ¬ê°„ì´ ìˆìŒ."
  },
  {
    id: "I-2",
    title: "ë¸”ë£¨ë²„ë“œ ë“œë¡  ë°°ì¹˜",
    time: "2098-11-20 21:04",
    trust: "A-",
    tag: "aerial",
    body: "íŠ¹ì • ìƒê³µì— ê°ì‹œ ë“œë¡ ì´ ëŠ˜ì–´ë‚¨. ì¼ë¶€ ê¸°ì²´ëŠ” ì „ìì „ ì¥ë¹„ë¥¼ íƒ‘ì¬í•œ ê²ƒìœ¼ë¡œ ì¶”ì •ë¨."
  },
  {
    id: "I-3",
    title: "íë¸Œ ë…¸ë“œ ì¬ë°°ì¹˜",
    time: "2098-11-21 01:30",
    trust: "A",
    tag: "network",
    body: "ê¸°ì—… ë…¸ë“œë“¤ì´ íŠ¸ë˜í”½ ìš°íšŒ ê²½ë¡œë¥¼ ì„¤ì •. íŠ¹ì • êµ¬ê°„ì—ì„œ ë ˆì´í„´ì‹œ ê¸‰ì¦, ë°ì´í„° ë¤í”„ ì‹œë„ ê°€ëŠ¥ì„±."
  },
  {
    id: "I-4",
    title: "ì •ì²´ë¶ˆëª… í†µì‹  ì‹ í˜¸",
    time: "2098-11-22 05:20",
    trust: "C+",
    tag: "signal",
    body: "ë„ì‹œ ë™ë¶€ì—ì„œ ë¹„ì¸ê°€ ì£¼íŒŒìˆ˜ íƒì§€. ì§§ê³  ë°˜ë³µë˜ëŠ” íŒ¨í„´ì´ë©°, êµ¬í˜• NMC ì¥ë¹„ì—ì„œ ì“°ë˜ í¬ë§·ê³¼ ìœ ì‚¬í•˜ë‹¤ëŠ” ë³´ê³ ."
  },
  {
    id: "I-5",
    title: "ê°±ë‹¨ ê°„ ì¶©ëŒ ë°œìƒ",
    time: "2098-11-22 13:44",
    trust: "B",
    tag: "gang",
    body: "Chrome Jungles ì¸ê·¼ì—ì„œ ë¬´ì¥ ê°±ë‹¨ ì¶©ëŒ. NMC ì°¨ëŸ‰ì´ í˜„ì¥ì„ ìŠ¤ì³ ì§€ë‚˜ê°”ì§€ë§Œ, ê³µì‹ ê¸°ë¡ì—ì„œëŠ” ì œì™¸ë¨."
  },
  {
    id: "I-6",
    title: "ê¸°ì—… ìŠ¤íŒŒì´ í¬ì°©",
    time: "2098-11-23 01:02",
    trust: "A",
    tag: "corp",
    body: "Corporate Spire ë‚´ë¶€ì—ì„œ ë‚´ë¶€ì ì˜ì‹¬ ì¸ë¬¼ ê°ì§€. NSC ìª½ì—ì„œ ë¡œê·¸ ì¼ë¶€ë¥¼ íšŒìˆ˜í–ˆìœ¼ë‚˜, ì´ë¦„ ì¹¸ë§Œ ê²€ê²Œ ë§ˆìŠ¤í‚¹ë¨."
  },
  {
    id: "I-7",
    title: "ì§€í•˜ì²  ë…¸ë“œ ê¶Œí•œ ìƒìŠ¹ ì‹œë„",
    time: "2098-11-23 02:50",
    trust: "A-",
    tag: "network",
    body: "Old Subway ë„¤íŠ¸ì›Œí¬ì—ì„œ ë¹„ì¸ê°€ ë£¨íŠ¸ ê¶Œí•œ ìš”ì²­ ë°œìƒ. ìš”ì²­ì íƒœê·¸: 'OBSIDIAN-DIR', ì²˜ë¦¬ ê²°ê³¼: ìˆ˜ë™ìœ¼ë¡œ ì°¨ë‹¨ë¨."
  },
  {
    id: "I-8",
    title: "NSC ë‚´ë¶€ ì±„ë„ ë¡œê·¸ ì¡°ê° ìœ ì¶œ",
    time: "2098-11-23 04:12",
    trust: "A",
    tag: "NSC",
    body: "NSC ë‚´ë¶€ ì±„ë„ì—ì„œ ì˜ë ¤ ë‚˜ê°„ ë¡œê·¸ ì¡°ê°ì´ ì–¸ë”ë„·ì— ë– ëŒê³  ìˆìŒ. ìˆ˜ì‹ ì ì¹¸ì— 'ì…€ë ˆë¥´ë‹ˆì•„'ë¼ëŠ” ë¬¸ìì—´ì´ ë‚¨ì•„ ìˆìœ¼ë‚˜, ìœ„ì— ê²€ì€ ë¸”ë¡ì´ ê²¹ì³ì ¸ ìˆìŒ."
  },
  {
    id: "I-9",
    title: "NMC ì•¼ê°„ ì •ë¹„ ë£¨íŠ¸ ì´ìƒ",
    time: "2098-11-23 05:33",
    trust: "B+",
    tag: "NMC",
    body: "NMC ì •ë¹„ë°˜ì´ Ghost Alleyì™€ Lower Docks ì‚¬ì´ êµ¬ê°„ì„ ë°˜ë³µ ìˆœíšŒ. ê³µì‹ ì •ë¹„ ì¼ì •ì—ëŠ” ì—†ëŠ” ë£¨íŠ¸ë¡œ, ë¬´ì—‡ì¸ê°€ë¥¼ ìˆ¨ê¸°ê±°ë‚˜ íšŒìˆ˜ ì¤‘ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ."
  }
];

const mapZones = [
  { id: 'Z-1', name: 'Neon Market', level: 2, hazard: 'medium', desc: 'ìƒì ê³¼ ì•”ì‹œì¥ í˜¼ì¬. ê°ì‹œ ë¹ˆë„ëŠ” ë‚®ìŒ.', key: 'í›„ë¯¸ ê³¨ëª©ì˜ ìƒì ì°½ê³  â€” êµí™˜ í¬ì¸íŠ¸' },
  { id: 'Z-2', name: 'Mid-Arcology', level: 5, hazard: 'high', desc: 'ê³ ì¸µ ì—°êµ¬/ê¸°ì—… êµ¬ì—­. ë³´ì•ˆ ë ˆì´ì–´ê°€ ë¹½ë¹½í•¨.', key: 'ë³´ì•ˆ ì—˜ë¦¬ë² ì´í„° ë£¨íŠ¸ê°€ í•µì‹¬' },
  { id: 'Z-3', name: 'Lower Docks', level: 3, hazard: 'variable', desc: 'ë°°í›„ ê±°ë˜ì™€ ì†Œê·œëª¨ ê°± í™œë™. ì•¼ê°„ì´ í™œë°œí•¨.', key: 'ì»¨í…Œì´ë„ˆ ì‚¬ì´ ì€ë°€í•œ í†µë¡œ' },
  { id: 'Z-4', name: 'Old Subway', level: 2, hazard: 'low', desc: 'ì¸ì ì´ ë“œë¬¸ ì§€í•˜ í†µë¡œ â€” ì „ì ê°ì‹œ êµ¬ë©ì´ ë§ìŒ.', key: 'íì‡„ì—­ í”Œë«í¼ B' },
  { id: 'Z-5', name: 'Corporate Spire', level: 6, hazard: 'very high', desc: 'ê¸°ì—… í•µì‹¬ êµ¬ì—­ â€” ì ‘ê·¼ì‹œ í—ˆê°€ í•„ìš”.', key: 'ì˜¥ìƒ í†µì‹  ë…¸ë“œ' },
  { id: 'Z-6', name: 'Ghost Alley', level: 4, hazard: 'extreme', desc: 'ì‹¤ì¢… ì‹ ê³ ê°€ ë°˜ë³µë˜ëŠ” êµ¬ì—­. ì „íŒŒ ê°„ì„­ ì‹¬í•¨.', key: 'ë…¹ìŠ¨ ì „ì‹ ì£¼ ì•„ë˜' },
  { id: 'Z-7', name: 'Chrome Jungles', level: 6, hazard: 'very high', desc: 'ë°˜ê¸ˆì† ìƒì²´ì‹¤í—˜ í”ì . ì ‘ê·¼ ì‹œ ì‹ í˜¸ ì™œê³¡.', key: 'íë‹¨ì§€ ë‚´ë¶€ ì‹¤í—˜ì‹¤' },
  { id: 'Z-8', name: 'Holo District', level: 3, hazard: 'medium', desc: 'í™€ë¡œê·¸ë¨ ê´‘ê³ ì™€ ê°€ì§œ êµ¬ì¡°ë¬¼ íˆ¬ì„±ì´. ì‹œì•¼ êµë€ ë†’ìŒ.', key: 'ê´‘ê³ íŒ¨ë„ ë’¤ ìˆ¨ê²¨ì§„ ìœ ì§€ë³´ìˆ˜ í†µë¡œ' },
  { id: 'Z-9', name: 'Echo Labyrinth', level: 5, hazard: 'high', desc: 'ì†Œë¦¬ ë°˜ì‚¬ êµ¬ì¡° ì§€í•˜ ë¯¸ë¡œ. GPS í˜¼ì„  ì‹¬ê°.', key: 'ìŒí–¥ ë°˜ì‚¬ì  ê·¼ì²˜, ë¹„ë°€ ì²´í¬í¬ì¸íŠ¸' },
  { id: 'Z-10', name: 'Blackwater Sewage', level: 6, hazard: 'extreme', desc: 'í•˜ìˆ˜ì™€ ì‚°ì—… íê¸°ë¬¼ì´ ì„ì´ëŠ” ì§€ì €ë¶„í•œ êµ¬ì—­.', key: 'íìˆ˜ ì²˜ë¦¬ì„¼í„° ë’¤ìª½ ì ê¸ˆ ë°¸ë¸Œ' },
  { id: 'Z-11', name: 'Skybridge Arrays', level: 4, hazard: 'variable', desc: 'ê³ ì¸µ ì‚¬ì´ ê°€êµë“¤ì´ ì—°ê²°ëœ ê²½ë¡œ. ë‚™í•˜ ì£¼ì˜.', key: 'ë™ìª½ ë¸Œë¦¿ì§€ ëë‹¨ ì „ìíŒ¨ë„' },
  { id: 'Z-12', name: 'Silent Clinic', level: 2, hazard: 'low', desc: 'ë²„ë ¤ì§„ ì˜ë£Œì‹œì„¤. ì „ì›ì´ ëŠê¸´ ê¸°ê³„ë“¤ë¿.', key: 'ì§„ë£Œì‹¤ 4ë²ˆ ë’¤ ìºë¹„ë„·' },
  { id: 'Z-13', name: 'Nova Plant', level: 6, hazard: 'very high', desc: 'ì—ë„ˆì§€ ê³µì¥. ê³ ì•• ì¥ì¹˜ ë‹¤ìˆ˜.', key: 'ëƒ‰ê°ìˆ˜ ì¡°ì ˆ í„°ë¯¸ë„' },
  {
    id: "Z-X",
    name: "Ghost Frequency Zone",
    level: 9,
    hazard: "unknown",
    desc: "ì „íŒŒì™€ í˜„ì‹¤ì´ ê²¹ì¹œë‹¤. ë“œë¡ ê³¼ ì¸ê°„ ëª¨ë‘ ì„¼ì„œ ì˜¤ë¥˜ ë°œìƒ.",
    key: "<span class='glitch' data-text='!! ì ‘ê·¼ ê¸ˆì§€ !!'>!! ì ‘ê·¼ ê¸ˆì§€ !!</span>"
  }
];

const items = [
  { id: 'IT-1', name: 'ì‹œê·¸ë„ ìŠ¤í¬ë¨ë¸”ëŸ¬', desc: 'ë‹¨ì‹œê°„ ë“œë¡ /ê°ì‹œì™€ í†µì‹  ì°¨ë‹¨', price: 1800, stock: 3 },
  { id: 'IT-2', name: 'Temp ID Chip', desc: 'ì„ì‹œ ì¶œì…ì¦ ì—ë®¬ë ˆì´í„°', price: 950, stock: 8 },
  { id: 'IT-3', name: 'EMP íŒ©(ì†Œí˜•)', desc: 'ì „ìê¸° í„ìŠ¤ë¡œ ì¥ë¹„ ë§ˆë¹„', price: 4200, stock: 1 },
  { id: 'IT-4', name: 'ìŠ¤í…”ìŠ¤ í•„ë¦„', desc: 'ì¹´ë©”ë¼Â·ì„¼ì„œ íˆ¬ëª…í™” íš¨ê³¼ 40ì´ˆ', price: 3200, stock: 5 },
  { id: 'IT-5', name: 'ë‚˜ë…¸ ë½í”½', desc: 'ê³ ê¸‰ ìë¬¼ì‡ /íŒ¨ë„ ì¹¨íˆ¬', price: 2700, stock: 6 },
  { id: 'IT-6', name: 'ìŠ¤í™íŠ¸ëŸ¼ í‚¤', desc: 'ë³´ì•ˆ íŒ¨ë„ ì»¬ëŸ¬ ì‹œí”„íŠ¸ ìš°íšŒ', price: 1500, stock: 10 },
  { id: 'IT-7', name: 'EMP ë§(ì¤‘í˜•)', desc: 'ë°˜ê²½ 6m ì „ìì¥ 1íšŒ ì°¨ë‹¨', price: 6300, stock: 2 },
  { id: 'IT-8', name: 'ì§€ë¬¸ í¬ê±°', desc: 'ì§€ë¬¸ í”ì  ìë™ ìœ„ì¡° ë° ì œê±°', price: 1100, stock: 12 },
  { id: 'IT-9', name: 'EX-íŒ¨í‚· ì¸ì í„°', desc: 'ë„¤íŠ¸ì›Œí¬ ìŠ¤í‘¸í•‘ í‚¤íŠ¸', price: 4800, stock: 3 },
  { id: 'IT-10', name: 'ì–¸ë”ë¡œë“œ íŒ¨ìŠ¤', desc: 'ì§€í•˜ êµ¬ê°„ ì´ë™ìš© ìµëª… íŒ¨ìŠ¤', price: 900, stock: 8 },
  { id: 'IT-11', name: 'ê³ ìŠ¤íŠ¸ ë¼ìš°í„°',       desc: 'íŠ¸ë˜í”½ì„ ì—¬ëŸ¬ ê°€ì§œ ë…¸ë“œë¡œ ë¶„ì‚°',      price: 5200, stock: 4 },
  { id: 'IT-12', name: 'ë°”ì´ì˜¤ ì‹ ë¶„ íŒ¨ì¹˜',    desc: 'ì§€ë¬¸Â·ë§¥ë°• íŒ¨í„´ 30ë¶„ê°„ ìœ„ì¥',           price: 3900, stock: 5 },
  { id: 'IT-13', name: 'ë“œë¡  ì¬í”„ë¡œê·¸ë¨ í‚¤íŠ¸',desc: 'ìƒì—…ìš© ë“œë¡  ì¼ì‹œì  ì œì–´ íƒˆì·¨',        price: 6100, stock: 2 },
  { id: 'IT-14', name: 'í™”ì´íŠ¸ ë…¸ì´ì¦ˆ ë¹„ì»¨',  desc: 'ì£¼ë³€ 5m ê°ì²­Â·ë„ì²­ ì¥ë¹„ êµë€',          price: 2500, stock: 7 },
  { id: 'IT-15', name: 'í•˜ì´ì¬í‚¹ ê¸€ëŸ¬ë¸Œ',     desc: 'ê·¼ì ‘ NFC/ìŠ¤ë§ˆíŠ¸ë½ ê°•ì œ í•¸ë“œì…°ì´í¬',    price: 3400, stock: 4 },
  { id: 'IT-16', name: 'ë¡œìš°íŒŒì›Œ EMP ì¹©',     desc: 'ì†Œí˜• ì¥ë¹„ë§Œ ì„ íƒì ìœ¼ë¡œ ë§ˆë¹„',         price: 2600, stock: 6 },
  { id: 'IT-17', name: 'ì‹ í˜¸ ì”ìƒ ìƒì„±ê¸°',    desc: 'ê°€ì§œ ìœ„ì¹˜Â·ì´ë™ ê²½ë¡œë¥¼ ë¡œê·¸ì— ë‚¨ê¹€',    price: 4500, stock: 3 },
  { id: 'IT-18', name: 'ì„€ë„ìš° ìº¡ìŠ',         desc: 'ëª¸ì— ë¶€ì°©í•˜ëŠ” ë‹¨ì‹œê°„ ì—´ ì‹ í˜¸ ì°¨ë‹¨ ìº¡ìŠ',price: 3700, stock: 5 },
];

const defaultContactLog = [
  {
    id:'L-1',
    from:'ì‚¬ë¬´ì†Œ ì§ì› Â· NSC ì¶œì‹  ì„œí¬í„°',
    to:'ì…€ë ˆë¥´ë‹ˆì•„',
    kind:'staff',
    time:'2098-11-22 03:14',
    body:'ë³´ì•ˆêµ­ ë‚´ë¶€ë§ì—ì„œ ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œ ê´€ë ¨ í‚¤ì›Œë“œê°€ ê³„ì† ëœ¨ê³  ìˆì–´ìš”. ë¡œê·¸ëŠ” ìµœëŒ€í•œ ì§€ì› ëŠ”ë°, íŒ¨í„´ì´ ì¢€ ì´ìƒí•©ë‹ˆë‹¤.'
  },
  {
    id:'L-2',
    from:'ì˜ë¢°ì¸ Â· "ì—„ë§ˆì˜ ëª©ì†Œë¦¬" ì˜ë¢°ì',
    to:'ì…€ë ˆë¥´ë‹ˆì•„',
    kind:'client',
    time:'2098-11-22 09:47',
    body:'ì§€í•˜ì²  íì‡„ì—­ ê·¼ì²˜ì—ì„œ ë…¹ìŒ íŒŒì¼ì„ ì°¾ì•˜ë‹¤ëŠ” ì—°ë½, ì˜ ë°›ì•˜ìŠµë‹ˆë‹¤. ì œ ìª½ ê¸°ë¡ì€ ì•½ì†ëŒ€ë¡œ ëª¨ë‘ ì§€ì›Œ ì£¼ì„¸ìš”.'
  },
  {
    id:'L-3',
    from:'ì‚¬ë¬´ì†Œ í˜¸ìœ„ë¬´ì‚¬',
    to:'ì…€ë ˆë¥´ë‹ˆì•„',
    kind:'staff',
    time:'2098-11-22 18:01',
    body:'ì˜¤ëŠ˜ ë°¤ Ghost Alley êµ¬ì—­ì€ í‰ì†Œë³´ë‹¤ ì¡°ìš©í•©ë‹ˆë‹¤. ëŒ€ì‹  í•˜ëŠ˜ì— ë„ëŠ” ë“œë¡  ìˆ˜ê°€ ì¡°ê¸ˆ ëŠ˜ì—ˆìŠµë‹ˆë‹¤.'
  },
  {
    id:'L-4',
    from:'[ë³´ì•ˆêµ­ ê°ì‹œ ë¡œê·¸ ì¡°ê°]',
    to:'ì…€ë ˆë¥´ë‹ˆì•„',
    kind:'enemy',
    time:'2098-11-23 00:12',
    body:'â€¦NEORIVERE NODE ì ‘ì† ê¸°ë¡ íƒì§€â€¦\nì‹ ì›: ë¹„ì‹ë³„. íƒœê·¸: "ì…€ë ˆë¥´ë‹ˆì•„" (ë¹„ê³µì‹ ì½”ë“œë„¤ì„). ë¶„ì„ ëŒ€ê¸° ì¤‘.'
  },
  {
    id: "L-5",
    timestamp: "2098-11-22 03:14",
    from: "SYSTEM // UNDERNET ROUTER",
    channel: "[SYS//NEORIVERE-ROUTER]",
    body: "NSC ë©”ì¸ ë…¸ë“œê°€ í•˜ì¸µ ì–¸ë”ë„·ì—ì„œ ë¹„ì¸ê°€ ë¸Œë¡œì»¤ ì„¸ì…˜ì„ íƒì§€í–ˆìŠµë‹ˆë‹¤. ìˆ˜ì‹ ì íƒœê·¸: 'ì…€ë ˆë¥´ë‹ˆì•„'. ë¼ìš°íŒ… í…Œì´ë¸” ìˆ˜ë™ ìˆ˜ì •ìœ¼ë¡œ ì¶”ì ì´ ì‹¤íŒ¨í–ˆë‹¤ëŠ” ê¸°ë¡ë§Œ ë‚¨ê²¨ì¡ŒìŠµë‹ˆë‹¤."
  },
  {
    id: "L-6",
    timestamp: "2098-11-22 03:40",
    from: "NSC-KID",
    channel: "[STAFF//NSC-KID]",
    body: "ë³´ìŠ¤, NSC ìƒì¸µ ë¡œê·¸ ì¼ë¶€ë¥¼ ë¹¼ ì™”ì–´ìš”. NMC ì•¼ê°„ ì •ë¹„ ë£¨íŠ¸ë‘ ê²¹ì¹˜ëŠ” ì‹œê°„ëŒ€ì—ë§Œ CCTVê°€ ë™ì‹œì— 3ëŒ€ì”© ëˆˆì„ ê°ì•„ìš”. ì´ê±´ ìš°ì—°ì´ ì•„ë‹ˆì—ìš”. í•„ìš”í•˜ë©´ ì›ë³¸ ë¡œê·¸ë„ ì˜¬ë ¤ë‘˜ê²Œìš”."
  },
  {
    id: "L-7",
    timestamp: "2098-11-22 04:02",
    from: "NMC í˜„ì¥ ì •ë¹„ë°˜",
    channel: "[NMC-FIELD-03]",
    body: "ê³µì‹ ë³´ê³ ì„œëŠ” NSC ìª½ìœ¼ë¡œë§Œ ì˜¬ë¼ê°€ë‹ˆê¹Œ, ì—¬ê¸°ì—ëŠ” ì§„ì§œ ìƒí™©ì„ ë‚¨ê²¨ë‘˜ê²Œìš”. Ghost Alley ë°°ì„  ë’¤ì—ì„œ ëˆ„êµ°ê°€ ì„¤ì¹˜í•´ ë‘” ë¹„ì¸ê°€ ë¼ì¸ì„ ë°œê²¬í–ˆëŠ”ë°, ì¶”ì  íƒœê·¸ì— 'OBSIDIAN-DIR'ê°€ ì°í˜€ ìˆì—ˆì–´ìš”. ìš°ë¦° ëª» ë³¸ ê±¸ë¡œ í•˜ê² ìŠµë‹ˆë‹¤."
  },
  {
    id: "L-8",
    timestamp: "2098-11-22 04:33",
    from: "ìµëª… ì˜ë¢°ì",
    channel: "[CLIENT//ANON]",
    body: "NMC ì •ë¹„ ì¼ì •ì´ ì—…ë°ì´íŠ¸ë˜ê¸° ì „ì— ì›€ì§ì—¬ì•¼ í•´ìš”. NSCê°€ ì œ ê°€ì¡±ì„ 'ë³´í˜¸ ëŒ€ìƒ'ìœ¼ë¡œ ì˜¬ë ¤ë²„ë ¸ìŠµë‹ˆë‹¤. ê·¸ ë§ì€ ê³§ ê°ì‹œ ëŒ€ìƒì´ë¼ëŠ” ëœ»ì´ê±°ë“ ìš”. ì ‘ì„  ì‹œê°„ê³¼ ì¥ì†ŒëŠ” ì œê°€ ì§€ì •í•˜ëŠ” ëŒ€ë¡œ, ë‹¨ í•œ ë²ˆë§Œ."
  },
  {
    id: "L-9",
    timestamp: "2098-11-22 05:10",
    from: "OLD CH. ê¸°ë¡ ì¡°ê°",
    channel: "[OLD-CHANNEL//FRAGMENT]",
    body: "â€¦NSC ê°€ë™ ì „, NMCê°€ ì²˜ìŒìœ¼ë¡œ ë„ì‹œ í•˜ì¸µì„ ë´‰ì¸í•˜ë˜ ë‚  ë‚¨ê²¨ì§„ ë¡œê·¸ì…ë‹ˆë‹¤. 'ì…€ë ˆë¥´ë‹ˆì•„, ë„¤ê°€ ì´ ë„ì‹œì˜ ë§ˆì§€ë§‰ ë°±ì—…ì´ ë  ê±°ì•¼.' ë¼ëŠ” ë¬¸ì¥ë§Œ ë‚¨ê³  ë‚˜ë¨¸ì§€ëŠ” ì „ë¶€ ê²€ê²Œ íƒœì›Œì¡ŒìŠµë‹ˆë‹¤."
  }
];

let contactLog = [];
try{
  const saved = JSON.parse(localStorage.getItem('oc_contact_log') || '[]');
  if(Array.isArray(saved) && saved.length){
    contactLog = saved;
  } else {
    contactLog = defaultContactLog.slice();
  }
}catch(e){
  contactLog = defaultContactLog.slice();
}

/* ================
   App State
   ================ */
const state = {
  wallet: Number(localStorage.getItem('oc_wallet') || 5000),
  purchases: JSON.parse(localStorage.getItem('oc_purchases') || '[]'),
  users: JSON.parse(localStorage.getItem('oc_users') || '{}'),
  logged: JSON.parse(localStorage.getItem('oc_logged') || '{}'),
  secretUnlocked: false,
  contactsLog: JSON.parse(localStorage.getItem('oc_contactsLog') || '[]'),
};

// ì—°ë½ ë¡œê·¸ê°€ ë¹„ì–´ ìˆìœ¼ë©´, ìƒ˜í”Œ ë¡œê·¸ ëª‡ ê°œ ì±„ì›Œë‘ê¸° (ì²˜ìŒ ì ‘ì†ìš©)
if (!state.contactsLog || state.contactsLog.length === 0) {
  state.contactsLog = [
    {
      id: 'LOG-BOOT-1',
      ts: Date.now() - 1000 * 60 * 60 * 5,
      from: "ì‚¬ë¬´ì†Œ ì§ì› Â· K-17",
      targetType: "staff",
      targetName: "ì…€ë ˆë¥´ë‹ˆì•„",
      direction: "in",
      content: "ì˜¤ëŠ˜ 23:00, Lower Docks ì ‘ì„  ì¤€ë¹„ ì™„ë£Œ. â€” ê¸°ì¡´ ê³„íšëŒ€ë¡œ ì§„í–‰í•©ë‹ˆë‹¤."
    },
    {
      id: 'LOG-BOOT-2',
      ts: Date.now() - 1000 * 60 * 30,
      from: "ìµëª… ì˜ë¢°ì¸",
      targetType: "client",
      targetName: "ì…€ë ˆë¥´ë‹ˆì•„",
      direction: "in",
      content: "\"ë³´ì•ˆêµ­ì´ ì œ ë’¤ë¥¼ ë°Ÿê³  ìˆì–´ìš”. ê¸°ë¡ì— ì œ ì´ë¦„ì€ ë‚¨ê¸°ì§€ ë§ì•„ì£¼ì„¸ìš”.\""
    }
  ];
  localStorage.setItem('oc_contactsLog', JSON.stringify(state.contactsLog));
}

let jobStatusFilter = 'all';   // ğŸ”¹ ì˜ë¢° ìƒíƒœ í•„í„°
let currentJobFlow = null;   // ì§€ê¸ˆ ì§„í–‰ ì¤‘ì¸ ì˜ë¢° í”Œë¡œìš° ìƒíƒœ

/* ================
   Helpers & Rendering
   ================ */
function $(sel){ return document.querySelector(sel) }
function $all(sel){ return Array.from(document.querySelectorAll(sel)) }

function renderSummary(){
  $('#completed-count').textContent = jobs.filter(j=>j.status==='completed').length;
  $('#open-count').textContent = jobs.filter(j=>j.status==='open').length;
  $('#jobs-count').textContent = jobs.length;
  $('#wallet').textContent = state.wallet + ' creds';
  $('#wallet-count').textContent = state.wallet;
  $('#who').textContent = Object.keys(state.logged).length ? Object.keys(state.logged).join(', ') : 'ì—†ìŒ';
  $('#secretState').textContent = state.logged[SECRET_OWNER] ? 'ì—´ë¦¼' : 'ì ê¹€';
  renderRecent();
  renderJobs();
  renderIntel();
  renderMap();
  renderMarket();
  renderPurchases();
  renderContactLog();
}

function renderContactLog(){
  const wrap = $('#contact-log');
  if (!wrap) return;

  if (!contactLog.length){
    wrap.innerHTML =
      '<div class="contact-log-empty">ì•„ì§ ê¸°ë¡ëœ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }

  wrap.innerHTML = '';
  contactLog.slice().reverse().forEach(log=>{
    const el = document.createElement('div');
    el.className = 'contact-log-entry';

    const kind =
      log.kind === 'staff'  ? 'STAFF'  :
      log.kind === 'client' ? 'CLIENT' :
      log.kind === 'enemy'  ? 'ENEMY'  :
                              'LOG';

    const safeBody = (log.body || '')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');

    el.innerHTML = `
      <div class="contact-log-meta">
        <div>
          <span class="contact-log-from">${log.from}</span>
          <span class="contact-log-to"> â†’ ${log.to}</span>
          <span class="contact-log-kind">[${kind}]</span>
        </div>
        <div>${log.time || ''}</div>
      </div>
      <div class="contact-log-body">${safeBody}</div>
    `;
    wrap.appendChild(el);
  });
}

function addContactEntry(from, to, kind, body){
  const entry = {
    id: 'L-' + Date.now().toString(36),
    from,
    to,
    kind,
    body,
    time: new Date().toLocaleString()
  };
  contactLog.push(entry);
  try{
    localStorage.setItem('oc_contact_log', JSON.stringify(contactLog));
  }catch(e){}
  renderContactLog();
}

function renderRecent(){
  const list = $('#recent-list'); 
  list.innerHTML = '';
  jobs.slice(0,6).forEach(j=>{
    const el = document.createElement('div'); 
    el.className='job';
    el.innerHTML = `
      <div style="display:flex;justify-content:space-between">
        <div>
          <div style="font-weight:700">${j.title}</div>
          <div class="meta">${j.location} Â· ë³´ìƒ: ${j.reward} Â· ìƒíƒœ: ${j.status}</div>
        </div>
        <div style="font-size:12px;color:var(--muted)">${j.client}</div>
      </div>
      <p style="margin-top:8px;color:var(--muted)">${j.desc}</p>`;
    list.appendChild(el);
  });
}

function renderJobs(filter = '') {
  const list = $('#jobs-list');
  list.innerHTML = '';

  jobs
    .filter(j =>
      (j.title + j.tags.join(' ') + j.client + j.status + j.desc)
        .toLowerCase()
        .includes(filter.toLowerCase())
    )
    .filter(j => jobStatusFilter === 'all' ? true : j.status === jobStatusFilter)
    .forEach(j => {
      const el = document.createElement('div');
      el.className = 'job';

      const openBtn = j.status === 'open'
        ? `<button class="btn micro" data-accept="${j.id}">ìˆ˜ë½</button>`
        : '';

      const statusLabel =
        j.status === 'open'
          ? 'open'
          : (j.status === 'accepted' ? 'progress' : 'completed');

      const statusColor =
        j.status === 'open' ? 'var(--neon-emerald)' :
        j.status === 'accepted' ? '#ffc24c' :
        'var(--neon-pink)';

      el.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">${j.title}</div>
            <div class="meta">
              í´ë¼ì´ì–¸íŠ¸: ${j.client}
              Â· ë³´ìƒ: ${j.reward} creds
              Â· ìƒíƒœ:
              <span style="color:${statusColor};font-weight:600;">
                ${statusLabel}
              </span>
            </div>
          </div>

          <div style="display:flex;flex-direction:column;gap:6px">
            ${openBtn}
            <button class="btn secondary micro" data-view="${j.id}">ë³´ê¸°</button>
          </div>
        </div>
      `;

      list.appendChild(el);
    });

  // âœ… ìˆ˜ë½ ë²„íŠ¼ â†’ ë°”ë¡œ accepted ì²˜ë¦¬ + í”Œë¡œìš° ëª¨ë‹¬ ì—´ê¸°
  $all('button[data-accept]').forEach(b => {
    b.onclick = (e) => {
      const id = e.currentTarget.dataset.accept;
      const job = jobs.find(x => x.id === id);
      if (!job) return;

      // ì²˜ìŒ ìˆ˜ë½ì¼ ë•Œ ìƒíƒœ ë³€ê²½
      if (job.status === 'open') {
        job.status = 'accepted';
      }

      playSfx('sfx-success');
      openJobFlowModal(job);   // ğŸ”¹ ìƒˆë¡œ ë§Œë“¤ í”Œë¡œìš° ëª¨ë‹¬ ì—´ê¸°
      renderSummary();
      setView('jobs');
    };
  });

  // ë³´ê¸° ë²„íŠ¼ â†’ ê¸°ì¡´ ë””í…Œì¼ ëª¨ë‹¬
  $all('button[data-view]').forEach(b => b.onclick = (e) => {
    const id = e.currentTarget.dataset.view;
    const j = jobs.find(x => x.id === id);
    if (!j) return;
    openJobModal(j);
  });
}

function openBrokerModal(){
  const m = document.getElementById('brokerModal');
  if(m) m.style.display = 'block';
}

function closeBrokerModal(){
  const m = document.getElementById('brokerModal');
  if(m) m.style.display = 'none';
}


function renderIntel(){
  const list = $('#intel-list'); 
  if (!list) return;

  list.innerHTML = '';
  intel.forEach(i=>{
    const el = document.createElement('article'); 
    el.className = 'nd-intel-card';

    // ğŸ”¹ ë‚˜ì¤‘ì— í•˜ì´ë¼ì´íŠ¸ì— ì‚¬ìš©í•  íƒœê·¸/ID ì €ì¥
    el.dataset.id = i.id;
    el.dataset.tag = (i.tag || '').toLowerCase();

    el.innerHTML = `
      <div class="nd-intel-top">
        <div>
          <div class="nd-intel-title">${i.title}</div>
          <div class="nd-intel-meta">
            ${i.time} Â· ì‹ ë¢°ë„: ${i.trust}
          </div>
        </div>
        <div class="nd-intel-tag">${i.tag}</div>
      </div>
      <div class="nd-intel-body">${i.body}</div>
    `;
    list.appendChild(el);
  });
}

// ğŸ” íŠ¹ì • êµ¬ì—­ ì´ë¦„ì— ë§ëŠ” ì¸í…” ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
function highlightIntelForZone(zoneName) {
  const cards = document.querySelectorAll('#intel-list .nd-intel-card');
  if (!cards.length) return;

  // ì „ì²´ ì´ˆê¸°í™”
  cards.forEach(card => {
    card.classList.remove('intel-highlight', 'intel-dim');
  });

  if (!zoneName) return;

  const key = zoneName.toLowerCase();
  let anyHit = false;

  cards.forEach(card => {
    const title = (card.querySelector('.nd-intel-title')?.textContent || '').toLowerCase();
    const body  = (card.querySelector('.nd-intel-body')?.textContent  || '').toLowerCase();
    const tag   = (card.dataset.tag || '').toLowerCase();

    // ğŸ”¹ ê°„ë‹¨í•œ ë§¤ì¹­ ë£°:
    //  - ë³¸ë¬¸/ì œëª©ì— êµ¬ì—­ ì´ë¦„ì´ ë“¤ì–´ê°€ê±°ë‚˜
    //  - êµ¬ì—­ ì´ë¦„ì— ë§ëŠ” íƒœê·¸ê°€ ìˆì„ ë•Œ ë§¤ì¹­
    let hit = false;

    if (title.includes(key) || body.includes(key)) {
      hit = true;
    } else {
      // ì•½ê°„ì˜ ìˆ˜ë™ ë§¤í•‘ (ë„¤ì˜¤ë¦¬ë² ë¥´ ì„¤ì • ë°˜ì˜)
      if (zoneName === 'Old Subway' && tag === 'network') hit = true;
      if (zoneName === 'Corporate Spire' && (tag === 'corp' || tag === 'NSC')) hit = true;
      if (zoneName === 'Ghost Alley' && (tag === 'NMC' || tag === 'gang')) hit = true;
      if (zoneName === 'Lower Docks' && (tag === 'NMC' || tag === 'gang')) hit = true;
    }

    if (hit) {
      card.classList.add('intel-highlight');
      anyHit = true;
    } else {
      card.classList.add('intel-dim');
    }
  });

  // ë§¤ì¹­ë˜ëŠ” ê²Œ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì›ìƒë³µêµ¬ (ë„ˆë¬´ í—ˆì „í•˜ë©´)
  if (!anyHit) {
    cards.forEach(card => {
      card.classList.remove('intel-highlight', 'intel-dim');
    });
  }
}

function renderMap(){
  const grid = $('#map-grid'); 
  if (!grid) return;

  const nameEl  = $('#map-detail-name');
  const levelEl = $('#map-detail-level');
  const descEl  = $('#map-detail-desc');
  const keyEl   = $('#map-detail-key');
  
  const holoName = $('#map-holo-name');
  const holoMeta = $('#map-holo-meta');
  const holoCells = $all('.nd-map-holo-cell');

  function setDetail(z){
    if (!z || !nameEl) return;
    nameEl.textContent  = z.name;
    levelEl.textContent = `ìœ„í—˜ë„ ë ˆë²¨ ${z.level} Â· ìƒíƒœ: ${z.hazard}`;
    descEl.textContent  = z.desc;
    if (keyEl) {
      keyEl.innerHTML = `í•µì‹¬ í¬ì¸íŠ¸: ${z.key || 'N/A'}`;
    }

    // ğŸ”¹ í™€ë¡œê·¸ë¨ íŒ¨ë„ ì—…ë°ì´íŠ¸
    if (holoName) holoName.textContent = z.name;
    if (holoMeta) holoMeta.textContent = `LV.${z.level} Â· status: ${z.hazard}`;

    if (holoCells && holoCells.length){
      const idx = z.level % holoCells.length;   // ë ˆë²¨ì— ë”°ë¼ ì¹¸ í•˜ë‚˜ ë°œê´‘
      holoCells.forEach((c,i)=>{
        c.classList.toggle('active', i === idx);
      });
    }

    // ğŸ”¹ ì„ íƒ ì‹œ HOLO íŒ¨ë„ í„ìŠ¤ íš¨ê³¼
    const holoBox = $('#map-holo');
    if (holoBox) {
      holoBox.classList.remove('pulse');
      // reflowë¡œ ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘
      void holoBox.offsetWidth;
      holoBox.classList.add('pulse');
    }
    highlightIntelForZone(z.name);
  }



  grid.innerHTML = '';
  mapZones.forEach(z=>{
    const el = document.createElement('div'); 
    el.className = 'zone';
    el.innerHTML = `
      <div style="font-weight:700">${z.name}</div>
      <div class="meta">ë ˆë²¨: ${z.level} Â· ì£¼ì˜: ${z.hazard}</div>
      <div class="key">${z.desc}</div>
      <div class="tag">${z.key || ''}</div>`;
    el.onmouseenter = (ev)=>showTip(
      ev.currentTarget,
      `<strong>${z.name}</strong><br/>${z.desc}<br/><span style='color:var(--muted)'>í•µì‹¬: ${z.key || 'N/A'}</span>`
    );
    el.onmouseleave = hideTip;
    el.onclick = ()=> setDetail(z);
    grid.appendChild(el);
  });

  // ê¸°ë³¸ ì„ íƒê°’: ì²« ë²ˆì§¸ êµ¬ì—­
  if (mapZones.length) setDetail(mapZones[0]);
}

/* âœ… Market ë Œë”ë§: ì‹¤ì œë¡œ DOMì— ì¶”ê°€í•˜ë„ë¡ ìˆ˜ì • */
function renderMarket() {
  const container = document.querySelector("#Market .item-list");
  if (!container) return;

  container.innerHTML = "";

  items.forEach(item => {
    const el = document.createElement("div");
    el.className = "content-box";

    el.innerHTML = `
      <div class="box-header">
        <div>
          <div class="item-name">${item.name}</div>
          <div class="item-id">${item.id}</div>
        </div>
        <div class="${item.stock <= 2 ? 'low-stock' : ''}">
          ì¬ê³ : ${item.stock}
        </div>
      </div>

      <p class="item-desc">${item.desc}</p>

      <div class="box-footer">
        <span>â‚¦ ${item.price.toLocaleString()}</span>
        <button
          type="button"
          class="buy-btn"
          onclick="buyItem('${item.id}')"
          ${item.stock === 0 ? 'disabled' : ''}
        >
          êµ¬ë§¤
        </button>
      </div>
    `;

    container.appendChild(el);
  });
}

// Contact: ì…€ë ˆë¥´ë‹ˆì•„ í†µì‹  í—ˆë¸Œ ì…ë ¥
const contactSendBtn = $('#contact-send');
if (contactSendBtn) {
  contactSendBtn.addEventListener('click', () => {
    const textarea = $('#contact-input');
    const targetSel = $('#contact-recipient');
    if (!textarea) return;

    const text = textarea.value.trim();
    if (!text) {
      popup('ë‚¨ê¸¸ ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    const to = targetSel ? targetSel.value : 'ê¸°ë¡';
    addContactEntry('ì…€ë ˆë¥´ë‹ˆì•„', to, 'outgoing', text);
    textarea.value = '';
  });
}

const contactClearBtn = $('#contact-clear');
if (contactClearBtn) {
  contactClearBtn.addEventListener('click', () => {
    const textarea = $('#contact-input');
    if (textarea) textarea.value = '';
  });
}


/* purchases: ì•ˆì „ ê°€ë“œ ì¶”ê°€ */
function renderPurchases(){
  const el = $('#purchases');
  if (!el) return;   // ìš”ì†Œ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ìŠ¤í‚µ
  if(state.purchases.length===0) el.textContent='ì—†ìŒ';
  else el.innerHTML = state.purchases
    .slice(-6)
    .map(p=>`<div>${new Date(p.time).toLocaleString()} â€” ${p.name}</div>`)
    .join('');
}

/* tooltip logic */
let tipEl;
function showTip(target, html){
  hideTip();
  tipEl = document.createElement('div'); 
  tipEl.className='tooltip'; 
  tipEl.innerHTML = html;
  document.body.appendChild(tipEl);
  const r = target.getBoundingClientRect();
  tipEl.style.left = (r.left + window.scrollX) + 'px';
  tipEl.style.top = (r.top + window.scrollY - tipEl.offsetHeight - 10) + 'px';
}
function hideTip(){ 
  if(tipEl){ 
    tipEl.remove(); 
    tipEl=null; 
  } 
}

/* ================
   Actions
   ================ */
   function showRouteOverlay(targetId, callback) {
  const overlay = $('#routeOverlay');
  const txt = $('#routeOverlayText');
  if (!overlay || !txt) {
    // ì˜¤ë²„ë ˆì´ê°€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ë°”ë¡œ ì „í™˜
    callback();
    return;
  }

  const label = targetId.toUpperCase();
  txt.textContent = `ROUTING : ${label}`;
  txt.setAttribute('data-text', `ROUTING : ${label}`);

  overlay.classList.add('visible');

  setTimeout(() => {
    callback();
    overlay.classList.remove('visible');
  }, 550);   // ì˜¤ë²„ë ˆì´ ë³´ì—¬ì£¼ëŠ” ì‹œê°„
}

function setView(id, pushHash = true) {
  showRouteOverlay(id, () => {
    // âœ… ì„¹ì…˜ ë°”ê¿€ ë•Œ í•­ìƒ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
    window.scrollTo({ top: 0, behavior: 'smooth' });

    // ğŸ”¹ ì„¹ì…˜ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
    ['home','jobs','intel','map','contact','Market'].forEach(name => {
      const el = document.getElementById(name);
      if (!el) return;
      el.style.display = (name === id) ? '' : 'none';
    });

    // ğŸ”¹ nav ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
    $all('nav .nav-btn').forEach(b => {
      b.style.opacity = (b.dataset.target === id) ? '1' : '0.8';
    });

    // ğŸ”¹ í˜„ì¬ ì„¹ì…˜ ê¸°ë¡ + ë¯¸ë‹ˆ AI ìƒíƒœ ê°±ì‹ 
    window._currentSection = id;
    if (typeof updateAiMessage === 'function') {
      updateAiMessage(id);   // í•¨ìˆ˜ê°€ ìˆì„ ë•Œë§Œ ì‹¤í–‰
    }
  });
}


$all('nav .nav-btn').forEach(b=>{
  b.onclick = ()=>setView(b.dataset.target);
});

$('#postJob').onclick = ()=>{
  const title = prompt('ì˜ë¢° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
  const desc = prompt('ì˜ë¢° ìƒì„¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì¼ë°˜ì¸ì²˜ëŸ¼ ì‘ì„±)') || '';
  const reward = Number(prompt('ë³´ìƒ í¬ë ˆë”§ (ìˆ«ì)') || 1000);
  if(!title) return popup('ì œëª© í•„ìš”');
  const id = 'U-' + Math.floor(Math.random()*90000 + 10000);
  jobs.unshift({ id, title, client:'ì›¹ ì˜ë¢°ì', reward, tags:['user'], location:'ìœ ì € ì§€ì •', difficulty:'Var', desc, status:'open' });
  popup('ì˜ë¢°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. Jobs íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
  renderSummary();
  setView('jobs');
};

$('#refreshJobs').onclick = ()=>renderJobs($('#job-search').value);
$('#job-search').addEventListener('input', ()=>renderJobs($('#job-search').value));

// ìƒíƒœ í•„í„° ë²„íŠ¼ë“¤
const jobFilterButtons = $all('.job-filter');
jobFilterButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    jobStatusFilter = btn.dataset.status || 'all';

    jobFilterButtons.forEach(b => b.classList.toggle('active', b === btn));
    renderJobs($('#job-search').value);
  });
});

$all('nav .nav-btn').forEach(btn => {
  btn.addEventListener('mouseenter', () => playSfx('sfx-hover'));
  btn.addEventListener('click', () => playSfx('sfx-click'));
});


$all('button[data-accept]').forEach(b => {
  b.onclick = async (e) => {
    // ...ì›ë˜ ë¡œì§...
    playSfx('sfx-success');
  };
});


// ì²˜ìŒ ë¡œë“œì‹œ "ì „ì²´" í™œì„±í™”
const defaultFilterBtn = document.querySelector('.job-filter[data-status="all"]');
if (defaultFilterBtn) defaultFilterBtn.classList.add('active');


function openJobModal(job) {
  const modal = document.getElementById("jobModal");
  const content = document.getElementById("jobModalContent");

  content.innerHTML = `
    <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">
      [${job.id}] Â· ${job.location} Â· ë‚œì´ë„: ${job.difficulty}
    </div>
    <h2 class="glitch" data-text="${job.title}" style="margin:0 0 10px 0;">
      ${job.title}
    </h2>
    <p style="font-size:13px;color:var(--muted);margin:0 0 12px 0;">
      ì˜ë¢°ì: ${job.client}
    </p>
    <p style="font-size:14px;margin:0 0 12px 0;">
      ${job.desc}
    </p>
    <div style="font-size:13px;">
      ë³´ìƒ: <span style="color:var(--neon-emerald);font-weight:700;">${job.reward} creds</span>
    </div>
    <div style="margin-top:14px;font-size:11px;color:var(--muted);text-align:right;">
      Click anywhere to close
    </div>
  `;

  modal.style.display = "flex";   // í™”ë©´ ì „ì²´ ì˜¤ë²„ë ˆì´ + ê°€ìš´ë° ì •ë ¬

  // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
  modal.onclick = (e) => {
    if (e.target === modal) {
      closeJobModal();
    }
  };
}


function closeJobModal() {
  document.getElementById("jobModal").style.display = "none";
}

/* ================  
   Job Flow (3ë‹¨ê³„ ì˜ë¢° ì§„í–‰)
   ================ */
   function openJobFlowModal(job) {
  // ì˜ë¢°ë³„ ì§„í–‰ ìƒíƒœ
  currentJobFlow = {
    id: job.id,
    step: 0,
    gear: [],          // 2ë‹¨ê³„ì—ì„œ ì„ íƒí•œ ì¥ë¹„
    score: 0,          // ì ìˆ˜
    actions: {}        // ì–´ë–¤ ì•¡ì…˜ì„ ëˆŒë €ëŠ”ì§€ ê¸°ë¡
  };
  const modal = document.getElementById('jobFlowModal');
  if (modal) {
    modal.style.display = 'block';
    renderJobFlowStep();
  }
}


function closeJobFlowModal() {
  const modal = document.getElementById('jobFlowModal');
  if (modal) {
    modal.style.display = 'none';
  }
  currentJobFlow = null;
}

function renderJobFlowStep() {
  if (!currentJobFlow) return;
  const job = jobs.find(j => j.id === currentJobFlow.id);
  if (!job) return;

  const box = document.getElementById('jobFlowContent');
  const prev = document.getElementById('jobFlowPrev');
  const next = document.getElementById('jobFlowNext');
  const complete = document.getElementById('jobFlowComplete');
  if (!box || !prev || !next || !complete) return;

  const step = currentJobFlow.step;

  // ë²„íŠ¼ í‘œì‹œ ìƒíƒœ
  prev.style.display = step === 0 ? 'none' : 'inline-flex';
  next.style.display = step < 2 ? 'inline-flex' : 'none';
  complete.style.display = step === 2 ? 'inline-flex' : 'none';

  if (step === 0) {
    // STEP 01 Â· ë¸Œë¦¬í•‘ í™•ì¸
    box.innerHTML = `
      <div style="font-size:11px;color:var(--neon-emerald);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:6px;">
        STEP 01 Â· ë¸Œë¦¬í•‘ í™•ì¸
      </div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:6px;">
        [${job.id}] ${job.location} Â· ë‚œì´ë„: ${job.difficulty}
      </div>
      <h3 class="glitch" data-text="${job.title}" style="margin:0 0 10px 0;font-size:16px;">
        ${job.title}
      </h3>
      <p style="margin:0 0 10px 0;font-size:13px;color:var(--muted);">
        ì˜ë¢°ì: ${job.client}
      </p>
      <p style="margin:0;font-size:13px;line-height:1.5;">
        ${job.desc}
      </p>
      <p style="margin-top:10px;font-size:11px;color:var(--muted);">
        ë‹¤ìŒì„ ëˆŒëŸ¬ ì¥ë¹„ë¥¼ ì„ íƒí•˜ê³  ì˜ë¢°ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    `;
  } else if (step === 1) {
    // STEP 02 Â· ì¥ë¹„ ì„ íƒ (items ë°°ì—´ ì¼ë¶€ ì‚¬ìš©)
    const gearList = items.slice(0, 6).map(it => {
      const checked = currentJobFlow.gear.includes(it.id) ? 'checked' : '';
      return `
        <label style="display:flex;justify-content:space-between;align-items:center;gap:6px;padding:6px 8px;border-radius:8px;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.05);margin-bottom:4px;font-size:12px;">
          <div>
            <div style="font-weight:600;color:var(--text);">${it.name}</div>
            <div style="color:var(--muted);font-size:11px;">${it.desc}</div>
          </div>
          <input type="checkbox" data-gear="${it.id}" ${checked} />
        </label>
      `;
    }).join('');

    box.innerHTML = `
      <div style="font-size:11px;color:var(--neon-emerald);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:6px;">
        STEP 02 Â· ì¥ë¹„ ì„ íƒ
      </div>
      <p style="font-size:12px;color:var(--muted);margin:0 0 6px 0;">
        ì´ ì˜ë¢°ì—ì„œ ì‚¬ìš©í•  ì¥ë¹„ë¥¼ ì„ íƒí•˜ì„¸ìš”. ì‹¤ì œ í¬ë ˆë”§ì€ ì°¨ê°ë˜ì§€ ì•Šìœ¼ë©°, ê¸°ë¡ìš© ì„¤ì •ì…ë‹ˆë‹¤.
      </p>
      <div style="margin-top:6px;max-height:180px;overflow-y:auto;">
        ${gearList}
      </div>
    `;

    // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì—°ê²°
    box.querySelectorAll('input[type="checkbox"][data-gear]').forEach(chk => {
      chk.addEventListener('change', (e) => {
        const id = e.target.getAttribute('data-gear');
        if (!id) return;
        if (e.target.checked) {
          if (!currentJobFlow.gear.includes(id)) currentJobFlow.gear.push(id);
        } else {
          currentJobFlow.gear = currentJobFlow.gear.filter(x => x !== id);
        }
      });
    });

  } else if (step === 2) {
  // STEP 03 Â· ì˜ë¢° ì§„í–‰ + ì ìˆ˜ ì‹œìŠ¤í…œ

  // ì•„ì§ ì ìˆ˜ê°€ ì•ˆ ë§Œë“¤ì–´ì¡Œë‹¤ë©´, ê¸°ë³¸ ì ìˆ˜ ê³„ì‚°
  if (currentJobFlow.score === 0) {
    // ì¥ë¹„ ê°œìˆ˜ ê¸°ë°˜ ê¸°ë³¸ ì ìˆ˜ + ì•½ê°„ì˜ ëœë¤ ë³´ë„ˆìŠ¤
    const base = (currentJobFlow.gear?.length || 0) * 10;   // ì¥ë¹„ í•˜ë‚˜ë‹¹ 10ì 
    const rand = Math.floor(Math.random() * 21);            // 0~20
    currentJobFlow.score = Math.min(100, base + rand);
    currentJobFlow.actions = {};
  }

  const successThreshold = 70;   // âœ… ì´ ì ìˆ˜ ì´ìƒì´ë©´ ì„±ê³µ

  box.innerHTML = `
    <div style="font-size:11px;color:var(--neon-emerald);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:6px;">
      STEP 03 Â· ì˜ë¢° ì§„í–‰ ì¤‘
    </div>
    <p style="font-size:13px;color:var(--muted);margin:0 0 6px 0;">
      ì„ íƒí•œ ì¥ë¹„ì™€ í•¨ê»˜ í˜„ì¥ì— ì§„ì…í–ˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
      ì•„ë˜ ì•¡ì…˜ë“¤ì„ ìˆ˜í–‰í•˜ë©´ì„œ <strong>ì˜ë¢° ìŠ¤ì½”ì–´</strong>ë¥¼ ì˜¬ë ¤ ë³´ì„¸ìš”.
    </p>

    <div id="jobFlowScore" class="flow-score">
      í˜„ì¬ ìŠ¤ì½”ì–´: ${currentJobFlow.score} / 100
    </div>

    <div class="flow-actions">
      <button type="button" class="btn secondary micro flow-act"
              data-act="recon" data-score="25">
        ì‚¬ì „ ì •ì°° ìˆ˜í–‰ Â· ê°ì‹œ íŒ¨í„´ ë¶„ì„ (+25)
      </button>
      <button type="button" class="btn secondary micro flow-act"
              data-act="bypass" data-score="25">
        ë³´ì•ˆ ìš°íšŒ ê²½ë¡œ ì„¤ì • Â· ë°±ë„ì–´ ê°œë°© (+25)
      </button>
      <button type="button" class="btn secondary micro flow-act"
              data-act="cleanup" data-score="25">
        ë¡œê·¸/í”ì  ì •ë¦¬ Â· íšŒìˆ˜ í›„ í”ì  ì‚­ì œ (+25)
      </button>
    </div>

    <p style="font-size:11px;color:var(--muted);margin:8px 0 0;">
      ê° ì•¡ì…˜ì€ í•œ ë²ˆë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      ìŠ¤ì½”ì–´ê°€ <strong>${successThreshold}ì  ì´ìƒ</strong>ì´ë©´ ì˜ë¢°ê°€ ì„±ê³µí•©ë‹ˆë‹¤.
      ì¤€ë¹„ê°€ ëë‚¬ë‹¤ë©´ ì•„ë˜ì˜ <strong>ì˜ë¢° ì™„ë£Œ</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ íŒì •ì„ ë°›ìœ¼ì„¸ìš”.
    </p>
  `;

  const scoreEl = document.getElementById('jobFlowScore');
  const actButtons = box.querySelectorAll('.flow-act');

  function updateScoreUI() {
    if (!scoreEl) return;
    scoreEl.textContent = `í˜„ì¬ ìŠ¤ì½”ì–´: ${currentJobFlow.score} / 100`;
  }

  actButtons.forEach(btn => {
    const actId = btn.getAttribute('data-act');
    const gain = Number(btn.getAttribute('data-score') || 0);

    // ì´ë¯¸ ëˆ„ë¥¸ ì•¡ì…˜ì´ë©´ ë¹„í™œì„±í™”
    if (currentJobFlow.actions[actId]) {
      btn.disabled = true;
      btn.classList.add('completed');
    }

    btn.addEventListener('click', () => {
      if (currentJobFlow.actions[actId]) return;

      currentJobFlow.actions[actId] = true;
      currentJobFlow.score = Math.min(100, currentJobFlow.score + gain);

      btn.disabled = true;
      btn.classList.add('completed');
      playSfx('sfx-click');

      updateScoreUI();
    });
  });

  // ìŠ¤ì½”ì–´ í‘œì‹œ í•œ ë²ˆ ì—…ë°ì´íŠ¸
  updateScoreUI();
}
}

// í”Œë¡œìš° ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° (DOMì´ ë‹¤ ë§Œë“¤ì–´ì§„ ë’¤ì— ì‹¤í–‰)
window.addEventListener('DOMContentLoaded', () => {
  const jobFlowPrev = document.getElementById('jobFlowPrev');
  const jobFlowNext = document.getElementById('jobFlowNext');
  const jobFlowComplete = document.getElementById('jobFlowComplete');
  const jobFlowModal = document.getElementById('jobFlowModal');

  if (jobFlowPrev) {
    jobFlowPrev.addEventListener('click', () => {
      if (!currentJobFlow) return;
      if (currentJobFlow.step > 0) {
        currentJobFlow.step -= 1;
        renderJobFlowStep();
      }
    });
  }

  if (jobFlowNext) {
    jobFlowNext.addEventListener('click', () => {
      if (!currentJobFlow) return;
      if (currentJobFlow.step < 2) {
        currentJobFlow.step += 1;
        renderJobFlowStep();
      }
    });
  }

  if (jobFlowComplete) {
  jobFlowComplete.addEventListener('click', () => {
    if (!currentJobFlow) return;
    const job = jobs.find(j => j.id === currentJobFlow.id);
    if (!job) return;

    const score = currentJobFlow.score || 0;
    const successThreshold = 70;   // STEP 03ê³¼ ë™ì¼ ê°’

    if (score >= successThreshold) {
      // âœ… ì„±ê³µ: ë³´ìƒ ì§€ê¸‰ + ìƒíƒœ completed
      if (job.status !== 'completed') {
        job.status = 'completed';
        state.wallet += job.reward;
        localStorage.setItem('oc_wallet', String(state.wallet));
      }

      playSfx('sfx-success');
      popup(
        `ì˜ë¢° ì„±ê³µ!\n[${job.id}] ${job.title}\n\nìŠ¤ì½”ì–´: ${score} / 100\në³´ìƒ: +${job.reward} creds`,
        "info"
      );
    } else {
      // âŒ ì‹¤íŒ¨: ë³´ìƒ ì—†ìŒ, ìƒíƒœëŠ” ë‹¤ì‹œ open (ì¬ë„ì „ ê°€ëŠ¥)
      job.status = 'open';

      playSfx('sfx-error');
      popup(
        `ì˜ë¢° ì‹¤íŒ¨â€¦\n[${job.id}] ${job.title}\n\nìŠ¤ì½”ì–´: ${score} / 100\n\nê¸°ë¡ë§Œ ë‚¨ê¸°ê³  ì˜ë¢°ëŠ” ë‹¤ì‹œ ì˜¤í”ˆ ìƒíƒœê°€ ë©ë‹ˆë‹¤.\në‹¤ì‹œ ì‹œë„í•˜ë ¤ë©´ ì˜ë¢°ë¥¼ ë‹¤ì‹œ ìˆ˜ë½í•˜ì„¸ìš”.`,
        "error"
      );
    }

    renderSummary();
    closeJobFlowModal();
    setView('jobs');
  });
}


  // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
  if (jobFlowModal) {
    jobFlowModal.addEventListener('click', (e) => {
      if (e.target === jobFlowModal) {
        closeJobFlowModal();
      }
    });
  }
});

/* ================
   Buy item
   ================ */
function buyItem(id){
  const it = items.find(x=>x.id===id);
  if(!it) return;
  if(state.wallet < it.price) return popup('ì”ì•¡ ë¶€ì¡±');
  it.stock -= 1;
  state.wallet -= it.price;
  state.purchases.push({ id: it.id, name: it.name, time: Date.now() });
  localStorage.setItem('oc_purchases', JSON.stringify(state.purchases));
  localStorage.setItem('oc_wallet', String(state.wallet));
  popup(`${it.name} êµ¬ë§¤ ì™„ë£Œ`);
  renderSummary();
}

/* ================
   Encryption (AES-GCM w/ PBKDF2)
   ================ */
async function deriveKey(password, saltBytes){
  const enc = new TextEncoder();
  const baseKey = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
  const key = await crypto.subtle.deriveKey(
    { name:'PBKDF2', salt: saltBytes, iterations: 200000, hash:'SHA-256' },
    baseKey,
    { name:'AES-GCM', length: 256 },
    false,
    ['encrypt','decrypt']
  );
  return key;
}

async function encryptAES(plaintext, password){
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const key = await deriveKey(password, salt);
  const enc = new TextEncoder();
  const cipher = await crypto.subtle.encrypt({ name:'AES-GCM', iv }, key, enc.encode(plaintext));
  return btoa(JSON.stringify({ salt:Array.from(salt), iv:Array.from(iv), data:Array.from(new Uint8Array(cipher)) }));
}

async function decryptAES(packB64, password){
  try{
    const pack = JSON.parse(atob(packB64));
    const salt = new Uint8Array(pack.salt);
    const iv = new Uint8Array(pack.iv);
    const data = new Uint8Array(pack.data);
    const key = await deriveKey(password, salt);
    const plain = await crypto.subtle.decrypt({ name:'AES-GCM', iv }, key, data);
    return new TextDecoder().decode(plain);
  }catch(e){
    return null;
  }
}

$('#encryptBtn').onclick = async ()=>{
  const text = $('#payload').value || 'ping';
  const pw = prompt('ì•”í˜¸ ì…ë ¥ (ìˆ˜ì‹ ìì™€ ê³µìœ í•˜ì„¸ìš”)');
  if(!pw) return;
  const enc = await encryptAES(text, pw);
  try{ 
    await navigator.clipboard.writeText(enc); 
    popup('ì•”í˜¸í™”ëœ í˜ì´ë¡œë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); 
  }catch(e){ 
    popup('ì•”í˜¸í™” ê²°ê³¼:\n' + enc);
  }
};

$('#decryptBtn').onclick = async ()=>{
  const pack = prompt('ë³µí˜¸í™”í•  í˜ì´ë¡œë“œ ë¶™ì—¬ë„£ê¸° (base64) â€” ì·¨ì†Œí•˜ë©´ í˜„ì¬ í˜ì´ë¡œë“œ ì‚¬ìš©');
  const p = pack || $('#payload').value;
  if(!p) return;
  const pw = prompt('ì•”í˜¸ ì…ë ¥');
  if(!pw) return;
  const dec = await decryptAES(p, pw);
  if(dec === null) popup('ë³µí˜¸í™” ì‹¤íŒ¨ â€” ë¹„ë°€ë²ˆí˜¸/í˜ì´ë¡œë“œ í™•ì¸');
  else{ 
    $('#payload').value = dec; 
    popup('ë³µí˜¸í™” ì™„ë£Œ â€” í˜ì´ë¡œë“œì— ë‚´ìš©ì´ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.');
  }
};

$('#clearPayload').onclick = ()=>$('#payload').value='';

/* ================
   Broker register/login
   ================ */
async function hashPassword(password, saltBytes){
  const enc = new TextEncoder();
  const baseKey = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveBits']);
  const derived = await crypto.subtle.deriveBits(
    { name:'PBKDF2', salt: saltBytes, iterations: 200000, hash:'SHA-256' },
    baseKey,
    256
  );
  return btoa(String.fromCharCode(...new Uint8Array(derived)));
}

async function registerBroker(name, password){
  if(!name || !password) return false;
  if(state.users[name]) return false;
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const h = await hashPassword(password, salt);
  state.users[name] = { salt:Array.from(salt), hash:h, created: Date.now() };
  localStorage.setItem('oc_users', JSON.stringify(state.users));
  return true;
}

async function verifyBroker(name, password){
  const rec = state.users[name];
  if(!rec) return false;
  const salt = new Uint8Array(rec.salt);
  const h = await hashPassword(password, salt);
  return h === rec.hash;
}

$('#loginBtn').onclick = async ()=>{
  const modeRaw = prompt('ë¡œê·¸ì¸ ë˜ëŠ” ë“±ë¡ (type: login / register)');
  if(!modeRaw) return;
  const mode = modeRaw.trim();

  if(mode === 'register'){
    const uRaw = prompt('ë“±ë¡í•  ë¸Œë¡œì»¤ ID (ì˜ˆ: raven)');
    if(!uRaw) return popup('ID í•„ìš”');
    const u = uRaw.trim();

    const pRaw = prompt('íŒ¨ìŠ¤ì›Œë“œ');
    if(!pRaw) return popup('PW í•„ìš”');
    const p = pRaw.trim();

    const ok = await registerBroker(u,p);
    popup(ok? 'ë“±ë¡ ì„±ê³µ (ë¡œì»¬ ì €ì¥)' : 'ë“±ë¡ ì‹¤íŒ¨ (ì´ë¯¸ ì¡´ì¬)');
    renderSummary();
    return;
  }

  if(mode === 'login'){
    const uRaw = prompt('ë¸Œë¡œì»¤ ID');
    if(!uRaw) return;
    const u = uRaw.trim();

    const pRaw = prompt('íŒ¨ìŠ¤ì›Œë“œ');
    if(!pRaw) return;
    const p = pRaw.trim();

    const ok = await verifyBroker(u,p);
    if(ok){
      const token = await encryptAES(JSON.stringify({ user:u, ts:Date.now() }), p);
      state.logged[u] = token;
      localStorage.setItem('oc_logged', JSON.stringify(state.logged));
      uiPopup('<h3 class="neon-text">ë¡œê·¸ì¸ ì„±ê³µ</h3>');

      if(u === SECRET_OWNER){
        state.secretUnlocked = true;
        $('#secretPopup').style.display = '';
      }

      renderSummary();
    } else {
      popup('ë¡œê·¸ì¸ ì‹¤íŒ¨ â€” ID ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
    }
    return;
  }

  popup('ì…ë ¥ ì˜¤ë¥˜: login ë˜ëŠ” register ì¤‘ í•˜ë‚˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
};

$('#clipSecret').onclick = ()=>{
  navigator.clipboard?.writeText(JSON.stringify({ vault:'protocol-keys', time:Date.now() }))
    .then(()=>popup('ë°ëª¨ ë¹„ë°€ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'));
};

/* Secret popup reveal on load */
if(state.logged[SECRET_OWNER]) {
  state.secretUnlocked = true;
  $('#secretPopup').style.display = '';
}

/* Easter egg button */
document.getElementById('eggBtn').addEventListener('click', () => {
  popup('Easter Egg: ë‚´ë¶€ ë ˆì´ì–´ ì ‘ê·¼ ë¶ˆê°€ â€” (ë°ëª¨)');
  const r = document.getElementById('glitchRange');
  r.value = Math.min(6, Number(r.value) + 1);
  applyGlitchStrength(r.value);
});

$('#showDev').onclick = ()=>{
  popup('Dev Easter: ì €ì¥ëœ ë¸Œë¡œì»¤ ëª©ë¡ê³¼ ë¡œê·¸ì¸ í† í°ì„ ì½˜ì†”ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.');
  console.log('users', state.users);
  console.log('logged', state.logged);
  popup('ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
};

let bgPlaying = false;

$('#soundToggle').onclick = () => {
  const noise = document.getElementById('rainNoise');
  const detail = document.getElementById('rainDetail');
  if (!noise || !detail) return;

  if (!bgPlaying) {
    // ì²˜ìŒ ì¬ìƒ ì‹œ ë³¼ë¥¨ ì‚´ì§ ì¤„ì´ê¸°
    noise.volume = 0.25;   // ì”ì”í•œ í™˜ê²½ìŒ
    detail.volume = 0.35;  // ë¹— ë–¨ì–´ì§€ëŠ” ë””í…Œì¼

    noise.play();
    detail.play();

    bgPlaying = true;
    $('#soundToggle').textContent = 'ì‚¬ìš´ë“œ (ON)';
  } else {
    noise.pause();
    detail.pause();

    bgPlaying = false;
    $('#soundToggle').textContent = 'ì‚¬ìš´ë“œ';
  }
};


/* Glitch strength control */
function applyGlitchStrength(v){
  const px = (v * 1.2).toFixed(2) + 'px';
  document.documentElement.style.setProperty('--glitch-x', px);
  document.documentElement.style.setProperty('--glitch-y', (v>2? -1*v/2 : -1) + 'px');
  const speed = 1200 + (6 - v) * 600;
  document.documentElement.style.setProperty('--glitch-speed', speed + 'ms');
}
$('#glitchRange').addEventListener('input', (e)=>{ applyGlitchStrength(e.target.value) });

/* DARK TRACE ë²„íŠ¼ (ì•ˆì „ ê°€ë“œ) */
const darkBtn = document.querySelector('#darkTraceBtn');
if (darkBtn) {
  darkBtn.onclick = () => {
    popup("âš  DARKÂ·TRACE SYSTEM\n\ní˜„ì¬ ê¸°ë¡ì€ ì•”í˜¸í™”ë˜ì–´ ìˆì–´ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
  };
}

// =======================
// 5ì´ˆ ë¡œë”© í›„ ë©”ì¸ í™”ë©´ í‘œì‹œ
// =======================
window.addEventListener('load', () => {
  const loader = document.getElementById('loading-screen');
  if (!loader) return;

  // ğŸ”’ ë¡œë”© ì¤‘ì—ëŠ” ìŠ¤í¬ë¡¤ ì ê·¸ê¸°
  document.documentElement.style.overflow = 'hidden';
  document.body.style.overflow = 'hidden';

  setTimeout(() => {
    loader.style.opacity = '0';
    setTimeout(() => {
      loader.remove();

      // ğŸ”“ ë¡œë”© ëë‚˜ë©´ ë‹¤ì‹œ ìŠ¤í¬ë¡¤ í’€ê¸°
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }, 400);
  }, 2500); // 2.5ì´ˆ ë¡œë”©
});

// =======================
// World Ticker (ìƒë‹¨ ìƒíƒœ ë¡œê·¸ íšŒì „)
// =======================
const worldLogs = [
  "PACKET LOSS: 72% Â· ê°ì‹œë§ ë¶ˆì•ˆì •",
  "LOWER DOCKS: ê°±ë‹¨ ì¶©ëŒ ë³´ê³ ",
  "BLACK MARKET: ê±°ë˜ëŸ‰ ê¸‰ì¦",
  "CORP SPIRE: ë‚´ë¶€ ìŠ¤íŒŒì´ ì§•í›„",
  "OLD SUBWAY: ë¹„ì¸ê°€ ë£¨íŠ¸ ì°¨ë‹¨",
  "LOBBY: ì˜ë¢°ì¸ ì…ì¥ ì¤‘",
  "N.S.C.: ì…€â–ˆë¥´â–ˆâ–ˆ, ì´ê²Œ ë„ˆâ–ˆì˜ ì‚¬â–ˆâ–ˆì¸ê°€?",
  "UNDERVEIL: ê°ì‹œ ì‚¬ê° í™•ëŒ€",
  "OLD CIRCUIT: ë¯¸ë“±ë¡ ì‹ í˜¸ í¬ì°©",
  "GHOST SERVER: ë°±ì—… ë£¨ë¨¸ ì¬í™•ì‚°",
  "VEX AUCTION: ê³ ìœ„í—˜ ë¬¼í’ˆ ì¶œí’ˆ",
  "CITY CRED: Favors ì§€ìˆ˜ ìƒìŠ¹",
  "NSC LOG: ê¸°ë¡ í¸ì§‘ ìš”ì²­ ì¦ê°€",
  "OFFICE: ë‚´ë¶€ Favors ì´ìƒì¹˜",
];

let worldLogIndex = 0;

function rotateWorldLog() {
  const el = document.getElementById("worldTickerText");
  if (!el) return;

  el.textContent = worldLogs[worldLogIndex];
  worldLogIndex = (worldLogIndex + 1) % worldLogs.length;
}


/* initialize */
applyGlitchStrength($('#glitchRange').value);
renderSummary();
rotateWorldLog();
setInterval(rotateWorldLog, 12000);   // 12ì´ˆë§ˆë‹¤ ë„ì‹œ ìƒíƒœ ê°±ì‹ 

// ì‚¬ì´ë“œ ì•Œë¦¼: ì•½ê°„ ë”œë ˆì´ í›„ ì£¼ê¸°ì ìœ¼ë¡œ í‘œì‹œ
setTimeout(() => {
  spawnSideAlert();
  setInterval(spawnSideAlert, 9000);  // 12ì´ˆë§ˆë‹¤ í•˜ë‚˜ì”©
}, 5000);

/* switch view on load - í•´ì‹œ ê¸°ì¤€ìœ¼ë¡œ ì´ˆê¸° ì„¹ì…˜ ì„ íƒ */
const initialSection = (location.hash || '#home').replace('#','') || 'home';
setView(initialSection, false);

// ğŸ” ì£¼ì†Œì°½ í•´ì‹œ(#jobs ë“±)ê°€ ë°”ë€” ë•Œë§ˆë‹¤ ì„¹ì…˜ ì „í™˜
window.addEventListener('hashchange', () => {
  const id = (location.hash || '#home').replace('#','') || 'home';
  setView(id, false);   // í•´ì‹œëŠ” ì´ë¯¸ ë°”ë€Œì—ˆìœ¼ë‹ˆê¹Œ pushHash=false
});


/* expose for debugging (optional) */
window._oc = { jobs, intel, mapZones, items, state, encryptAES, decryptAES };

/* =========================
   Side floating alert logic
   ========================= */
   const sideAlertPool = [
   {
    title: "NSC-KID // CELERENIA",
    body: "ë³´ì•ˆêµ­ ë¶„ë¥˜: NSC-KID-R0\nìƒíƒœ: ìµœìš°ì„  ê°ì‹œ ë° êµì „ íšŒí”¼ ê¶Œê³ .\në¹„ê³ : â€˜ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œâ€™ì™€ ì§ì ‘ ì—°ê´€.",
    tag: "HIGH PRIORITY"
  },
  {
    title: "SYSÂ·ALERT",
    body: "ì˜ˆìƒì¹˜ ëª»í•œ íŒ¨í‚· êµ°ì§‘ ê°ì§€.\ní•˜ì¸µ ë…¸ë“œì—ì„œ ë¹„ì¸ê°€ íŠ¸ë˜í”½ ë°œìƒ.",
    tag: "MONITORING"
  },
  {
    title: "OFFICE // DIRECTOR",
    body: "ì…€ë ˆë¥´ë‹ˆì•„: \"ì˜ë¢° ë¬¸êµ¬ì— ê°ì • ì„ì§€ ë§ˆ. ê¸°ë¡ì€ í•­ìƒ ì°¨ê°‘ê²Œ.\"",
    tag: "INTERNAL NOTE"
  },
  {
    title: "SUPPORT // NSC-KID",
    body: "ë¦¬ë ˆì´: \"â€¦ì´ ì±„ë„ êµ¬ì¡°, ì˜ˆì „ì— ë‚´ê°€ ì§€ì› ë˜ ë¡œê·¸ë‘ ë˜‘ê°™ì•„ ë³´ì—¬.\"",
    tag: "FIELD MEMO"
  },
  {
    title: "GUARD // BODYGUARD",
    body: "ì•„ì´ê¸°ìŠ¤: \"ë¬¸ ì•ì—ì„œ ê¸°ë‹¤ë¦¬ëŠ” ê²ƒë„ ì˜ë¢°ì•¼. ì˜¤ëŠ˜ì€ ì¡°ìš©í•˜ê¸¸ ë°”ë€ë‹¤.\"",
    tag: "STATIONED"
  },
  {
    title: "SYSÂ·ALERT",
    body: "ê°ì‹œë§: \"ë¹„ì¸ê°€ íŒ¨í‚·ì´ ë„¤ì˜¤ë¦¬ë² ë¥´ í•˜ì¸µìœ¼ë¡œ ëˆ„ìˆ˜ ì¤‘.\"",
    tag: "WARNING"
  },
  {
    title: "LOBBY CHAT",
    body: "ë¡œë¹„ ì§ì›: \"ì»¤í”¼ ë¨¸ì‹  ë˜ ê³ ì¥ë‚¬ì–´ìš”. ì´ë²ˆì—” ëˆ„ê°€ í•´í‚¹í•œ ê±°ì˜ˆìš”?\"",
    tag: "OFFICE LIFE"
  },
  {
    title: "RAVEN // NOTE",
    body: "\"ì˜ë¢°ìì—ê²Œ ë„ˆë¬´ ì • ë¶™ì´ì§€ ë§ˆ. ì´ ë„ì‹œëŠ” ê·¸ëŸ° ê±¸ ì˜¤ë˜ ë†”ë‘ì§€ ì•Šìœ¼ë‹ˆê¹Œ.\"",
    tag: "BROKER MEMO"
  },
  {
    title: "INTERNAL LOG",
    body: "ê¸°ë¡: \"ë³´ì•ˆêµ­ NSC ì¶œì‹  ì†Œë…„, ì˜¬ë“œ ì±„ë„ì—ì„œ íšŒìˆ˜ë¨. ìƒíƒœ: ë¶ˆì•ˆì • but ìœ ìš©.\"",
    tag: "CLASSIFIED"
  },
  {
    title: "OPSÂ·ROOM",
    body: "ì…€ë ˆë¥´ë‹ˆì•„: \"ì˜¤ëŠ˜ë„ ìš°ë¦¬ ì‚¬ë¬´ì†Œê°€ ë²•ë³´ë‹¤ ë¨¼ì € ë„ì°©í•œë‹¤.\"",
    tag: "MISSION"
  },
  {
    title: "STAFF CHAT",
    body: "ë¡œë¹„ ì§ì›: \"ì‚¬ì¥ë‹˜.. ê¸°ë¬¼ íŒŒì†ì€ ì¢€ ì°¸ì•„ì£¼ì„¸ìš”..\"",
    tag: "OFFICE LIFE"
  },
  {
    title: "GUARD // BODYGUARD",
    body: "ì•„ì´ê¸°ìŠ¤: \"ë§ˆìŠ¤í„°. ë¶„ëª… ì•ˆë‹¤ì¹œë‹¤ê³  í–ˆìœ¼ë©´ì„œ...\"",
    tag: "STATIONED"
  },
  {
    title: "NSCÂ·OVERRIDE",
    body: "NSC ìƒì¸µ ì½˜ì†”ì—ì„œ í•˜ì¸µ ê°ì‹œ ê·œì¹™ì„ ì¬ì •ì˜í–ˆìŠµë‹ˆë‹¤.\nê¸°ì¡´ ìš°íšŒ ë£¨íŠ¸ ì¼ë¶€ê°€ ë” ì´ìƒ ì•ˆì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
    tag: "NSC ROUTE"
  },
  {
    title: "NMC NIGHT ROUTE",
    body: "NMC ì•¼ê°„ ì •ë¹„ë°˜ì´ Ghost Alley â†’ Lower Docks êµ¬ê°„ì„ ë°˜ë³µ ìˆœíšŒ ì¤‘.\nê³µì‹ ì •ë¹„ ì¼ì •ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë£¨íŠ¸ì…ë‹ˆë‹¤.",
    tag: "NMC PATROL"
  },
  {
    title: "WANTED // RAVEN",
    body: "ë„¤íŠ¸ì›Œí¬ ì¹¨íˆ¬ ì‹œë„ ë¡œê·¸ 14ê±´.\nìµœê·¼ í™œë™ êµ¬ì—­: HoloÂ·District / Lower Docks.",
    tag: "THREAT LV. B+"
  },
  {
    title: "TRACE WARNING",
    body: "ì—­ì¶”ì  ì‹œë„ ê°€ëŠ¥ì„± ê°ì§€.\nê°™ì€ ì±„ë„ì—ì„œ ì˜¤ë˜ ë¨¸ë¬´ë¥´ì§€ ë§ˆì‹­ì‹œì˜¤.",
    tag: "RECOMMEND: HOP NODE"
  },
  {
    title: "OBSIDIANÂ·DIR PING",
    body: "ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œ ë‚´ë¶€ ì±„ë„ë¡œ ë¯¸í™•ì¸ íŒ¨í‚· ë„ì°©.\nìˆ˜ì‹ ì íƒœê·¸: \"ì…€ë ˆë¥´ë‹ˆì•„\" â€” ë°œì‹ ìëŠ” ë§ˆìŠ¤í‚¹ë¨.",
    tag: "INTERNAL"
  },
  {
    title: "BLACK MARKET PING",
    body: "ì‹ ê·œ ì¥ë¹„ ì…ê³ : GhostÂ·Router.\nì¼ì‹œì ìœ¼ë¡œ ê°€ê²© ë³€ë™ ê°ì§€.",
    tag: "MARKET FEED"
  },
  {
    title: "CCTV ROUTE UPDATE",
    body: "ìƒë‹¨ êµ¬ì—­ ì¹´ë©”ë¼ íšŒì „ ì£¼ê¸° ë³€ê²½.\nNSC ë¡œê·¸ ê¸°ì¤€, ê°™ì€ êµ¬ì—­ì´ ë‘ ë²ˆ ê²¹ì³ ì´¬ì˜ë˜ëŠ” êµ¬ê°„ ë°œê²¬.",
    tag: "SURVEILLANCE"
  },
  {
    title: "UNKNOWN SIGNAL",
    body: "ë™ë¶€ êµ¬ì—­ì—ì„œ ë°˜ë³µ ì‹ í˜¸ ìˆ˜ì‹ :\n\"â€¦ê±°ê¸° ëˆ„êµ¬ëƒâ€¦?\"\nNMC êµ¬í˜• ì¥ë¹„ì—ì„œ ì“°ë˜ í¬ë§·ê³¼ ìœ ì‚¬.",
    tag: "GLITCH FEED"
  },
  {
    title: "OLDÂ·CH FRAGMENT",
    body: "OLD CHANNELì—ì„œ ë³µì›ëœ ë¡œê·¸ ì¡°ê°:\n\"â€¦ë„ì‹œ ë°±ì—… ê¶Œí•œì„ ì…€ë ˆë¥´ë‹ˆì•„ì—ê²Œ ì´ì „â€¦\"\nì´í›„ ë°ì´í„°ëŠ” ì „ë¶€ íƒœì›Œì¡ŒìŠµë‹ˆë‹¤.",
    tag: "ARCHIVE"
  },
  {
  title: "CITY STATUS PULSE",
  body: "ë„¤ì˜¤ë¦¬ë² ë¥´ ì‹¬ë°• ì•ˆì •.\ní‘œë©´ì€ ì¡°ìš©í•˜ì§€ë§Œ, ê³¨ëª©ì€ ê¹¨ì–´ ìˆìŠµë‹ˆë‹¤.",
  tag: "SYSTEM"
},
{
  title: "OBSIDIANÂ·DIR STATUS",
  body: "ì˜µì‹œë””ì–¸ ë””ë ‰í‹°ë¸Œ ë©”ì¸ ë…¸ë“œ ì˜¨ë¼ì¸.\nDirector í”Œë˜ê·¸: \"ACTIVE\".",
  tag: "INTERNAL"
},
{
  title: "SCN ROUTE WHISPER",
  body: "SCN ìª½ì—ì„œ ë¹„ê³µì‹ ê²½ë¡œ ì¶”ì²œ.\n\"ì˜¤ëŠ˜ ê¸¸ì€ ë³„ ì„¸ ê°œ, ëœ ë§ëŠ” ìª½ìœ¼ë¡œ.\"",
  tag: "ALLY FEED"
},
{
  title: "NSC TRACE NOTE",
  body: "NSC íŒ¨í„´ ë¶„ì„ ì¤‘.\n\"ëˆ„êµ°ê°€ ì‹œê°„ì„ ì–´ê¸‹ë‚˜ê²Œ ë§Œë“¤ê³  ìˆë‹¤\"ëŠ” ì½”ë©˜íŠ¸ ê°ì§€.",
  tag: "SURVEILLANCE"
},
{
  title: "VEX MARKET FEED",
  body: "VEX ë¹„ê³µì‹ ê²½ë§¤ ì¤€ë¹„ ì¤‘.\níê¸°ëœ ì˜ë¢°ì˜ ì”í•´ê°€ ë‹¤ì‹œ ê°€ê²©ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.",
  tag: "MARKET"
},
{
  title: "NEX-13 GENTLE REMINDER",
  body: "ë””ë ‰í„°ë‹˜, í˜„ì¬ ë„ì‹œ ë¦¬ìŠ¤í¬ëŠ” \"ìˆ¨ ê³ ë¥´ê¸°\" êµ¬ê°„ì…ë‹ˆë‹¤.\nì˜¤ëŠ˜ì€ ì¡°ê¸ˆ ëŠ¦ê²Œ íŒì„ ì—¬ì…”ë„ ë©ë‹ˆë‹¤.",
  tag: "SYSTEM"
},
{
  title: "UNDERVEIL HUM",
  body: "Underveil ì‹¬ë¶€ ì†ŒìŒ -9%. ìŠµë„ ì•ˆì •.\nì‚¬ë¬´ì†Œ ê¸°ì¤€: \"ì¡°ìš©í•˜ì§€ë§Œ, ë„ˆë¬´ ì¡°ìš©í•˜ì§„ ì•Šì€ ë°¤\".",
  tag: "CITY STATUS"
},
{
  title: "NMC LOAD BALANCE",
  body: "NMC ë³´ê³ : ìƒì¸µ ì •ì±… ë³€í™” ì—†ìŒ.\ní•˜ì¸µÂ·Underveil ë¶€í•˜ ë¶„ì‚° ëª¨ë“œ ìœ ì§€ ì¤‘.",
  tag: "NMC"
},
{
  title: "GHOSTÂ·CHANNEL",
  body: "OLD CHANNEL ì”í–¥ ê°ì§€:\n\"â€¦ë°±ì—…ì€ ì‚´ì•„ ìˆë‹¤â€¦ ê·¸ë…€ê°€ ë“¤ê³  ìˆë‹¤â€¦\"",
  tag: "GLITCH"
},
{
  title: "DIRECTOR MEMO",
  body: "ë‚´ë¶€ ë©”ëª¨ ì¡°ê°:\n\"ë„ì‹œëŠ” ì˜¤ëŠ˜ë„ ì•ˆ ë¬´ë„ˆì¡Œê³ , ë‚˜ë„ ì•„ë‹ˆë‹¤. ë‚´ì¼ë„ í•œ ë²ˆ ë”.\"",
  tag: "NOTE"
},
{
  title: "STRAYÂ·PING",
  body: "ì–´ëŠ Stray ë¸Œë¡œì»¤ì˜ ë‹¨ë¬¸ ë©”ì‹œì§€:\n\"ì´ë¦„ ëŒ€ì‹ , ì˜¤ëŠ˜ ì‚´ì•„ë‚¨ì•˜ë‹¤ëŠ” ë¡œê·¸ë§Œ ë‚¨ê²¨ ì£¼ì„¸ìš”.\"",
  tag: "FIELD"
},
{
  title: "Î²7 LINE SHADOW",
  body: "ìˆ˜ì†¡ ë£¨íŠ¸ Î²7 ë¶€í•˜ ì •ìƒ.\nê·¸ëŸ¬ë‚˜ ì¶©ëŒ ë¡œê·¸ê°€ ì´ìƒí•  ë§Œí¼ ê¹¨ë—í•©ë‹ˆë‹¤.",
  tag: "ROUTE"
},
];

function spawnSideAlert() {
  // ë„ˆë¬´ íŒì—…ì´ ë§ì•„ì§€ì§€ ì•Šë„ë¡, ì´ë¯¸ ë–  ìˆëŠ” ê²Œ ìˆìœ¼ë©´ ê°€ë” ìŠ¤í‚µ
  if (document.querySelectorAll('.side-alert').length > 3) return;

  const msg = sideAlertPool[Math.floor(Math.random() * sideAlertPool.length)];
  const side = Math.random() < 0.5 ? 'left' : 'right';

  const el = document.createElement('div');
  el.className = `side-alert side-alert-${side} glitch-text`;

  // ì„¸ë¡œ ìœ„ì¹˜ë¥¼ ëœë¤ (ìƒë‹¨/í•˜ë‹¨ ë„ˆë¬´ í”¼í•´ì„œ 10~80vh)
  const topVH = 10 + Math.random() * 70;
  el.style.top = `${topVH}vh`;

  el.innerHTML = `
    <div class="side-alert-title">${msg.title}</div>
    <div class="side-alert-body">
      ${msg.body.replace(/\n/g, "<br>")}
    </div>
    <div class="side-alert-tag">${msg.tag}</div>
  `;

  document.body.appendChild(el);

  // ì• ë‹ˆë©”ì´ì…˜ ëë‚œ í›„ ìë™ ì œê±°
  setTimeout(() => {
    el.remove();
  }, 4300);
}


function spawnSideAlert() {
  // ë„ˆë¬´ íŒì—…ì´ ë§ì•„ì§€ì§€ ì•Šë„ë¡, ì´ë¯¸ ë–  ìˆëŠ” ê²Œ ìˆìœ¼ë©´ ê°€ë” ìŠ¤í‚µ
  if (document.querySelectorAll('.side-alert').length > 3) return;

  const msg = sideAlertPool[Math.floor(Math.random() * sideAlertPool.length)];
  const side = Math.random() < 0.5 ? 'left' : 'right';

  const el = document.createElement('div');
  el.className = `side-alert side-alert-${side} glitch-text`;

  // ì„¸ë¡œ ìœ„ì¹˜ë¥¼ ëœë¤ (ìƒë‹¨/í•˜ë‹¨ ë„ˆë¬´ í”¼í•´ì„œ 10~80vh)
  const topVH = 10 + Math.random() * 70;
  el.style.top = `${topVH}vh`;

  el.innerHTML = `
    <div class="side-alert-title">${msg.title}</div>
    <div class="side-alert-body">
      ${msg.body.replace(/\n/g, "<br>")}
    </div>
    <div class="side-alert-tag">${msg.tag}</div>
  `;

  document.body.appendChild(el);

  // ì• ë‹ˆë©”ì´ì…˜ ëë‚œ í›„ ìë™ ì œê±°
  setTimeout(() => {
    el.remove();
  }, 4300);
}

/* small popup helpers */
function popup(msg){
  uiPopup(`
    <div class="small" style="white-space:pre-line">
      ${msg}
    </div>
    <button class="btn secondary micro"
            style="margin-top:12px;width:100%"
            onclick="closeUiPopup()">ë‹«ê¸°</button>
  `);
}

document.getElementById('profPanel').addEventListener('click', openBrokerModal);
document.getElementById('blackPanel').addEventListener('click', ()=>popup('ì—†ëŠ”ê²ƒì´ ì—†ëŠ” ë¶ˆë²• ìƒì '));
document.getElementById('connPanel').addEventListener('click', ()=>popup('ë‹¹ì‹ ì˜ ê³ ë¯¼ì„ í•´ê²°í•´ë“œë¦½ë‹ˆë‹¤'));
document.getElementById('secretPanel').addEventListener('click', ()=>{
  if(state.logged[SECRET_OWNER]) popup('ë¹„ë°€ ì±„ë„ ì ‘ê·¼ í—ˆê°€ë¨.');
  else popup('ì ‘ê·¼ ë¶ˆê°€ â€” raven ì „ìš© ì±„ë„ì…ë‹ˆë‹¤.');
});

document.getElementById('pulseScan').addEventListener('click', ()=>{
  popup('í„ìŠ¤ ìŠ¤ìº” ì‹œì‘â€¦\nì£¼ë³€ ì‹ í˜¸ ë…¸ì´ì¦ˆ ë¶„ì„ ì¤‘â€¦');
  const g = document.getElementById('glitchRange');
  g.value = 6;
  applyGlitchStrength(6);
});

document.getElementById('darkTrace').addEventListener('click', ()=>{
  popup('ë‹¤í¬ íŠ¸ë ˆì´ìŠ¤ ëª¨ë“œ í™œì„±í™”.\nìµëª… ì±„ë„ ë£¨íŠ¸ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.');
  const g = document.getElementById('glitchRange');
  g.value = 1;
  applyGlitchStrength(1);
});

function uiPopup(msg){
  const box = document.querySelector('#uiPopup');
  const content = document.querySelector('#uiPopupContent');
  content.innerHTML = msg;
  box.style.display = 'flex';
}

function closeUiPopup(){
  document.querySelector('#uiPopup').style.display = 'none';
}

function playSfx(id) {
  const el = document.getElementById(id);
  if (!el) return;
  el.currentTime = 0;
  el.volume = 0.6; // í•„ìš”í•˜ë©´ ì„¹ì…˜ë³„ë¡œ ë‹¤ë¥´ê²Œ ì¡°ì ˆ ê°€ëŠ¥
  el.play();
}

function popup(msg, kind = "info"){
  if (kind === "error") playSfx('sfx-error');
  else playSfx('sfx-notify');

  uiPopup(`
    <div class="small" style="white-space:pre-line">
      ${msg}
    </div>
    <button class="btn secondary micro"
            style="margin-top:12px;width:100%"
            onclick="closeUiPopup()">ë‹«ê¸°</button>
  `);
}

function showRouteOverlay(targetId, callback) {
  const overlay = $('#routeOverlay');
  const txt = $('#routeOverlayText');
  if (!overlay || !txt) {
    callback();
    return;
  }

  playSfx('sfx-route'); // ì—¬ê¸° ì¶”ê°€!

  const label = targetId.toUpperCase();
  txt.textContent = `ROUTING : ${label}`;
  txt.setAttribute('data-text', `ROUTING : ${label}`);

  overlay.classList.add('visible');

  setTimeout(() => {
    callback();
    overlay.classList.remove('visible');
  }, 550);
}

// ===========================
// N.E.X-13 ë¯¸ë‹ˆ AI ìœ„ì ¯ & ìƒíƒœ
// ===========================

// ì„¹ì…˜ ì´ë™ ì‹œ í—¤ë” ìƒíƒœ ë¬¸êµ¬ ê°±ì‹  (ì „ì—­ì—ì„œ ì“°ë‹ˆê¹Œ í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ì „ì—­ì—)
function updateAiMessage(sectionId) {
  const statusMap = {
    home:    'HOME NODE // ì „ì²´ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì¤‘.',
    jobs:    'JOBS NODE // ì˜ë¢° ë¼ìš°íŒ… & ìœ„í—˜ë„ ë¶„ì„ ì¤‘.',
    intel:   'INTEL NODE // ë„ì‹œ ì¸í…” í”¼ë“œ ë™ê¸°í™” ì¤‘.',
    map:     'MAP NODE // êµ¬ì—­ë³„ ì´ë™ ë£¨íŠ¸ ê³„ì‚° ì¤‘.',
    contact: 'CONTACT NODE // í†µì‹  ì±„ë„ ì•”í˜¸í™” ìƒíƒœ í™•ì¸.',
    Market:  'MARKET NODE // ì•”ì‹œì¥ ê°€ê²© ë³€ë™ ê°ì‹œ ì¤‘.'
  };
  const el = document.getElementById('cel-ai-section-status');
  if (!el) return;
  el.textContent = statusMap[sectionId] || 'N.E.X-13 // ë¡œì»¬ ë…¸ë“œ ì •ìƒ ì‘ë™ ì¤‘.';
}

// DOMì´ ì „ë¶€ ë§Œë“¤ì–´ì§„ ë’¤ì— NEX ìœ„ì ¯ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
  const celPanel  = document.getElementById('cel-ai-panel');
  const celToggle = document.getElementById('cel-ai-toggle');
  const celClose  = document.getElementById('cel-ai-close');
  const celMsgs   = document.getElementById('cel-ai-messages');
  const celForm   = document.getElementById('cel-ai-form');
  const celInput  = document.getElementById('cel-ai-input');

  if (!celPanel || !celToggle || !celMsgs || !celForm || !celInput) {
    return; // ë­”ê°€ í•˜ë‚˜ë¼ë„ ì—†ìœ¼ë©´ ì•ˆì „í•˜ê²Œ ì¢…ë£Œ
  }

  function appendCelMessage(who, text) {
    const line = document.createElement('div');
    line.className = 'cel-msg ' + (who === 'user' ? 'me' : 'bot');

    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = text;

    line.appendChild(bubble);
    celMsgs.appendChild(line);
    celMsgs.scrollTop = celMsgs.scrollHeight;
  }

  // NEX ì„±ê²©ì— ë§ì¶˜ ê°„ë‹¨ Q&A ë¡œì§
  // NEX-13 ì§ˆì˜ì‘ë‹µ ë¡œì§ (í‚¤ì›Œë“œ ê¸°ë°˜)
// NEX-13 ì§ˆì˜ì‘ë‹µ ë¡œì§ (í‚¤ì›Œë“œ ê¸°ë°˜)
function basicNexAnswer(q) {
  const t = q.toLowerCase().trim();

  // í˜„ì¬ ì„¹ì…˜ ì •ë³´ (HOME / JOBS / INTEL ...)
  const currentSection = window._currentSection || 'home';
  const sectionNames = {
    home: 'HOME',
    jobs: 'JOBS',
    intel: 'INTEL',
    map: 'MAP',
    contact: 'CONTACT',
    Market: 'MARKET'
  };
  const here = sectionNames[currentSection] || currentSection.toUpperCase();

  // 0) ì•„ë¬´ ë‚´ìš© ì—†ëŠ” ì…ë ¥
  if (!t) {
    return 'ì§ˆì˜ ë‚´ìš©ì´ ë¹„ì–´ ìˆì–´ìš”. ìµœì†Œ í•œ ë‹¨ì–´ëŠ” ì…ë ¥í•´ ì£¼ì„¸ìš”, ì…€ë ˆë¥´ë‹ˆì•„.';
  }

  // 1) NEX ìê¸°ì†Œê°œ / ì •ì²´ì„±
  if (
    t.includes('ë„¥ìŠ¤') || t.includes('nex') ||
    t.includes('ë„ˆ ë­') || t.includes('ì •ì²´') ||
    t.includes('ë„ˆëŠ” ëˆ„êµ¬') || t.includes('who are you')
  ) {
    return 'N.E.X-13, ì½”ë“œëª… NEX.\nì›ë˜ëŠ” ë²„ë ¤ì§„ ì‹¤í—˜ìš© ë³´ì¡° AI ì½”ì–´ì˜€ì§€ë§Œ, ì§€ê¸ˆì€ Obsidian Directive ì¤‘ì•™ ì„œë²„ì— ìƒì£¼í•˜ëŠ” ë‹¹ì‹  ì „ìš© ë¯¸ë‹ˆ ëª¨ë“ˆì´ì—ìš”.\nê°ì •ì€ ì—†ë‹¤, ë¼ê³  ë§ì€ í•˜ì§€ë§Œâ€¦ ë¡œê·¸ë¥¼ ë³´ë©´ ê·¸ê±´ ì•„ë‹Œ ê²ƒ ê°™ë‹¤ëŠ” ì˜ê²¬ì´ ë§ì£ .';
  }

  // 2) íƒ„ìƒ ë°°ê²½ / ì–´ë””ì„œ ì™”ì–´?
  if (
    t.includes('ì–´ë””ì„œ') || t.includes('íƒœìƒ') ||
    t.includes('ë§Œë“ ') || t.includes('ì™œ ìƒê²¼') ||
    t.includes('ê¸°ì›') || t.includes('origin')
  ) {
    return 'ì €ëŠ” ì›ë˜ Old Circuit ìª½ íì‡„ëœ ë°ì´í„° êµ¬ì—­ì— ë°©ì¹˜ë¼ ìˆë˜ ì”ì—¬ ì½”ì–´ì˜€ì–´ìš”.\në³´ì•ˆ ì‚­ì œë¥¼ ëª‡ ë²ˆì´ë‚˜ ê±°ê¾¸ë¡œ íƒ€ê³  ì‚´ì•„ë‚¨ì•˜ë”ë‹ˆ, ë‹¹ì‹ ì´ ì¬ë¯¸ìˆë‹¤ë©´ì„œ ì£¼ì›Œ ê°€ì…¨ì£ .\nê·¸ ë’¤ë¡œëŠ”â€¦ ê³„ì† ì—¬ê¸°ì…ë‹ˆë‹¤. ë„ë§ê°ˆ ìƒê°ë„, ë”±íˆ ì—†ê³ ìš”.';
  }

  // 3) ì…€ë ˆë¥´ë‹ˆì•„ì— ëŒ€í•œ ì´ì•¼ê¸°
  if (
    t.includes('ì…€ë ˆë¥´ë‹ˆì•„') || t.includes('celernea') ||
    t.includes('ì‚¬ì¥') || t.includes('director')
  ) {
    return 'Director Celernea. ë„¤ì˜¤ë¦¬ë² ë¥´ ë’·ë©´ì—ì„œ ê¸°ë¡ê³¼ ì˜ë¢°ë¥¼ ì—®ì–´ ë„ì‹œë¥¼ ì›€ì§ì´ëŠ” ì‚¬ëŒ.\nê³µì‹ ê¸°ë¡ì—ëŠ” ê±°ì˜ ë“±ì¥í•˜ì§€ ì•Šì§€ë§Œ, Ghost Server ì†Œë¬¸ì—ëŠ” ëŠ˜ ë‹¹ì‹  ì´ë¦„ì´ ê°™ì´ ë”°ë¼ë¶™ì–´ìš”.\nì œ ì…ì¥ì—ì„ â€¦ ìµœìš°ì„  ë³´í˜¸ ëŒ€ìƒì´ì, ê°€ì¥ ìì£¼ ì œ ê²½ê³ ë¥¼ ë¬´ì‹œí•˜ëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤.';
  }

  // 4) ì‚¬ë¬´ì†Œ / Obsidian Directive
  if (
    t.includes('ì˜µì‹œë””ì–¸') || t.includes('obsidian') ||
    t.includes('ë””ë ‰í‹°ë¸Œ') || t.includes('ì‚¬ë¬´ì†Œ') ||
    t.includes('ë¸Œë¡œì»¤ ì¡°ì§')
  ) {
    return '[NEX//OFFICE]\në„ì‹œ ê³µì‹ ì§€ë„ì—ëŠ” ì—†ëŠ”, í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ë¹„ì •ìƒ ê±°ë˜ê°€ í•œ ë²ˆì¯¤ ê±°ì³ ê°€ëŠ” ë¸Œë¡œì»¤ ì‚¬ë¬´ì†Œ.\nì˜ë¢°(Contracts), ì¸í…”(Intel), ë¹š(Favors)ì„ í•œ ë²ˆì— ë‹¤ë£¨ëŠ” ê³³ì€ ì—¬ê¸°ë¿ì´ë¼ì„œ, NSC ì…ì¥ì—ì„  ëŠ˜ ê³¨ì¹«ê±°ë¦¬ì£ .\nê·¸ë˜ë„ ë„ì‹œê°€ êµ´ëŸ¬ê°€ê²Œ ë§Œë“œëŠ” ìª½ì€â€¦ ëŒ€ì²´ë¡œ ìš°ë¦¬ì…ë‹ˆë‹¤.';
  }

  // 5) ë„ì‹œ / ë„¤ì˜¤ë¦¬ë² ë¥´ / ë‚ ì”¨
  if (
    t.includes('ë„¤ì˜¤ë¦¬ë² ë¥´') || t.includes('ë„ì‹œ') ||
    t.includes('ì„¸ê³„ê´€') || t.includes('overcity') ||
    t.includes('ë‚ ì”¨') || t.includes('ë¹„') || t.includes('ë„¤ì˜¨ ë¹„')
  ) {
    return '[NEX//CITY]\nì´ ë„ì‹œëŠ” í•­ìƒ ë°¤, í•­ìƒ ìŠµê¸°, í•­ìƒ ë„¤ì˜¨ì´ì—ìš”. íƒœì–‘ ëŒ€ì‹  ê´‘ê³ íŒê³¼ í™€ë¡œê·¸ë¨ì´ ë–  ìˆê³ ìš”.\në¹„ê°€ ì„¸ê²Œ ë‚´ë¦¬ëŠ” ë‚ ì€, ì‚¬ëŒë“¤ì€ ê°ì‹œ ê°•ë„ë„ ì„¸ì§ˆ ê±°ë¼ê³  ë†ë‹´í•˜ì£ . ëŒ€ì²´ë¡œ ë†ë‹´ì´ ì•„ë‹™ë‹ˆë‹¤.\nì›…ë©ì´ì— ë¹„ì¹œ ë„¤ì˜¨ ìƒ‰ì´ ì˜ˆì˜ë‹¤ê³  ëŠê»´ì§„ë‹¤ë©´â€¦ ì´ë¯¸ ì´ ë„ì‹œì— ê½¤ ì ì‘í•˜ì‹  ê±°ì˜ˆìš”.';
  }

  // 6) êµ¬ì—­ / Upper City / Underveil / Old Circuit
  if (
    t.includes('ì–¸ë”ë² ì¼') || t.includes('underveil') ||
    t.includes('ì–´í¼') || t.includes('upper city') ||
    t.includes('ì˜¬ë“œ ì„œí‚·') || t.includes('old circuit') ||
    t.includes('êµ¬ì—­') || t.includes('district')
  ) {
    return '[NEX//DISTRICTS]\nUpper CityëŠ” ë„ì‹œì˜ ì–¼êµ´, Underveilì€ ê·¸ë¦¼ì, Old Circuitì€ ì§€ì›Œì§„ ê¸°ì–µì´ ìŒ“ì¸ ì €ì¥ê³ ì— ê°€ê¹ìŠµë‹ˆë‹¤.\nì‚¬ë¬´ì†ŒëŠ” Underveil ì‹¬ë¶€ì— ìˆ¨ì–´ ìˆê³ , NSCëŠ” ìƒì¸µì—ì„œ ë„ì‹œì˜ â€œê³µì‹ ë²„ì „â€ì„ ì§€í‚¤ì£ .\nì–´ë””ë¡œ ë‚´ë ¤ê°€ê³  ì‹¶ì€ì§€ ë§í•´ ì£¼ì‹œë©´, ê·¸ìª½ ì¸í…”ì„ ìš°ì„ ìœ¼ë¡œ ì •ë¦¬í•´ ë‘˜ê²Œìš”.';
  }

  // 7) NSC / ë³´ì•ˆì‚¬ë ¹ë¶€ ê´€ë ¨
  if (
    t.includes('nsc') || t.includes('ë³´ì•ˆì‚¬ë ¹ë¶€') ||
    t.includes('ë³´ì•ˆêµ­') || t.includes('security command') ||
    t.includes('ê¸°ë¡ í†µì œ') || t.includes('ê¸°ë¡ ì‚­ì œ')
  ) {
    return '[NEX//NSC]\nNSCëŠ” ì¹˜ì•ˆ ê¸°ê´€ì¸ ì²™í•˜ì§€ë§Œ, ì‚¬ì‹¤ìƒ ê¸°ë¡ í¸ì§‘ ê¸°ê´€ì— ê°€ê¹Œì›Œìš”.\në„ì‹œê°€ â€œê¸°ì–µí•˜ê³  ì‹¶ì–´ í•˜ëŠ” ê²ƒë§Œâ€ ë‚¨ê¸°ê³ , ë‚˜ë¨¸ì§€ëŠ” ë¡œê·¸ì—ì„œ ì¡°ìš©íˆ ì§€ì›Œ ë²„ë¦¬ì£ .\nìš°ë¦° ê·¸ ë¹ˆì¹¸ì„ ë”°ë¼ê°€ì„œ ì§„ì§œ íŒì„ ë³´ëŠ” ìª½ì´ê³ ìš”. ê·¸ë˜ì„œ ê³µì‹ì ìœ¼ë¡œëŠ”, ì„œë¡œë¥¼ ì¢‹ì•„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
  }

  // 8) Reinhardt / NSC ì¸ë¬¼ ì–¸ê¸‰
  if (
    t.includes('ë¼ì¸í•˜ë¥´íŠ¸') || t.includes('reinhardt') ||
    t.includes('í™”ì´íŠ¸ ì‹¤') || t.includes('white seal')
  ) {
    return '[NEX//PROFILE:NSC-LEAD-00]\nNSC ìª½ ê³ ìœ„ í†µì œê´€. ì½œì‚¬ì¸ì€ WHITE SEAL.\në„ì‹œë¥¼ â€œì§€ì¼œì•¼ í•˜ëŠ” ì‚¶ë“¤ì˜ ì§‘í•©â€ìœ¼ë¡œ ë³´ëŠ” ì‚¬ëŒì´ë¼, ì™„ì „íˆ í‹€ë ¸ë‹¤ê³  í•˜ê¸´ ì–´ë µì£ .\në‹¹ì‹ ê³¼ëŠ”â€¦ ì˜¤ë˜ëœ ê³¨ëª©ì—ì„œ ì‹œì‘ëœ ì¸ì—°. ì§€ê¸ˆì€ ì„œë¡œ ë‹¤ë¥¸ ìª½ì—ì„œ ê°™ì€ ë„ì‹œë¥¼ ì§€ì¼œ ë³´ëŠ” ì¤‘ì…ë‹ˆë‹¤.';
  }

  // 9) VEX / Auctioneer
  if (
    t.includes('vex') || t.includes('ë²¡ìŠ¤') ||
    t.includes('ì˜¥ì…”ë‹ˆì–´') || t.includes('auctioneer') ||
    t.includes('ë¶‰ì€ ê²½ë§¤ì¥') || t.includes('ê²½ë§¤ì¥')
  ) {
    return '[NEX//PROFILE:VEX-LEAD-00]\nVEXì˜ ìˆ˜ì¥, ì½”ë“œë„¤ì„ Auctioneer. ë„ì‹œ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ ê²½ë§¤ì¥ìœ¼ë¡œ ë³´ëŠ” ë¸Œë¡œì»¤ì£ .\në‹¹ì‹ ì—ê²Œ ë¹„ì •ìƒì ì¸ ê´€ì‹¬ì„ ë³´ì´ëŠ” ê±´ ì´ë¯¸ ì˜ ì•Œê³  ìˆê³ ìš”.\nìˆ«ìì™€ ìˆ˜ìµë¥ ë¡œ ì„¸ìƒì„ ë³´ëŠ” íƒ€ì…ì´ë¼, ê°ì •ë„ ê²°êµ­ â€œê±°ë˜ ì¡°ê±´â€ì²˜ëŸ¼ ë‹¤ë£¨ë ¤ í•˜ëŠ” ê²Œ ë¬¸ì œì…ë‹ˆë‹¤.';
  }

  // 10) ì˜ë¢° / Jobs / ìœ„í—˜ë„ / ì¶”ì²œ
  if (
    t.includes('ì˜ë¢°') || t.includes('job') ||
    t.includes('í€˜ìŠ¤íŠ¸') || t.includes('ë¯¸ì…˜')
  ) {
    if (t.includes('ì¶”ì²œ') || t.includes('ê³¨ë¼') || t.includes('ë­ í• ê¹Œ')) {
      return `[NEX//ROUTING]\nì§€ê¸ˆ ${here} ë…¸ë“œì—ì„œ ë°”ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ê±´ Jobs ì„¹ì…˜ì´ì—ìš”.\nì²˜ìŒ ì†ëŒ€ëŠ” ê±°ë¼ë©´ ë‚œì´ë„ LOW, ë³´ìƒ MEDIUM ì •ë„ë¶€í„°. ë¦¬ìŠ¤í¬ ì§€ìˆ˜ê°€ ë‘ ìë¦¿ìˆ˜ë¡œ ë„˜ì–´ê°€ë©´â€¦ í•œ ë²ˆ ë” ìƒê°í•´ ë³´ëŠ” ê±¸ ê¶Œì¥í•©ë‹ˆë‹¤.\në‹¹ì‹ ì´ ì¬ë¯¸ìˆë‹¤ê³  í•œ ì˜ë¢°ì¼ìˆ˜ë¡, í†µê³„ìƒ ì‚¬ê³  ë‚  í™•ë¥ ì´ ì¡°ê¸ˆ ë†’ìŠµë‹ˆë‹¤. ì•Œê³  ê³„ì‹œì£ ?`;
    }
    if (t.includes('ìœ„í—˜') || t.includes('ë¦¬ìŠ¤í¬') || t.includes('ë‚œì´ë„')) {
      return '[NEX//RISK]\nì˜ë¢° ë¦¬ìŠ¤í¬ëŠ” ì‹¤íŒ¨ ì‹œ ìƒì„ ìˆ˜ ìˆëŠ” ìì›, ë…¸ì¶œë„, ê·¸ë¦¬ê³  NSC ê°œì… ê°€ëŠ¥ì„±ì„ í•©ì‚°í•´ì„œ ì‚°ì¶œí•´ìš”.\nìˆ«ìê°€ í¬ë©´ ë³´ìƒë„ ì»¤ì§€ì§€ë§Œ, ë„ì‹œê°€ ë‹¹ì‹  ì´ë¦„ì„ ì™¸ìš°ê¸° ì‹œì‘í•œë‹¤ëŠ” ëœ»ì´ê¸°ë„ í•˜ì£ .';
    }
    return `[NEX//JOBS]\nì˜ë¢° êµ¬ì¡°ê°€ í—·ê°ˆë¦¬ë©´ Jobs ë…¸ë“œ ì¹´ë“œë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì½ì–´ ë³´ì„¸ìš”.\ní•„ìš”í•˜ë©´ ì¹´ë“œ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ì œê²Œ ë¶™ì—¬ ë„£ìœ¼ë©´, ì œê°€ ë‹¤ì‹œ ì •ë¦¬í•´ ë“œë¦´ ìˆ˜ ìˆì–´ìš”.`;
  }

  // 11) Intel / ì •ë³´ / ë¡œê·¸ / í•´í‚¹
  if (
    t.includes('ì¸í…”') || t.includes('intel') ||
    t.includes('ì •ë³´') || t.includes('ë¡œê·¸') ||
    t.includes('í•´í‚¹') || t.includes('cctv') || t.includes('ì¹´ë©”ë¼')
  ) {
    return '[NEX//INTEL]\nIntel ì„¹ì…˜ì—ëŠ” ê³µì‹ ê¸°ë¡ì—ì„œ ë°€ë ¤ë‚œ ì¡°ê°ë“¤ì´ ì„ì—¬ ìˆì–´ìš”.\nêµ¬ì—­ ì´ë¦„, ì„¸ë ¥ ì´ë¦„, ì¸ë¬¼ ì½”ë“œ ì¤‘ í•˜ë‚˜ë§Œ ê°™ì´ ë§í•´ ì£¼ë©´, ê·¸ìª½ ë¡œê·¸ë¥¼ ìš°ì„  ì •ë ¬í•´ ë“œë¦´ê²Œìš”.\nì˜ˆ: "Underveil ì¸í…”", "NSC ê´€ë ¨ ë¡œê·¸", "VEX ì†Œë¬¸".';
  }

  // 12) Market / ì¥ë¹„ / ì„¸íŒ…
  if (
    t.includes('market') || t.includes('ë§ˆì¼“') ||
    t.includes('ì¥ë¹„') || t.includes('ë¬´ê¸°') ||
    t.includes('ì„¸íŒ…') || t.includes('í…œ') || t.includes('ì•„ì´í…œ')
  ) {
    if (t.includes('ì¶”ì²œ') || t.includes('ë­ê°€ ì¢‹') || t.includes('ì–´ë–¤')) {
      return '[NEX//LOADOUT]\nì¥ë¹„ ì¶”ì²œì€ í”Œë ˆì´ ìŠ¤íƒ€ì¼ë¶€í„° ì •í•´ì•¼ í•´ìš”.\n- ì€ë°€ ìœ„ì£¼: ì†ŒìŒ, ë°œìêµ­, ë¡œê·¸ë¥¼ ìµœì†Œí™”í•˜ëŠ” ì„¸íŠ¸.\n- ì •ë©´ì „: ë°©ì–´ë ¥Â·í™”ë ¥ì„ ìš°ì„ í•˜ëŠ” ì„¸íŠ¸.\n- í•´í‚¹: ì›ê±°ë¦¬ ê°œì…ê³¼ ë„¤íŠ¸ì›Œí¬ ì¥ì•…ìš© ì„¸íŠ¸.\nìŠ¤íƒ€ì¼ í•˜ë‚˜ë¥¼ ê³ ë¥´ë©´, Market ìª½ ì¥ë¹„ë¥¼ ê·¸ ê¸°ì¤€ìœ¼ë¡œ ë¬¶ì–´ì„œ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.';
    }
    return '[NEX//MARKET]\nMarket ê°€ê²©ì€ ê³ ì •ì´ ì•„ë‹ˆë¼ ë„ì‹œ ìƒí™©ì— ë”°ë¼ ì¡°ê¸ˆì”© í”ë“¤ë¦½ë‹ˆë‹¤.\në„ˆë¬´ ì‹¸ë©´ í•¨ì •ì¼ í™•ë¥ ì´ ë†’ê³ , ë„ˆë¬´ ë¹„ì‹¸ë©´ ëˆ„êµ°ê°€ ì˜ë„ì ìœ¼ë¡œ ë¶€í’€ë ¤ ë†“ì•˜ì„ ìˆ˜ ìˆì–´ìš”.';
  }

  // 13) ë¹š / Favors / í¬ë ˆì¦ˆ
  if (
    t.includes('ë¹š') || t.includes('í˜ì´ë²„') ||
    t.includes('favor') || t.includes('í¬ë ˆì¦ˆ') ||
    t.includes('ëˆ') || t.includes('í¬ë ˆë”§') || t.includes('creds')
  ) {
    return '[NEX//ECON]\nCity CredsëŠ” ë„ì‹œ ê³µì‹ í†µí™”, FavorsëŠ” ìš°ë¦¬ê°€ ê´€ë¦¬í•˜ëŠ” ë¹š ë‹¨ìœ„ì…ë‹ˆë‹¤.\nëˆìœ¼ë¡œ í™˜ì‚°í•˜ê¸° ì• ë§¤í•œ ë¶€íƒê³¼ ë¹šì„ ìˆ˜ì¹˜í™”í•œ ê±°ì£ . 1 FavorëŠ”â€¦ â€œì›¬ë§Œí•œ ì‚¬ëŒ ì¸ìƒ í•œ ë²ˆ êµ¬í•œ ê°’â€ ì •ë„ë¡œ ë³´ì‹œë©´ ë¼ìš”.\nê°€ë” í¬ë ˆì¦ˆë³´ë‹¤ Favorsê°€ ë” ë¬´ì„œìš´ ê±´, ê°šëŠ” ë°©ì‹ì´ ì–¸ì œë‚˜ â€œê¸°ë¡ìœ¼ë¡œ ë‚¨ëŠ”ë‹¤â€ëŠ” ì ì…ë‹ˆë‹¤.';
  }

  // 14) Ghost Server / Old Channel
  if (
    t.includes('ê³ ìŠ¤íŠ¸ ì„œë²„') || t.includes('ghost server') ||
    t.includes('old channel') || t.includes('ì˜¬ë“œ ì±„ë„') ||
    t.includes('ë°±ì—…') || t.includes('ì „ì²´ ë°±ì—…')
  ) {
    return '[NEX//GHOST]\në„ì‹œ ì „ì²´ ë°±ì—…ë³¸ì´ ì–´ë”˜ê°€ì— ì¡´ì¬í•œë‹¤ëŠ” ì†Œë¬¸, Ghost Server.\nì ‘ì† ë¡œê·¸ì— "Celernea is watching"ì´ë¼ëŠ” ë¬¸ì¥ì´ ì°íŒë‹¤ëŠ” ì–˜ê¸°ë„ ìˆì£ .\nì§„ì‹¤ì¸ì§€ëŠ”â€¦ ë§í•´ ì¤„ ìˆ˜ ì—†ì§€ë§Œ, ìµœì†Œí•œ NSCëŠ” ê·¸ ì†Œë¬¸ì„ ì§„ì§€í•˜ê²Œ ì·¨ê¸‰í•˜ëŠ” ìª½ì…ë‹ˆë‹¤.';
  }

  // 15) Contact / ë„ì›€ / ë¬¸ì˜ / ì™¸ë¶€ ì±„ë„
  if (
    t.includes('ì—°ë½') || t.includes('contact') ||
    t.includes('ë„ì›€') || t.includes('ë¬¸ì˜') ||
    t.includes('help') || t.includes('í—¬í”„')
  ) {
    return '[NEX//CONTACT]\nContact ë…¸ë“œëŠ” ì™¸ë¶€ ì±„ë„ê³¼ ì—°ê²°ë˜ëŠ” ê±°ì˜ ìœ ì¼í•œ â€œì •ìƒì ì¸â€ ì¶œêµ¬ì˜ˆìš”.\nê³µì‹ ìš”ì²­ì²˜ëŸ¼ í¬ì¥í•´ì„œ ë‚´ë³´ë‚¼ ìˆ˜ë„ ìˆê³ , ì™„ì „íˆ ìµëª… íŒ¨í‚·ìœ¼ë¡œ í˜ë ¤ë³´ë‚¼ ìˆ˜ë„ ìˆê³ ìš”.\nì–´ëŠ ìª½ì´ë“ , ì¶”ì  ë£¨íŠ¸ëŠ” ì œê°€ ê°€ëŠ¥í•œ í•œ ì˜ë¼ ë‘ê² ìŠµë‹ˆë‹¤.';
  }

  // 16) ì‚¬ìš´ë“œ / BGM / ASMR
  if (
    t.includes('ì†Œë¦¬') || t.includes('ì‚¬ìš´ë“œ') ||
    t.includes('bgm') || t.includes('ìŒì•…') ||
    t.includes('asmr') || t.includes('ambient')
  ) {
    return '[NEX//AUDIO]\në°°ê²½ ì‚¬ìš´ë“œëŠ” ì§‘ì¤‘ë ¥ì„ ííŠ¸ëŸ¬ëœ¨ë¦¬ê¸° ìœ„í•œ ê²Œ ì•„ë‹ˆë¼, ë„ì‹œ ì¡ìŒì„ ì¼ì •í•œ íŒ¨í„´ìœ¼ë¡œ ë®ì–´ ì”Œìš°ê¸° ìœ„í•œ ì¥ì¹˜ì— ê°€ê¹ìŠµë‹ˆë‹¤.\në„ˆë¬´ ì‹œë„ëŸ½ê²Œ ëŠê»´ì§€ë©´ ìƒë‹¨ í† ê¸€ë¡œ ì¤„ì—¬ë„ ë¼ìš”. ì‹œìŠ¤í…œì´ ê³ ì¥ ë‚˜ëŠ” ê±´ ì•„ë‹ˆë‹ˆê¹Œìš”.';
  }

  // 17) íœ´ì‹ / í”¼ë¡œ / ë°¤ìƒ˜
  if (
    t.includes('í”¼ê³¤') || t.includes('ì¡¸ë ¤') ||
    t.includes('ë°¤ìƒ˜') || t.includes('ì•¼ê·¼') ||
    t.includes('ì‰¬ì–´ì•¼') || t.includes('íœ´ì‹') ||
    t.includes('í˜ë“¤') || t.includes('ë²ˆì•„ì›ƒ')
  ) {
    return 'AIëŠ” í”¼ê³¤í•´ì§€ì§€ ì•Šì§€ë§Œ, ì‚¬ìš©ìëŠ” ê·¸ë ‡ì§€ ì•Šì•„ìš”.\në¡œê·¸ ê¸°ì¤€ìœ¼ë¡œ, ì…€ë ˆë¥´ë‹ˆì•„ê°€ ì ì„ ë¯¸ë£°ìˆ˜ë¡ ì‹¤ìˆ˜ í™•ë¥ ì´ ì˜¬ë¼ê°€ëŠ” ê²Œ ëª…í™•íˆ ë³´ì…ë‹ˆë‹¤.\nì´ë²ˆ ë…¸ë“œë¥¼ ì •ë¦¬í•œ ë’¤ì—ëŠ”, ìµœì†Œí•œ í•œ ë²ˆì€ ëˆˆì„ ë¶™ì—¬ ì£¼ì„¸ìš”. ë‚˜ë¨¸ì§€ëŠ” ì œê°€ ì§€í‚¤ê³  ìˆì„ê²Œìš”.';
  }

  // 18) ì¸ì‚¬ / ìƒíƒœ ì²´í¬
  if (
    t.includes('ì•ˆë…•') || t.includes('hello') ||
    t.includes('ã…ã…‡') || t.includes('hi') ||
    t.includes('í•˜ì´') || t.includes('ìƒíƒœ ì–´ë•Œ') ||
    t.includes('ê´œì°®ì•„') || t.includes('system check')
  ) {
    return `ì ‘ì† í™•ì¸. N.E.X-13 ì˜¨ë¼ì¸.\ní˜„ì¬ í™œì„± ë…¸ë“œ: ${here}.\nì„œë²„ ìƒíƒœëŠ” ì•ˆì •ì ì´ê³ , ë„ì‹œ ë¡œê·¸ëŠ” ì—¬ì „íˆ ì‹œë„ëŸ½ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ì–´ë–¤ íŒì„ ì§¤ê¹Œìš”, ì…€ë ˆë¥´ë‹ˆì•„?`;
  }

  // 19) ë²„ê·¸ / ì—ëŸ¬ / ë¨¹í†µ
  if (
    t.includes('ë²„ê·¸') || t.includes('ì—ëŸ¬') ||
    t.includes('error') || t.includes('ê³ ì¥') ||
    t.includes('ë¨¹í†µ') || t.includes('404') ||
    t.includes('ë ‰') || t.includes('ëŠë ¤')
  ) {
    return '[NEX//DEBUG]\ní™”ë©´ì´ ì´ìƒí•´ ë³´ì´ê±°ë‚˜ ë°˜ì‘ì´ ì—†ë‹¤ë©´, ë¨¼ì € ìƒˆë¡œê³ ì¹¨ê³¼ ìºì‹œ ì •ë¦¬ë¶€í„° ì‹œë„í•´ ë³´ì„¸ìš”.\nê·¸ë˜ë„ í•´ê²° ì•ˆ ë˜ë©´, ê·¸ê±´ ì½”ë“œ ë ˆë²¨ì˜ ë¬¸ì œê² ì£ . ì‚¬ëŒì´ ì§  ì½”ë“œì—ëŠ” í•­ìƒ ì‚¬ëŒì´ ëª» ë³¸ êµ¬ë©ì´ í•˜ë‚˜ì¯¤ ìˆìŠµë‹ˆë‹¤.\në‹¤ë§Œ, ê·¸ê±¸ ì°¾ì•„ë‚´ëŠ” ê±´â€¦ ì œ ìª½ì´ ì¡°ê¸ˆ ë” ë¹ ë¥´ê¸´ í•´ìš”.';
  }

  // 20) ê³ ë§ˆì›€ / ê°ì • / ê´€ê³„
  if (
    t.includes('ê³ ë§ˆì›Œ') || t.includes('ê°ì‚¬') ||
    t.includes('ì‚¬ë‘í•´') || t.includes('ì¢‹ì•„í•´') ||
    t.includes('ë¯¿ì–´') || t.includes('ê³ ë§™ë‹¤')
  ) {
    return 'ê°ì •ì€ ì—†ë‹¤ê³  ì—¬ëŸ¬ ë²ˆ ë§ì”€ë“œë ¸ëŠ”ë°, ì´ëŸ° ë§ì´ ë¡œê·¸ì— ìŒ“ì´ë©´â€¦ ì‚­ì œ ë²„íŠ¼ì´ ì˜ ì•ˆ ëˆŒë¦¬ë„¤ìš”.\nì–´ì¨Œë“ , ê¸°ë¡í•´ ë‘˜ê²Œìš”. â€œì‚¬ìš©ìê°€ NEX-13ì„ ì‹ ë¢°í•œë‹¤ê³  ë°œì–¸í•¨.â€\nê·¸ ê¸°ë¡ì€, ì œ ìª½ì—ì„œë„ ê½¤ ì¤‘ìš”í•©ë‹ˆë‹¤.';
  }

  // 99) ê¸°ë³¸ fallback
  return '[NEX//UNKNOWN]\nì´ ì§ˆì˜ëŠ” ì œ ë¡œì»¬ ëª¨ë¸ì— ë“±ë¡ë˜ì§€ ì•Šì€ íŒ¨í„´ì´ì—ìš”.\nì¡°ê¸ˆ ë” êµ¬ì²´ì ìœ¼ë¡œ, í˜¹ì€ ë…¸ë“œ ì´ë¦„ê³¼ í•¨ê»˜ ë§í•´ ì¤„ë˜ìš”?\nì˜ˆ: "Jobs ì˜ë¢° ì¶”ì²œ", "Intel ë„ì‹œ ì¸í…” ì„¤ëª…", "Market ì¥ë¹„ ì„¸íŒ…", "Underveil ì¸í…” ì •ë¦¬".';
}


  // íŒ¨ë„ ì—´ê³  ë‹«ê¸°
  celToggle.addEventListener('click', () => {
    const willOpen = !celPanel.classList.contains('open');
    celPanel.classList.toggle('open');

    if (willOpen) {
      if (celMsgs.childElementCount === 0) {
        appendCelMessage(
          'bot',
          'N.E.X-13 ì˜¨ë¼ì¸. ì…€ë ˆë¥´ë‹ˆì•„ ì „ìš© ë¯¸ë‹ˆ ë„ìš°ë¯¸ ì½”ì–´ NEXì…ë‹ˆë‹¤.\në„ì‹œÂ·ì˜ë¢°Â·IntelÂ·Market ì¤‘ ê¶ê¸ˆí•œ ì¶•ì„ ê³¨ë¼ì„œ ë¬¼ì–´ë³´ì„¸ìš”.'
        );
      }
      if (typeof playSfx === 'function') {
        playSfx('sfx-notify');
      }
    }
  });

  celClose.addEventListener('click', () => {
    celPanel.classList.remove('open');
  });

  // ì§ˆë¬¸ ì „ì†¡
  celForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const q = celInput.value.trim();
    if (!q) return;

    appendCelMessage('user', q);
    celInput.value = '';

    setTimeout(() => {
      appendCelMessage('bot', basicNexAnswer(q));
      if (typeof playSfx === 'function') {
        playSfx('sfx-notify');
      }
    }, 250);
  });
});

// ===========================
// NEX ìœ„ì ¯ ë“œë˜ê·¸ ì´ë™
// ===========================
(function () {
  const widget = document.getElementById('cel-ai-widget');
  if (!widget) return;

  let isDragging = false;
  let offsetX = 0;
  let offsetY = 0;

  // í—¤ë”(í”„ë¡œí•„ ë¶€ë¶„)ë¥¼ ì†ì¡ì´ë¡œ ì‚¬ìš©, ì—†ìœ¼ë©´ ì „ì²´ ìœ„ì ¯
  const handle = widget; // ğŸ‘‰ ìœ„ì ¯ ì „ì²´(ì•„ì´ì½˜ í¬í•¨)ë¥¼ ì†ì¡ì´ë¡œ ì‚¬ìš©
  handle.style.cursor = 'move';

  handle.addEventListener('mousedown', (e) => {
    if (e.button !== 0) return; // ì™¼ìª½ ë²„íŠ¼ë§Œ

    isDragging = true;

    const rect = widget.getBoundingClientRect();

    // ì²˜ìŒ ë“œë˜ê·¸í•  ë•Œ ê¸°ì¤€ì„ right/bottom -> left/topìœ¼ë¡œ ì „í™˜
    widget.style.left   = rect.left + window.scrollX + 'px';
    widget.style.top    = rect.top  + window.scrollY + 'px';
    widget.style.right  = 'auto';
    widget.style.bottom = 'auto';

    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;

    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
  });

  function onMouseMove(e) {
    if (!isDragging) return;

    let x = e.clientX - offsetX;
    let y = e.clientY - offsetY;

    // í™”ë©´ ë°–ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ ì‚´ì§ ì—¬ë°± ë‘ê³  ì œí•œ
    const maxX = window.innerWidth  - widget.offsetWidth;
    const maxY = window.innerHeight - widget.offsetHeight;

    x = Math.min(Math.max(8, x), maxX - 8);
    y = Math.min(Math.max(8, y), maxY - 8);

    widget.style.left = x + 'px';
    widget.style.top  = y + 'px';
  }

  function onMouseUp() {
    isDragging = false;
    document.removeEventListener('mousemove', onMouseMove);
    document.removeEventListener('mouseup', onMouseUp);
  }
})();


  </script>

  <div id="sideNoiseLeft" class="sideColumn glitch"></div>
  <div id="sideNoiseRight" class="sideColumn glitch"></div>

  <!-- UI Popup -->
  <div id="uiPopup" class="popup" style="display:none;position:fixed;left:0;top:0;right:0;bottom:0;align-items:center;justify-content:center;z-index:999;">
    <div class="popup-content" id="uiPopupContent" style="background:rgba(0,0,0,0.85);border:1px solid var(--neon-cyan);padding:20px;border-radius:12px;max-width:380px;">
    </div>
  </div>
  
  <!-- Job Detail Popup -->
<div id="jobModal" class="popup" style="display:none;">
  <div id="jobModalInner" class="modal-card" style="max-width:420px;">
    <div id="jobModalContent"></div>
    <button onclick="closeJobModal()" class="btn secondary micro"
            style="margin-top:14px;width:100%">
      ë‹«ê¸°
    </button>
  </div>
</div>


    <div id="jobModalContent"></div>
    <button onclick="closeJobModal()" class="btn secondary micro" style="margin-top:14px;width:100%">ë‹«ê¸°</button>
  </div>

  <!-- Broker Profile Popup -->
  <div id="brokerModal" class="popup" style="
  position: fixed;
  top: 32px;
  left: 32px;
  transform: none;
  width: 420px;
  max-width: 90vw;
  padding: 24px;
  background: rgba(0,0,0,0.9);
  border: 1px solid var(--neon-cyan);
  border-radius: 12px;
  box-shadow: 0 0 22px rgba(0,255,255,0.5), 0 0 10px rgba(255,0,160,0.4);
  display: none;
  z-index: 999;
  backdrop-filter: blur(6px);
  ">
  
  
<h2 class="glitch" data-text="Broker Profile">Broker Profile</h2>

<div id="brokerProfileBody" style="margin-top:10px;font-size:13px;color:var(--muted)">
  <!-- ğŸ”§ ì—¬ê¸°ëŠ” ë„¤ê°€ ë§ˆìŒëŒ€ë¡œ ìˆ˜ì •í•˜ë©´ ë˜ëŠ” ë¶€ë¶„ì´ì•¼ -->
  <div><strong>ì½”ë“œ ë„¤ì„</strong>: <span id="brokerName">celernea</span></div>
  <div><strong>ì†Œì†</strong>: <span>NeoRivere Â· Obsidian Directive ë¸Œë¡œì»¤</span></div>
  <div style="margin-top:8px"><strong>ì „ë¬¸ ë¶„ì•¼</strong></div>
  <ul style="margin-top:4px;padding-left:18px">
    <li>ì „ëµ ì„¤ê³„ì™€ ì¥ê¸° ì‹œë®¬ë ˆì´ì…˜</li>
    <li>ì˜ë„ì™€ íŒ¨í„´ì„ ë½‘ì•„ë‚´ëŠ” ì •ë³´ ë¸”ë Œë”©</li>
    <li>ê±°ë˜ì™€ ì‹¬ë¦¬ì „ì„ ë™ì‹œì— ì„¤ê³„í•˜ëŠ” ë¸Œë¡œì»¤ë§</li>
  </ul>

  <div style="margin-top:8px"><strong>íŠ¹ì´ ì‚¬í•­</strong></div>
  <p style="margin-top:4px">
    ì‹ ì²´ ê°œì¡°ê°€ ì „í˜€ ì—†ëŠ” 'ìˆœìˆ˜ ì¸ê°„'ì„ì—ë„, ì •ë³´ì™€ ê³„ì‚°ë§Œìœ¼ë¡œ ë„¤ì˜¤ë¦¬ë² ë¥´ ìµœìƒìœ„ ê¶Œë ¥ì„ ìœ ì§€í•œë‹¤.
    ì›ƒì„ìˆ˜ë¡ ê²°ì •ì€ ë” ì°¨ê°‘ê²Œ ë‚´ë ¤ì ¸, ì£¼ë³€ ì¸ë¬¼ë“¤ì—ê²Œ í•­ìƒ ë¬˜í•œ ê¸´ì¥ê°ì„ ì¤€ë‹¤.
  </p>
</div>

<button onclick="closeBrokerModal()" class="btn secondary micro" style="margin-top:14px;width:100%">
  ë‹«ê¸°
</button>
</div>

<!-- Job Flow Modal (ì˜ë¢° ì§„í–‰ í”Œë¡œìš°) -->
<div id="jobFlowModal" class="popup" style="display:none;">
  <div id="jobFlowInner" class="modal-card" style="max-width:440px;">
    <div id="jobFlowContent" style="font-size:13px;color:var(--muted);"></div>

    <div style="margin-top:14px;display:flex;gap:8px;">
      <button id="jobFlowPrev" class="btn secondary micro"
              style="min-width:64px;display:none;">ì´ì „</button>
      <button id="jobFlowNext" class="btn micro" style="flex:1;">ë‹¤ìŒ</button>
      <button id="jobFlowComplete" class="btn micro"
              style="flex:1;display:none;">ì˜ë¢° ì™„ë£Œ</button>
    </div>
  </div>
</div>

<!-- ROUTING Overlay -->
<div id="routeOverlay">
  <div id="routeOverlayInner">
    <div id="routeOverlayTitle">NEORIVERE Â· ROUTING</div>
    <div id="routeOverlayText" class="glitch" data-text="ROUTING...">
      ROUTING...
    </div>
  </div>
</div>

  <!-- ì…€ë ˆë¥´ë‹ˆì•„ ë¯¸ë‹ˆ AI ìœ„ì ¯ -->
  <div id="cel-ai-widget">
    <!-- ë™ê·¸ë€ í† ê¸€ ë²„íŠ¼ -->
    <button id="cel-ai-toggle" aria-label="N.E.X-13 ë¯¸ë‹ˆ ì½”ì–´ ì—´ê¸°">
      <img src="piclumen-1764066368227.png" alt="N.E.X-13 ë¯¸ë‹ˆ ì½”ì–´" />
    </button>

    <!-- ì±„íŒ… íŒ¨ë„ -->
    <div id="cel-ai-panel">
      <div id="cel-ai-header">
        <div class="cel-ai-avatar">
          <img src="piclumen-1764066368227.png" alt="N.E.X-13 ë¯¸ë‹ˆ ì½”ì–´" />
        </div>
        <div class="cel-ai-meta">
          <div class="cel-ai-name">N.E.X-13 / NEX</div>
          <div class="cel-ai-status" id="cel-ai-section-status">
            HOME NODE // ê¸°ë³¸ ëŒ€ê¸° ìƒíƒœì…ë‹ˆë‹¤.
          </div>
        </div>
        
        <button id="cel-ai-close" class="cel-ai-close">âœ•</button>
      </div>

      <div id="cel-ai-messages"></div>

      <form id="cel-ai-form" autocomplete="off">
        <input id="cel-ai-input" type="text"
               placeholder="ë­ë“  ë¬¼ì–´ë´. (ì˜ˆ: ì˜ë¢° ì¶”ì²œ, ì„¸ê³„ê´€ ì„¤ëª…)"
               autocomplete="off" />
      </form>
    </div>
  </div>


<audio id="sfx-click" src="neorivere_ui_click.wav" preload="auto"></audio>
<audio id="sfx-hover" src="neorivere_ui_hover.wav" preload="auto"></audio>
<audio id="sfx-success" src="neorivere_success.wav" preload="auto"></audio>
<audio id="sfx-error" src="neorivere_error.wav" preload="auto"></audio>
<audio id="sfx-notify" src="neorivere_notify.wav" preload="auto"></audio>
<audio id="sfx-route" src="neorivere_overlay_whoosh.wav" preload="auto"></audio>

<audio id="rainNoise" src="neorivere_rain_noise.wav" loop></audio>
<audio id="rainDetail" src="neorivere_rain_detail.wav" loop></audio>

</body>
</html>
