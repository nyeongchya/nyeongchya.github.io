<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OverCity 2098 â€” Broker Nexus (Standalone)</title>

  <!-- Google font for cyberpunk feel -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg-0: #050509;
      --bg-1: #0b0b0f;
      --panel: rgba(18,18,20,0.7);
      --neon-cyan: #00f0ff;
      --neon-pink: #ff34b3;
      --neon-emerald: #3cffb5;
      --text: #e6eef6;
      --muted: #9aa3ad;
      /* Glitch controls */
      --glitch-x: 2px;        /* horizontal displacement */
      --glitch-y: -1px;       /* vertical displacement */
      --glitch-speed: 1600ms; /* base animation period */
      --scanline-opacity: 0.06;
      --transition-fast: 160ms;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Share Tech Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
      background: linear-gradient(180deg,var(--bg-0) 0%, var(--bg-1) 60%, #000 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-y:scroll;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><g fill="none" stroke="%23ffffff" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v8M2 12h8M22 12h-8M12 22v-8"/></g></svg>') 12 12, crosshair;
    }

    /* basic layout */
    .wrap{max-width:1100px;margin:28px auto;padding:24px;position:relative;z-index:2}
    header{display:flex;align-items:center;justify-content:space-between;gap:18px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:26px;background:linear-gradient(135deg,var(--neon-pink),#7b5cff);box-shadow:0 6px 25px rgba(0,0,0,0.6)}
    .title{line-height:1}
    .title h1{margin:0;font-family: 'Orbitron', sans-serif;font-size:20px;letter-spacing:1px}
    .title p{margin:0;font-size:12px;color:var(--muted)}

    nav{display:flex;gap:8px;align-items:center}
    .nav-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;font-size:13px;color:var(--text);transition:all var(--transition-fast);display:inline-flex;gap:8px;align-items:center}
    .nav-btn:hover{transform:translateY(-3px);box-shadow:0 6px 18px rgba(0,0,0,0.7)}

    /* panels */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:18px}
    .panel{background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:14px;border-radius:12px;backdrop-filter:blur(4px)}

    .big{grid-column:span 3}
    .two{grid-column:span 2}

    h2{margin:0 0 8px 0;font-family:'Orbitron';letter-spacing:0.6px}
    p.small{margin:0;color:var(--muted);font-size:13px}

    /* summary boxes */
    .stats{display:flex;gap:12px;margin-top:12px}
    .stat{background:rgba(0,0,0,0.25);padding:12px;border-radius:10px;flex:1;text-align:center}
    .stat .num{font-size:22px;font-weight:700;color:var(--neon-emerald)}

    /* list */
    .list{display:flex;flex-direction:column;gap:10px}
    .job{padding:10px;border-radius:10px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.02);transition:transform 180ms}
    .job:hover{transform:translateY(-6px)}
    .job .meta{font-size:12px;color:var(--muted)}

    /* map */
    .map-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .zone{padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.2));border:1px solid rgba(255,255,255,0.03);cursor:help;position:relative;transition:transform 160ms}
    .zone:hover{transform:translateY(-6px)}
    .zone .key{font-size:12px;color:var(--muted);margin-top:8px}
    .zone .tag{position:absolute;right:10px;top:10px;font-size:11px;background:rgba(0,0,0,0.5);padding:6px;border-radius:6px}

    /* market */
    .market{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(0,0,0,0.2)}
    .item .meta{font-size:12px;color:var(--muted)}

    /* controls */
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--neon-pink),var(--neon-cyan));border:none;padding:8px 12px;border-radius:10px;color:#000;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);font-weight:600}
    .micro{font-size:12px;padding:6px 8px;border-radius:8px}

    /* footer */
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:12px;padding:18px}

    /* Glitch CSS (layers) */
    .glitch {
      position: relative;
      display: inline-block;
      color: var(--text);
      --g1: var(--glitch-x);
      --g2: calc(var(--glitch-x) * -1);
      --gy: var(--glitch-y);
    }
    .glitch::before,
    .glitch::after{
      content: attr(data-text);
      position: absolute;
      left:0;top:0;
      width:100%;
      height:100%;
      overflow:visible;
      clip-path: inset(0 0 0 0);
      pointer-events:none;
    }
    .glitch::before{
      color: var(--neon-pink);
      transform:translate(var(--g1), var(--gy));
      mix-blend-mode:screen;
      opacity:0.9;
      animation:glitch-anim var(--glitch-speed) linear infinite;
    }
    .glitch::after{
      color: var(--neon-cyan);
      transform:translate(var(--g2), calc(var(--gy) * -1));
      mix-blend-mode:screen;
      opacity:0.85;
      animation:glitch-anim-2 calc(var(--glitch-speed) * 0.7) linear infinite;
    }

    @keyframes glitch-anim {
      0%{transform:translate(var(--g1), var(--gy))}
      10%{transform:translate(calc(var(--g1) * 1.3), var(--gy))}
      20%{transform:translate(calc(var(--g1) * -0.6), calc(var(--gy) * 1.2))}
      30%{transform:translate(var(--g1), calc(var(--gy) * -1))}
      40%{transform:translate(0,0)}
      100%{transform:translate(var(--g1), var(--gy))}
    }
    @keyframes glitch-anim-2 {
      0%{transform:translate(var(--g2), calc(var(--gy) * -1))}
      15%{transform:translate(calc(var(--g2) * -1.5), calc(var(--gy) * -1.2))}
      35%{transform:translate(var(--g2), 0)}
      60%{transform:translate(calc(var(--g2) * 0.8), var(--gy))}
      100%{transform:translate(var(--g2), calc(var(--gy) * -1))}
    }

    /* scanlines */
    .scanlines:before{
      content:"";
      position:fixed;left:0;right:0;top:0;bottom:0;pointer-events:none;
      background-image:linear-gradient(rgba(255,255,255,var(--scanline-opacity)) 1px, transparent 1px);
      background-size:100% 4px;
      mix-blend-mode:overlay;
      z-index:1;
    }

    /* noise overlay (using SVG data inline for portability) */
    .noise{
      position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;opacity:0.08;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><filter id="n"><feTurbulence baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="512" height="512" filter="url(%23n)" opacity="0.85"/></svg>');
      mix-blend-mode:overlay;z-index:0;
    }

    /* tooltip */
    .tooltip{position:absolute;background:linear-gradient(180deg,rgba(0,0,0,0.9),rgba(10,10,10,0.9));padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);font-size:13px;transform:translateY(-8px);white-space:nowrap;z-index:20;pointer-events:none}

    /* easter eggs */
    .egg{position:fixed;bottom:16px;right:16px;opacity:0.28;transition:opacity 200ms}
    .egg:hover{opacity:1}

    /* subtle animations */
    .fade-in{animation:fadeIn 600ms ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    /* responsive */
    @media (max-width:900px){
      .grid{grid-template-columns:repeat(1,1fr)}
      .map-grid{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body class="scanlines">

  <div class="noise"></div>

  <div class="wrap fade-in" id="app">
    <header>
      <div class="brand">
        <div class="logo">ğŸ•¶ï¸</div>
        <div class="title">
          <h1><span class="glitch" data-text="OverCity 2098 â€” Broker Nexus">OverCity 2098 â€” Broker Nexus</span></h1>
          <p class="small">ì€ë°€í•œ ì˜ë¢° Â· ìµëª… ì—°ê²° Â· ì‹¤ì‹œê°„ ì¸í…”</p>
        </div>
      </div>

      <nav>
        <button class="nav-btn" data-target="home">Home</button>
        <button class="nav-btn" data-target="jobs">Jobs <span style="font-size:11px;margin-left:8px;color:var(--muted)">(<span id="jobs-count">0</span>)</span></button>
        <button class="nav-btn" data-target="intel">Intel</button>
        <button class="nav-btn" data-target="map">Map</button>
        <button class="nav-btn" data-target="contact">Contact</button>
        <div style="width:8px"></div>
        <button id="loginBtn" class="nav-btn">ë¡œê·¸ì¸</button>
        <button id="soundToggle" class="nav-btn">ì‚¬ìš´ë“œ</button>
      </nav>
    </header>

    <!-- MAIN CONTENT -->
    <main style="margin-top:18px">
      <!-- HOME -->
      <section id="home" class="panel big">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <div>
            <h2 style="font-size:22px;margin-bottom:6px"><span class="glitch" data-text="OverCity â€” ë’·ê³¨ëª©ì—ì„  ìš°ë¦¬ëŠ” ë²•ë³´ë‹¤ ë¹ ë¥´ë‹¤">OverCity â€” ë’·ê³¨ëª©ì—ì„  ìš°ë¦¬ëŠ” ë²•ë³´ë‹¤ ë¹ ë¥´ë‹¤</span></h2>
            <p class="small">ì˜ë¢° ì ‘ìˆ˜ Â· ìµëª… ì—°ê²° Â· ì‹¤ì‹œê°„ ì¸í…”. ë¸Œë¡œì»¤ë¡œì„œ í•„ìš”í•œ ëª¨ë“  ë„êµ¬ë¥¼ í•œ ê³³ì—.</p>
            <div style="margin-top:8px;color:var(--muted);font-size:13px">ê²½ê³ : ì •ë¶€ì˜ ê°ì‹œê°€ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì€ë°€í•˜ê²Œ í–‰ë™í•˜ì„¸ìš”.</div>
          </div>

          <div class="controls">
            <div style="text-align:right">
              <div style="font-size:12px;color:var(--muted)">ì§€ê°‘</div>
              <div style="background:rgba(0,0,0,0.4);padding:8px;border-radius:12px;margin-top:6px" id="wallet">5000 creds</div>
            </div>
            <button id="postJob" class="btn">ì˜ë¢° ì˜¬ë¦¬ê¸°</button>
          </div>
        </div>

        <div class="grid" style="margin-top:16px">
          <div class="panel">
            <h3>ë¸Œë¡œì»¤ í”„ë¡œí•„</h3>
            <p class="small">í”„ë¡œí•„ì„ ì„¤ì •í•˜ê³  ì‹ ë¢° ì ìˆ˜ë¥¼ ìŒ“ìœ¼ì„¸ìš”. (ë¡œì»¬ ì €ì¥)</p>
            <div style="margin-top:10px;color:var(--muted);font-size:13px">í˜„ì¬ ë¡œê·¸ì¸: <span id="who">ì—†ìŒ</span></div>
          </div>

          <div class="panel">
            <h3>ì•”ì‹œì¥</h3>
            <p class="small">ì•„ì´í…œ ë¼ì¸ì—…ê³¼ êµ¬ë§¤. ìµëª… íŠ¸ëœì­ì…˜ì€ ì‹¤í—˜ì ì…ë‹ˆë‹¤.</p>
          </div>

          <div class="panel">
            <h3>ì—°ê²° í¬í„¸</h3>
            <p class="small">ì˜ë¢° ë“±ë¡ê³¼ ì§ì ‘ ì—°ê²° â€” ìµëª… ì˜µì…˜ í¬í•¨.</p>
          </div>

          <div class="panel">
            <h3>ë¹„ë°€ íŒì—…</h3>
            <p class="small">ì˜¤ì§ <strong id="secret-owner">raven</strong> ì „ìš©ì…ë‹ˆë‹¤.</p>
            <div style="margin-top:8px;color:var(--muted)">í˜„ì¬ ë¹„ë°€ íŒì—… ìƒíƒœ: <span id="secretState">ì ê¹€</span></div>
          </div>
        </div>

        <div style="margin-top:16px" class="panel">
          <h3><span class="glitch" data-text="ìµœê·¼ í™œë™">ìµœê·¼ í™œë™</span></h3>
          <p class="small">ì‚¬ëŒë“¤ì´ ìš°ë¦¬ì—ê²Œ ë‚¨ê¸´ ì˜ë¢°(ìƒ˜í”Œ) ë° í˜„ì¬ ì˜¤í”ˆëœ ì˜ë¢°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>

          <div class="stats" style="margin-top:12px">
            <div class="stat">
              <div class="num" id="completed-count">0</div>
              <div class="small" style="color:var(--muted)">ì´ ì™„ë£Œ ì˜ë¢°</div>
            </div>
            <div class="stat">
              <div class="num" id="open-count">0</div>
              <div class="small" style="color:var(--muted)">ì˜¤í”ˆ ì˜ë¢°</div>
            </div>
            <div class="stat">
              <div class="num" id="wallet-count">5000</div>
              <div class="small" style="color:var(--muted)">ì§€ê°‘ (creds)</div>
            </div>
          </div>

          <div style="margin-top:14px">
            <h4 style="margin:0 0 8px 0">ìµœê·¼ ì˜ë¢° (ì‚¬ìš©ì ì œì¶œ ì˜ˆì‹œ)</h4>
            <div id="recent-list" class="list"></div>
          </div>
        </div>
      </section>

      <!-- JOBS -->
      <section id="jobs" class="panel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>ì˜ë¢° ëª©ë¡</h2>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="job-search" placeholder="ê²€ìƒ‰: í•´í‚¹, ì ì…, ë°°ë‹¬..." style="background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--text)" />
            <button id="refreshJobs" class="btn micro">ê°±ì‹ </button>
          </div>
        </div>

        <div id="jobs-list" style="margin-top:12px" class="list"></div>
      </section>

      <!-- INTEL -->
      <section id="intel" class="panel" style="display:none">
        <h2>ì‹¤ì‹œê°„ ì¸í…”</h2>
        <div id="intel-list" style="margin-top:10px" class="list"></div>
      </section>

      <!-- MAP -->
      <section id="map" class="panel" style="display:none">
        <h2>ì˜¤ë²„ì‹œí‹° ì§€ë„</h2>
        <div class="map-grid" id="map-grid"></div>
      </section>

      <!-- CONTACT / MARKET -->
      <section id="contact" class="panel" style="display:none">
        <h2>ë³´ì•ˆ ì±„ë„ & ì•„ì´í…œ ë§ˆì¼“</h2>
        <p class="small">ë©”ì‹œì§€ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸¡ AES-GCMìœ¼ë¡œ ì•”í˜¸í™”ë©ë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ëŠ” ë¡œì»¬ì—ì„œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.</p>

        <div style="margin-top:12px;display:flex;gap:12px;align-items:flex-start">
          <div style="flex:1">
            <textarea id="payload" placeholder="ë³´ë‚¼ ë©”ì‹œì§€..." style="width:100%;height:120px;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:var(--text)"></textarea>
            <div style="margin-top:8px;display:flex;gap:8px">
              <button id="encryptBtn" class="btn micro">ì•”í˜¸í™” & ë³µì‚¬</button>
              <button id="decryptBtn" class="btn secondary micro">ë³µí˜¸í™”</button>
              <button id="clearPayload" class="btn secondary micro">ì§€ìš°ê¸°</button>
            </div>
            <div style="margin-top:8px;color:var(--muted);font-size:12px">íŒ: ë©”ì‹œì§€ ì•ì— <code>Accept:JOB_ID</code>ë¥¼ ë¶™ì´ë©´ ë‚´ë¶€ ì›Œí¬í”Œë¡œìš°ê°€ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.</div>
          </div>

          <div style="width:320px">
            <div style="background:rgba(0,0,0,0.18);padding:10px;border-radius:10px">
              <h4 style="margin:0 0 8px 0">ì•„ì´í…œ ë§ˆì¼“</h4>
              <div id="market" class="market"></div>
            </div>
            <div style="margin-top:10px;background:rgba(0,0,0,0.18);padding:10px;border-radius:10px">
              <div style="font-size:13px;color:var(--muted)">êµ¬ë§¤ ë¡œê·¸</div>
              <div id="purchases" style="font-size:12px;margin-top:8px;color:var(--muted)">ì—†ìŒ</div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <footer class="panel" style="margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div style="color:var(--muted)">Â© 2098 OverCity Broker Nexus</div>
        <div style="display:flex;gap:8px;align-items:center">
          <div style="font-size:12px;color:var(--muted)">ê¸€ë¦¬ì¹˜ ê°•ë„</div>
          <input id="glitchRange" type="range" min="0" max="6" value="2" style="width:140px" />
          <button id="showDev" class="btn micro">ì´ìŠ¤í„°ì—ê·¸</button>
        </div>
      </div>
    </footer>
  </div>

  <!-- Easter Egg button -->
  <div class="egg" title="SYSÂ·LAYER">
    <button id="eggBtn" style="padding:8px 10px;background:rgba(255,255,255,0.04);border-radius:8px;border:1px solid rgba(255,255,255,0.03);color:var(--muted)">SYSÂ·LAYER</button>
  </div>

  <!-- secret popup placeholder -->
  <div id="secretPopup" style="position:fixed;right:18px;bottom:92px;width:260px;background:rgba(0,0,0,0.8);border:1px solid rgba(0,255,150,0.12);padding:12px;border-radius:12px;display:none;z-index:60">
    <div style="color:var(--neon-emerald);font-weight:700;margin-bottom:8px">SECRET â€” ë¸Œë¡œì»¤ ì „ìš©</div>
    <div style="color:var(--muted);font-size:13px">ì´ ê³µê°„ì€ raven ì „ìš©ì…ë‹ˆë‹¤. ì™¸ë¶€ ë…¸ì¶œ ê¸ˆì§€.</div>
    <div style="margin-top:10px">
      <button id="clipSecret" class="btn micro">í´ë¦½ë³´ë“œ ë³µì‚¬(ë°ëª¨)</button>
    </div>
  </div>

  <script>
    /* ===============================
       Data (jobs, intel, map, items)
       =============================== */
    const SECRET_OWNER = 'raven';

    const jobs = [
      { id: 'H-1001', title: "í—¬ë¦­ìŠ¤ ë¡œê·¸ ì •ë¦¬ â€” 'ì œë°œ ë¶€íƒí•´ìš”'", client: 'ê¹€. (ê°œì¸)', reward: 8000, tags: ['clean','forensics'], location: 'Mid-Arcology 3F', difficulty: 'Medium', desc: '"ì œ ì‹¤ìˆ˜ë¡œ ì—°êµ¬ì†Œ ì ‘ì† í”ì ì´ ë‚¨ì•˜ì–´ìš”. ì•„ì´ë“¤ ë•Œë¬¸ì— ì†Œë€ í”¼ìš°ê¸° ì‹«ìŠµë‹ˆë‹¤. ë¡œê·¸ì—ì„œ ì œ í”ì ì„ ì§€ì›Œì£¼ì„¸ìš”." â€” ê°œì¸ ì˜ë¢°ì¸', status: 'completed' },
      { id: 'H-1002', title: "ë¸”ë™ì…°ë„ìš° ì ì… â€” 'ê°€ì¡±ì„ êµ¬í•´ì£¼ì„¸ìš”'", client: 'ìµëª…', reward: 15000, tags: ['infiltrate','stealth'], location: 'Lower Docks', difficulty: 'High', desc: '"ë°°ì†¡ì°¨ë¡œ ìœ„ì¥í•´ì„œ êµ¬ì—­ì— ë“¤ì–´ê°€ì•¼ í•©ë‹ˆë‹¤. ë‚´ë¶€ì—ì„œ íŠ¹ì • ë´‰íˆ¬ë¥¼ íšŒìˆ˜í•´ì•¼ í•´ìš”. ì¹˜ëª…ìƒì€ ì ˆëŒ€ ì•ˆ ë©ë‹ˆë‹¤." â€” ìµëª…', status: 'completed' },
      { id: 'J-9001', title: "ë°ì´í„° ìŠ¤í‚¤ë° â€” ì—°êµ¬ì†Œ ë¡œê·¸ (ê¸´ê¸‰)", client: 'ìµëª…(ì—°êµ¬ì›)', reward: 12000, tags: ['hack','stealth'], location: 'Mid-Arcology 7F', difficulty: 'High', desc: '"ì €ëŠ” í•´ë‹¹ ì—°êµ¬ì†Œì˜ ë‚´ë¶€ ì—°êµ¬ì›ì´ì§€ë§Œ ë‚´ë¶€ ê³ ë°œìì…ë‹ˆë‹¤. íŠ¹ì • í”„ë¡œì íŠ¸ì˜ ë¡œê·¸(2098-09 ~ 2098-11)ë¥¼ ì™¸ë¶€ë¡œ ë¹¼ë‚¼ ìˆ˜ ìˆë‚˜ìš”? ì¦ê±°ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ì§€ë§Œ ëª¨ë‹ˆí„°ë§ì´ ì‹¬í•´ìš”."', status: 'open' },
      { id: 'J-9002', title: "ìŠ¤í˜ì…œ íŒ¨í‚¤ì§€ ë°°ë‹¬ â€” 'ê¸‰í•©ë‹ˆë‹¤'", client: 'ì†Œí˜• ê°±', reward: 2300, tags: ['delivery','fast'], location: 'Neon Market, Sector 3', difficulty: 'Low', desc: '"ì •í•´ì§„ ì‹œê°„(23:10-23:30)ì— Aâ†’B ì§€ì ìœ¼ë¡œ íŒ¨í‚¤ì§€ ì „ë‹¬. ê²‰ìœ¼ë¡œ ë³´ê¸°ì—” ìŒì‹ ë°°ë‹¬ì²˜ëŸ¼. ê°ì‹œê°€ ë‚®ì€ ì‹œê°„ëŒ€ì…ë‹ˆë‹¤. ì°¨ëŸ‰ ì œê³µ ê°€ëŠ¥."', status: 'open' },
      { id: 'J-9003', title: "ì•„ì´ì–¸ í¬ê²Ÿ â€” í‘œì  íšŒìˆ˜ (ë¯¼ê°)", client: 'ê¸°ì—…ì²­ë¶€', reward: 48000, tags: ['extraction','high-risk'], location: 'Corporate Spire 12', difficulty: 'Very High', desc: '"íšŒì‚¬ì˜ ë‚´ë¶€ ì»¨íƒì—ì„œ í‘œì ì„ ì•ˆì „í•˜ê²Œ ë°ë ¤ì˜¤ê¸¸ ì›í•¨. ë¹„ì¹˜ëª…ì  ì œì•• ê¶Œì¥. ê²½í˜¸ì› ë‹¤ìˆ˜, ê¶Œí•œ í† í°ì´ í•„ìš”í•  ìˆ˜ë„ ìˆìŒ."', status: 'open' },
      { id: 'J-9101', title: "ìŠ¤ë§ˆíŠ¸ ì„¼ì„œ êµë€ â€” ì´ë²¤íŠ¸", client: 'ì–¸ë”ë„· í¬ëŸ¼', reward: 9000, tags: ['electronic','timing'], location: 'Neon Market', difficulty: 'Medium', desc: '"ì‹œì¥ êµ¬ì—­ Aì˜ ì„¼ì„œê°€ 30ì´ˆ ë™ì•ˆ ë©ˆì¶°ì•¼ í•©ë‹ˆë‹¤. ìƒì¸ë“¤ì´ ì¼ì‹œì ìœ¼ë¡œ ì§„ì—´ì„ ë°”ê¿€ ìˆ˜ ìˆë„ë¡ êµë€ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ í•„ìš”."', status: 'open' },
      { id: 'J-9102', title: "ì€ìƒ‰ íŒ¨ìŠ¤ ìœ„ì¡° â€” ì¶œì… í—ˆê°€", client: 'ì†Œë§¤ìƒ', reward: 4200, tags: ['forge','low-risk'], location: 'Lower Docks', difficulty: 'Low', desc: '"ì„ì‹œ ì¶œì…ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¨ê¸°ê°„(4ì‹œê°„) ìœ íš¨í•œ ì¶œì… íŒ¨ìŠ¤ë¡œ, OCR ê²€ì¦ì„ ìš°íšŒí•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì‚¬ì§„ ë° ìµœì†Œ ì •ë³´ ì œê³µ ê°€ëŠ¥."', status: 'open' },
      { id: 'J-9201', title: "ìƒì–´ë²„ë¦° ë…¹ìŒ íšŒìˆ˜ â€” ì—„ë§ˆì˜ ëª©ì†Œë¦¬", client: 'ìµœ. (ì¼ë°˜)', reward: 3000, tags: ['recovery','sensitive'], location: 'Old Subway', difficulty: 'Low', desc: '"ì§€í•˜ì²  íì‡„ì—­ ê·¼ì²˜ì—ì„œ ë…¹ìŒíŒŒì¼ì„ ìƒì–´ë²„ë ¸ì–´ìš”. ì œê²Œ ì¤‘ìš”í•œ ëŒ€í™”ê°€ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. ë°ì´í„° ë³µêµ¬ê°€ ê°€ëŠ¥í• ê¹Œìš”? í”ŒëŸ¬ê·¸ë‚˜ ë¬¼ë¦¬ì  ì ‘ê·¼ ë‘˜ ë‹¤ ê°€ëŠ¥í•©ë‹ˆë‹¤."', status: 'open' },
    ];

    const intel = [
      { id: 'I-1', title: 'ì‹œë‚´ CCTV ë£¨íŠ¸ ì¬ì¡°ì •', time: '2098-11-18 02:12', trust: 'B+', tag: 'surveillance', body: 'ì¤‘ì•™ í†µì œì‹¤ì´ ìƒˆ ìŠ¤ì¼€ì¤„ì„ ë°°í¬ â€” ê³¼ê±° ë£¨íŠ¸ì™€ ì°¨ì´ ìˆìŒ. ì•¼ê°„ íŒ¨í„´ ì£¼ì˜.' },
      { id: 'I-2', title: 'ë¸”ë£¨ë²„ë“œ ë“œë¡  ë°°ì¹˜', time: '2098-11-20 21:04', trust: 'A-', tag: 'aerial', body: 'íŠ¹ì • êµ¬ì—­ ìƒê³µì— ê°ì‹œ ë“œë¡ ì´ ëŠ˜ì–´ë‚¨. ì „ìì „ ì¥ë¹„ ë³´ìœ  ê°€ëŠ¥.' },
      { id: 'I-3', title: 'íë¸Œ ë…¸ë“œ ì¬ë°°ì¹˜', time: '2098-11-21 01:30', trust: 'A', tag: 'network', body: 'ê¸°ì—… ë…¸ë“œë“¤ì´ íŠ¸ë˜í”½ ìš°íšŒ ê²½ë¡œë¥¼ ì„¤ì • â€” íŠ¹ì • êµ¬ê°„ì— ë ˆì´í„´ì‹œ ê¸‰ì¦.' },
    ];

    const mapZones = [
      { id: 'Z-1', name: 'Neon Market', level: 2, hazard: 'medium', desc: 'ìƒì ê³¼ ì•”ì‹œì¥ í˜¼ì¬. ê°ì‹œ ë¹ˆë„ëŠ” ë‚®ìŒ.', key: 'í›„ë¯¸ ê³¨ëª©ì˜ ìƒì ì°½ê³  â€” êµí™˜ í¬ì¸íŠ¸' },
      { id: 'Z-2', name: 'Mid-Arcology', level: 5, hazard: 'high', desc: 'ê³ ì¸µ ì—°êµ¬/ê¸°ì—… êµ¬ì—­. ë³´ì•ˆ ë ˆì´ì–´ê°€ ë¹½ë¹½í•¨.', key: 'ë³´ì•ˆ ì—˜ë¦¬ë² ì´í„° ë£¨íŠ¸ê°€ í•µì‹¬' },
      { id: 'Z-3', name: 'Lower Docks', level: 3, hazard: 'variable', desc: 'ë°°í›„ ê±°ë˜ì™€ ì†Œê·œëª¨ ê°± í™œë™. ì•¼ê°„ì´ í™œë°œí•¨.', key: 'ì»¨í…Œì´ë„ˆ ì‚¬ì´ ì€ë°€í•œ í†µë¡œ' },
      { id: 'Z-4', name: 'Old Subway', level: 2, hazard: 'low', desc: 'ì¸ì ì´ ë“œë¬¸ ì§€í•˜ í†µë¡œ â€” ì „ì ê°ì‹œ êµ¬ë©ì´ ë§ìŒ.', key: 'íì‡„ì—­ í”Œë«í¼ B' },
      { id: 'Z-5', name: 'Corporate Spire', level: 6, hazard: 'very high', desc: 'ê¸°ì—… í•µì‹¬ êµ¬ì—­ â€” ì ‘ê·¼ì‹œ í—ˆê°€ í•„ìš”.', key: 'ì˜¥ìƒ í†µì‹  ë…¸ë“œ' },
      { id: 'Z-6', name: 'Ghost Alley', level: 4, hazard: 'extreme', desc: 'ì‹¤ì¢… ì‹ ê³ ê°€ ë°˜ë³µë˜ëŠ” êµ¬ì—­. ì „íŒŒ ê°„ì„­ ì‹¬í•¨.', key: 'ë…¹ìŠ¨ ì „ì‹ ì£¼ ì•„ë˜' },
      { id: 'Z-7', name: 'Chrome Jungles', level: 6, hazard: 'very high', desc: 'ë°˜ê¸ˆì† ìƒì²´ì‹¤í—˜ í”ì . ì ‘ê·¼ ì‹œ ì‹ í˜¸ ì™œê³¡.', key: 'íë‹¨ì§€ ë‚´ë¶€ ì‹¤í—˜ì‹¤' },
    ];

    const items = [
      { id: 'IT-1', name: 'ì‹œê·¸ë„ ìŠ¤í¬ë¨ë¸”ëŸ¬', desc: 'ë‹¨ì‹œê°„ ë“œë¡ /ê°ì‹œì™€ í†µì‹  ì°¨ë‹¨', price: 1800, stock: 3 },
      { id: 'IT-2', name: 'Temp ID Chip', desc: 'ì„ì‹œ ì¶œì…ì¦ ì—ë®¬ë ˆì´í„°', price: 950, stock: 8 },
      { id: 'IT-3', name: 'EMP íŒ©(ì†Œí˜•)', desc: 'ì „ìê¸° í„ìŠ¤ë¡œ ì¥ë¹„ ë§ˆë¹„', price: 4200, stock: 1 },
    ];

    /* ================
       App State
       ================ */
    const state = {
      wallet: Number(localStorage.getItem('oc_wallet') || 5000),
      purchases: JSON.parse(localStorage.getItem('oc_purchases') || '[]'),
      users: JSON.parse(localStorage.getItem('oc_users') || '{}'),
      logged: JSON.parse(localStorage.getItem('oc_logged') || '{}'),
      secretUnlocked: false,
    };

    /* ================
       Helpers & Rendering
       ================ */
    function $(sel){ return document.querySelector(sel) }
    function $all(sel){ return Array.from(document.querySelectorAll(sel)) }

    function renderSummary(){
      $('#completed-count').textContent = jobs.filter(j=>j.status==='completed').length;
      $('#open-count').textContent = jobs.filter(j=>j.status==='open').length;
      $('#jobs-count').textContent = jobs.length;
      $('#wallet').textContent = state.wallet + ' creds';
      $('#wallet-count').textContent = state.wallet;
      $('#who').textContent = Object.keys(state.logged).length ? Object.keys(state.logged).join(', ') : 'ì—†ìŒ';
      $('#secretState').textContent = state.logged[SECRET_OWNER] ? 'ì—´ë¦¼' : 'ì ê¹€';
      renderRecent();
      renderJobs();
      renderIntel();
      renderMap();
      renderMarket();
      renderPurchases();
    }

    function renderRecent(){
      const list = $('#recent-list'); list.innerHTML = '';
      jobs.slice(0,6).forEach(j=>{
        const el = document.createElement('div'); el.className='job';
        el.innerHTML = `<div style="display:flex;justify-content:space-between"><div><div style="font-weight:700">${j.title}</div><div class="meta">${j.location} Â· ë³´ìƒ: ${j.reward} Â· ìƒíƒœ: ${j.status}</div></div><div style="font-size:12px;color:var(--muted)">${j.client}</div></div><p style="margin-top:8px;color:var(--muted)">${j.desc}</p>`;
        list.appendChild(el);
      });
    }

    function renderJobs(filter=''){
      const list = $('#jobs-list'); list.innerHTML = '';
      jobs.filter(j=> (j.title + j.tags.join(' ') + j.client + j.status + j.desc).toLowerCase().includes(filter.toLowerCase()))
      .forEach(j=>{
        const el = document.createElement('div'); el.className='job';
        const openBtn = j.status==='open' ? `<button class="btn micro" data-accept="${j.id}">ìˆ˜ë½</button>` : '';
        el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-weight:700">${j.title}</div><div class="meta">í´ë¼ì´ì–¸íŠ¸: ${j.client} Â· ë³´ìƒ: ${j.reward} creds Â· ìƒíƒœ: ${j.status}</div></div><div style="display:flex;flex-direction:column;gap:6px">${openBtn}<button class="btn secondary micro" data-view="${j.id}">ë³´ê¸°</button></div></div>`;
        list.appendChild(el);
      });
      $all('button[data-accept]').forEach(b=>b.onclick = async (e)=>{
        const id = e.currentTarget.dataset.accept;
        const pw = prompt('ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìˆ˜ì‹ ìì™€ ê³µìœ )');
        if(!pw) return;
        const enc = await encryptAES('Accept:' + id, pw);
        $('#payload').value = enc;
        alert('ì˜ë¢° ìˆ˜ë½ ë©”ì‹œì§€(ì•”í˜¸í™”)ê°€ í˜ì´ë¡œë“œì— ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. Contact íƒ­ì—ì„œ ë³µì‚¬/ì „ì†¡í•˜ì„¸ìš”.');
        setView('contact');
      });
      $all('button[data-view]').forEach(b=>b.onclick = (e)=>{
        const id = e.currentTarget.dataset.view;
        const j = jobs.find(x=>x.id===id);
        if(!j) return;
        alert(`${j.title}\n\n${j.desc}\n\nìœ„ì¹˜: ${j.location}\në‚œì´ë„: ${j.difficulty}\nìƒíƒœ: ${j.status}`);
      });
    }

    function renderIntel(){
      const list = $('#intel-list'); list.innerHTML = '';
      intel.forEach(i=>{
        const el = document.createElement('div'); el.className='job';
        el.innerHTML = `<div style="font-weight:700">${i.title}</div><div class="meta">${i.time} Â· ì‹ ë¢°ë„: ${i.trust}</div><p style="margin-top:8px;color:var(--muted)">${i.body}</p>`;
        list.appendChild(el);
      });
    }

    function renderMap(){
      const grid = $('#map-grid'); grid.innerHTML = '';
      mapZones.forEach(z=>{
        const el = document.createElement('div'); el.className='zone';
        el.innerHTML = `<div style="font-weight:700">${z.name}</div><div class="meta">ë ˆë²¨: ${z.level} Â· ì£¼ì˜: ${z.hazard}</div><div class="key">${z.desc}</div><div class="tag">${z.key || ''}</div>`;
        el.onmouseenter = (ev)=>showTip(ev.target, `<strong>${z.name}</strong><br/>${z.desc}<br/><span style='color:var(--muted)'>í•µì‹¬: ${z.key || 'N/A'}</span>`);
        el.onmouseleave = hideTip;
        grid.appendChild(el);
      });
    }

    function renderMarket(){
      const m = $('#market'); m.innerHTML = '';
      items.forEach(it=>{
        const el = document.createElement('div'); el.className = 'item';
        el.innerHTML = `<div><div style="font-weight:700">${it.name}</div><div class="meta">${it.desc}</div><div class="meta">ì¬ê³ : ${it.stock}</div></div><div style="text-align:right"><div style="font-weight:700">${it.price} creds</div><div style="margin-top:8px"><button ${it.stock<=0?'disabled':''} class="btn micro" data-buy="${it.id}">êµ¬ë§¤</button></div></div>`;
        m.appendChild(el);
      });
      $all('button[data-buy]').forEach(b=>b.onclick = (e)=>{
        const id = e.currentTarget.dataset.buy;
        buyItem(id);
      });
    }

    function renderPurchases(){
      const el = $('#purchases');
      if(state.purchases.length===0) el.textContent='ì—†ìŒ';
      else el.innerHTML = state.purchases.slice(-6).map(p=>`<div>${new Date(p.time).toLocaleString()} â€” ${p.name}</div>`).join('');
    }

    /* tooltip logic */
    let tipEl;
    function showTip(target, html){
      hideTip();
      tipEl = document.createElement('div'); tipEl.className='tooltip'; tipEl.innerHTML = html;
      document.body.appendChild(tipEl);
      const r = target.getBoundingClientRect();
      tipEl.style.left = (r.left + window.scrollX) + 'px';
      tipEl.style.top = (r.top + window.scrollY - tipEl.offsetHeight - 10) + 'px';
    }
    function hideTip(){ if(tipEl){ tipEl.remove(); tipEl=null } }

    /* ================
       Actions
       ================ */
    function setView(id){
      ['#home','#jobs','#intel','#map','#contact'].forEach(s => {
        const el = document.querySelector(s);
        if(!el) return;
        el.style.display = (s === '#' + id) ? '' : 'none';
      });
      // highlight nav
      $all('nav .nav-btn').forEach(b => {
        b.style.opacity = b.dataset.target === id ? '1' : '0.8';
      });
    }

    $all('nav .nav-btn').forEach(b=>{
      b.onclick = ()=>setView(b.dataset.target);
    });

    $('#postJob').onclick = ()=>{
      const title = prompt('ì˜ë¢° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
      const desc = prompt('ì˜ë¢° ìƒì„¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì¼ë°˜ì¸ì²˜ëŸ¼ ì‘ì„±)') || '';
      const reward = Number(prompt('ë³´ìƒ í¬ë ˆë”§ (ìˆ«ì)') || 1000);
      if(!title) return alert('ì œëª© í•„ìš”');
      const id = 'U-' + Math.floor(Math.random()*90000 + 10000);
      jobs.unshift({ id, title, client:'ì›¹ ì˜ë¢°ì', reward, tags:['user'], location:'ìœ ì € ì§€ì •', difficulty:'Var', desc, status:'open' });
      alert('ì˜ë¢°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. Jobs íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
      renderSummary();
      setView('jobs');
    };

    $('#refreshJobs').onclick = ()=>renderJobs($('#job-search').value);

    $('#job-search').addEventListener('input', ()=>renderJobs($('#job-search').value));

    /* ================
       Buy item
       ================ */
    function buyItem(id){
      const it = items.find(x=>x.id===id);
      if(!it) return;
      if(state.wallet < it.price) return alert('ì”ì•¡ ë¶€ì¡±');
      it.stock -= 1;
      state.wallet -= it.price;
      state.purchases.push({ id: it.id, name: it.name, time: Date.now() });
      localStorage.setItem('oc_purchases', JSON.stringify(state.purchases));
      localStorage.setItem('oc_wallet', String(state.wallet));
      alert(`${it.name} êµ¬ë§¤ ì™„ë£Œ`);
      renderSummary();
    }

    /* ================
       Encryption (AES-GCM w/ PBKDF2)
       ================ */
    async function deriveKey(password, saltBytes){
      const enc = new TextEncoder();
      const baseKey = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
      const key = await crypto.subtle.deriveKey({ name:'PBKDF2', salt: saltBytes, iterations: 200000, hash:'SHA-256' }, baseKey, { name:'AES-GCM', length: 256 }, false, ['encrypt','decrypt']);
      return key;
    }

    async function encryptAES(plaintext, password){
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const key = await deriveKey(password, salt);
      const enc = new TextEncoder();
      const cipher = await crypto.subtle.encrypt({ name:'AES-GCM', iv }, key, enc.encode(plaintext));
      return btoa(JSON.stringify({ salt:Array.from(salt), iv:Array.from(iv), data:Array.from(new Uint8Array(cipher)) }));
    }

    async function decryptAES(packB64, password){
      try{
        const pack = JSON.parse(atob(packB64));
        const salt = new Uint8Array(pack.salt);
        const iv = new Uint8Array(pack.iv);
        const data = new Uint8Array(pack.data);
        const key = await deriveKey(password, salt);
        const plain = await crypto.subtle.decrypt({ name:'AES-GCM', iv }, key, data);
        return new TextDecoder().decode(plain);
      }catch(e){
        return null;
      }
    }

    $('#encryptBtn').onclick = async ()=>{
      const text = $('#payload').value || 'ping';
      const pw = prompt('ì•”í˜¸ ì…ë ¥ (ìˆ˜ì‹ ìì™€ ê³µìœ í•˜ì„¸ìš”)');
      if(!pw) return;
      const enc = await encryptAES(text, pw);
      try{ await navigator.clipboard.writeText(enc); alert('ì•”í˜¸í™”ëœ í˜ì´ë¡œë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }catch(e){ alert('ì•”í˜¸í™” ê²°ê³¼:\n' + enc) }
    };

    $('#decryptBtn').onclick = async ()=>{
      const pack = prompt('ë³µí˜¸í™”í•  í˜ì´ë¡œë“œ ë¶™ì—¬ë„£ê¸° (base64) â€” ì·¨ì†Œí•˜ë©´ í˜„ì¬ í˜ì´ë¡œë“œ ì‚¬ìš©');
      const p = pack || $('#payload').value;
      if(!p) return;
      const pw = prompt('ì•”í˜¸ ì…ë ¥');
      if(!pw) return;
      const dec = await decryptAES(p, pw);
      if(dec === null) alert('ë³µí˜¸í™” ì‹¤íŒ¨ â€” ë¹„ë°€ë²ˆí˜¸/í˜ì´ë¡œë“œ í™•ì¸');
      else{ $('#payload').value = dec; alert('ë³µí˜¸í™” ì™„ë£Œ â€” í˜ì´ë¡œë“œì— ë‚´ìš©ì´ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.') }
    };

    $('#clearPayload').onclick = ()=>$('#payload').value='';

    /* ================
       Broker register/login (local hashed store)
       ================ */
    async function hashPassword(password, saltBytes){
      const enc = new TextEncoder();
      const baseKey = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveBits']);
      const derived = await crypto.subtle.deriveBits({ name:'PBKDF2', salt: saltBytes, iterations: 200000, hash:'SHA-256' }, baseKey, 256);
      return btoa(String.fromCharCode(...new Uint8Array(derived)));
    }

    async function registerBroker(name, password){
      if(!name || !password) return false;
      if(state.users[name]) return false;
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const h = await hashPassword(password, salt);
      state.users[name] = { salt:Array.from(salt), hash:h, created: Date.now() };
      localStorage.setItem('oc_users', JSON.stringify(state.users));
      return true;
    }

    async function verifyBroker(name, password){
      const rec = state.users[name];
      if(!rec) return false;
      const salt = new Uint8Array(rec.salt);
      const h = await hashPassword(password, salt);
      return h === rec.hash;
    }

    $('#loginBtn').onclick = async ()=>{
      const mode = prompt('ë¡œê·¸ì¸ ë˜ëŠ” ë“±ë¡ (type: login / register)').trim();
      if(mode === 'register'){
        const u = prompt('ë“±ë¡í•  ë¸Œë¡œì»¤ ID (ì˜ˆ: raven)'); if(!u) return alert('ID í•„ìš”');
        const p = prompt('íŒ¨ìŠ¤ì›Œë“œ'); if(!p) return alert('PW í•„ìš”');
        const ok = await registerBroker(u,p);
        alert(ok? 'ë“±ë¡ ì„±ê³µ (ë¡œì»¬ ì €ì¥)' : 'ë“±ë¡ ì‹¤íŒ¨ (ì´ë¯¸ ì¡´ì¬)');
        renderSummary();
        return;
      }
      const u = prompt('ë¸Œë¡œì»¤ ID'); if(!u) return;
      const p = prompt('íŒ¨ìŠ¤ì›Œë“œ'); if(!p) return;
      const ok = await verifyBroker(u,p);
      if(ok){
        const token = await encryptAES(JSON.stringify({ user:u, ts:Date.now() }), p);
        state.logged[u] = token;
        localStorage.setItem('oc_logged', JSON.stringify(state.logged));
        alert('ë¡œê·¸ì¸ ì„±ê³µ');
        if(u === SECRET_OWNER){
          state.secretUnlocked = true;
          $('#secretPopup').style.display = '';
        }
        renderSummary();
      }else alert('ë¡œê·¸ì¸ ì‹¤íŒ¨');
    };

    $('#clipSecret').onclick = ()=>{
      navigator.clipboard?.writeText(JSON.stringify({ vault:'protocol-keys', time:Date.now() })).then(()=>alert('ë°ëª¨ ë¹„ë°€ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'));
    };

    /* ================
       Secret popup reveal on login
       ================ */
    if(state.logged[SECRET_OWNER]) {
      state.secretUnlocked = true;
      $('#secretPopup').style.display = '';
    }

    /* ================
       Easter egg button
       ================ */
    $('#eggBtn').onclick = ()=> {
      alert('Easter Egg: ì‹œìŠ¤í…œ ë‚´ë¶€ ë ˆì´ì–´ ì ‘ê·¼ ê¶Œí•œ ë¶€ì¡± â€” (ë°ëª¨)');
      // playful fake effect: toggle small glitch intensity
      const r = $('#glitchRange');
      r.value = Math.min(6, Number(r.value) + 2);
      applyGlitchStrength(r.value);
    };

    $('#showDev').onclick = ()=>{
      alert('Dev Easter: ì €ì¥ëœ ë¸Œë¡œì»¤ ëª©ë¡ê³¼ ë¡œê·¸ì¸ í† í°ì„ ì½˜ì†”ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.');
      console.log('users', state.users);
      console.log('logged', state.logged);
      alert('ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
    };

    /* ================
       Sound (low hum)
       ================ */
    let audioCtx, osc, gain;
    let playing = false;
    $('#soundToggle').onclick = ()=>{
      if(!playing){
        try{
          audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
          osc = audioCtx.createOscillator();
          gain = audioCtx.createGain();
          osc.type = 'sine';
          osc.frequency.value = 40;
          gain.gain.value = 0.004;
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.start();
          playing = true;
          $('#soundToggle').textContent = 'ì‚¬ìš´ë“œ (ON)';
        }catch(e){ alert('ì‚¬ìš´ë“œ ì‹œì‘ ì‹¤íŒ¨ â€” ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í•„ìš”') }
      } else {
        if(osc){ try{ osc.stop(); }catch(e){} }
        playing = false;
        $('#soundToggle').textContent = 'ì‚¬ìš´ë“œ';
      }
    };

    /* ================
       Glitch strength control
       ================ */
    function applyGlitchStrength(v){
      // map 0..6 -> px
      const px = (v * 1.2).toFixed(2) + 'px';
      document.documentElement.style.setProperty('--glitch-x', px);
      document.documentElement.style.setProperty('--glitch-y', (v>2? -1*v/2 : -1) + 'px');
      // and alter speed
      const speed = 1200 + (6 - v) * 600;
      document.documentElement.style.setProperty('--glitch-speed', speed + 'ms');
    }
    $('#glitchRange').addEventListener('input', (e)=>{ applyGlitchStrength(e.target.value) });

    /* initialize */
    applyGlitchStrength($('#glitchRange').value);
    renderSummary();

    /* small UX: switch view on load */
    setView('home');

    /* expose for debugging (optional) */
    window._oc = { jobs, intel, mapZones, items, state, encryptAES, decryptAES };
  </script>
</body>
</html>
